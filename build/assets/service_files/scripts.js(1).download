function setScreenHeight() {
	
	var navbar_height = jQuery('.navbar-fixed-top').height();
	var window_height = jQuery(window).height();
	var screen_height = window_height - navbar_height;
	
	if (jQuery('body').hasClass('admin-bar')) {
		screen_height -= 32;
	}
	
	if (jQuery(window).width() > 767) {
		jQuery('.home .screen').each(function(index, element) {
			
			var inner_height = jQuery(element).children('.screen-centered').height();

			if (inner_height > screen_height) {
				jQuery(element).css('min-height', inner_height);
			} else {
				jQuery(element).css('min-height', screen_height);
			}

			jQuery(element).children('.screen-centered').css('height', inner_height).addClass('absolute-centered');
		});
	} else {
		jQuery('.home .screen').each(function(index, element) {
			jQuery(element).css('min-height', '0px');
			jQuery(element).children('.screen-centered').css('height', 'auto').removeClass('absolute-centered');
		});
	}
	
}

function refreshScrollspy() {
	jQuery('[data-spy="scroll"]').each(function() {
		var $spy = jQuery(this).scrollspy('refresh');
	});
}

function scrollToAnchor(e) {
	var target_top = jQuery(e).offset().top - 140;
	
	if (jQuery('body').hasClass('admin-bar')) {
		target_top -= 32;
	}
	
	jQuery('html, body').animate({scrollTop:target_top}, 1000);	
}

// Document Ready
jQuery(document).ready(function(){
	
	// Navbar Dropdown
	jQuery('ul.nav > li.dropdown').hoverIntent({
		sensitivity: 7,
		interval: 40,
		over: function() {
			jQuery(this).children('ul.dropdown-menu').slideDown('fast');
		},
		out: function() {
			jQuery(this).children('ul.dropdown-menu').slideUp('fast');
		}
	});
	
	// Accordion
	jQuery('.answer').addClass('panel-collapse collapse').wrapInner('<div class="panel-body" />');
	jQuery('.question').prepend('<span class="glyphicon glyphicon-plus-sign"></span> ');
	jQuery('.question').click(function(e){
		e.preventDefault();
		jQuery(this).toggleClass('active').next('.answer').slideToggle().siblings('.answer:visible').slideUp();
		jQuery(this).find('.glyphicon').toggleClass('glyphicon-plus-sign glyphicon-minus-sign');
		jQuery(this).siblings('.question.active').removeClass('active').find('.glyphicon').toggleClass('glyphicon-plus-sign glyphicon-minus-sign');
		
		refreshScrollspy();
		
	});
	
	// Site Credits
	jQuery('#site_credits').click(function() {
		jQuery(this).hide();
		jQuery('#site_credits_text').fadeIn(1000);
	});
	
	// Gravity form styles
	jQuery('.gform_button, .jbfButtn').addClass('btn btn-primary');
	jQuery('.ginput_container select, .ginput_container textarea, .ginput_container input[type="text"], .ginput_container input[type="password"], .ginput_container input[type="datetime"], .ginput_container input[type="datetime-local"], .ginput_container input[type="date"], .ginput_container input[type="month"], .ginput_container input[type="time"], .ginput_container input[type="week"], .ginput_container input[type="number"], .ginput_container input[type="email"], .ginput_container input[type="url"], .ginput_container input[type="search"], .ginput_container input[type="tel"], .ginput_container input[type="color"]').addClass('form-control');
	
	// Tooltips
	jQuery('.social > li > a, .social-links > li > a').tooltip({
		container: 'body',
		placement: 'bottom'
	});
	
	jQuery('.with-tip').tooltip({
		container: 'body',
		placement: 'bottom'
	});
	
	// testimonial slideshow
	jQuery('.screen-divider').each(function(index, element) {
		jQuery(element).find('.display-posts-listing .testimonial-listing').first().addClass('active');
		setInterval(function() {
			var active_slide = jQuery(element).find('.display-posts-listing .testimonial-listing.active');
			if ( active_slide.next('.testimonial-listing').length ) {
				var next_slide = active_slide.next('.testimonial-listing');
			} else {
				var next_slide = active_slide.siblings('.testimonial-listing').first();
			}
			active_slide.fadeOut(function() {
				active_slide.removeClass('active');
				next_slide.fadeIn().addClass('active');
			});
		}, 10000);
	 });
	
	// Screens
	setScreenHeight();
	
	jQuery(window).resize(function() {
		setScreenHeight();
		refreshScrollspy();
		
		var s = skrollr.get();
		
		if (jQuery(window).width() > 1024) {
			if (!s) {
				var s = skrollr.init({
					forceHeight: false
				});
			}
		} else {
			if (s) {
				s.destroy();	
			} 
		}
		
		jQuery('#loader').hide();

	});
	
	
	jQuery('#top-link').click(function(e) {
		e.preventDefault();
		jQuery('html, body').animate({scrollTop:0}, 1000);
	});

	jQuery('.screen-content a').click(function(e) {
		if (jQuery(this).attr('data-scroll-target')) {
			e.preventDefault();
			var selected_screen = jQuery(this).attr('data-scroll-target');
			scrollToAnchor(selected_screen);
		}
	});
	
	// wrap rss widgets
	jQuery('.widget_rss > ul > li, .widget_categoryposts > ul > li').wrapInner('<div class="inner-post" />');
	
	// style mini search widget
	if (jQuery('#jbspan').length) {
		var styleJbSearch = setInterval(function() {
			
			if (jQuery('.jbForm').length) {
				clearInterval(styleJbSearch);
				jQuery('.jbfrow').addClass('form-group');
				jQuery('.jbfrow input, .jbfrow select').addClass('form-control');
				jQuery('.jbfrow button').addClass('btn btn-primary');
				jQuery('#jbspan').css('background', 'none');
			}
			
		}, 500);
	}
	
	// init skrollr
	if (jQuery(window).width() > 1024) {
		var s = skrollr.init({
			forceHeight: false
		});
	}
	
	// add column classes to display posts
	jQuery('.screen:not(.screen-divider) .display-posts-listing').each(function(index, element) {
		jQuery(this).addClass('row');
		var listing_items = jQuery(element).children('.listing-item').length;
		if (listing_items === 2) {
			jQuery(element).children('.listing-item').addClass('col-sm-6');	
		} else if (listing_items === 3 || listing_items === 6) {
			jQuery(element).children('.listing-item').addClass('col-sm-4');	
		} else if (listing_items === 4 || listing_items === 8) {
			jQuery(element).children('.listing-item').addClass('col-sm-3');	
		}
	});
	
	// add column classes to SEO links
	var seo_link_columns = jQuery('.widget.seo-links').length;
	if (seo_link_columns === 2) {
		jQuery('.widget.seo-links').addClass('col-sm-6');	
	} else if (seo_link_columns === 3) {
		jQuery('.widget.seo-links').addClass('col-sm-4');	
	} else if (seo_link_columns === 4) {
		jQuery('.widget.seo-links').addClass('col-sm-3');	
	}
	
	// adjust body class for modals
	jQuery('.sub-modal').on('shown.bs.modal', function (e) {
		jQuery('body').addClass('modal-shown');
	});
	jQuery('.sub-modal').on('hidden.bs.modal', function (e) {
		jQuery('body').removeClass('modal-shown');
	});

	// counters
	if (jQuery(window).width() > 1024) {
		jQuery('.stat .counter').css('opacity', '0');

		jQuery('#stat1').waypoint({
			triggerOnce: true,
			offset: '80%',
			handler: function(direction) {
				initCounters();
			}
		});

		function initCounters() {
			jQuery('.stat .counter').css('opacity', '1').each(function(index, element) {
				jQuery({ Counter: 0 }).animate({ Counter: jQuery(element).text() }, {
					duration: 2000,
					step: function () {
						jQuery(element).text(Math.ceil(this.Counter));
					}
				});
			});
		}
	}

	// jb icons
	jQuery('.hmg-jb .btn-primary .icon-white').removeClass('icon-white');
	
});

// On Load
jQuery(window).load(function() {
	jQuery('#loader').fadeOut('fast');
	
	if(window.location.hash) {
		var hash = window.location.hash;
		scrollToAnchor(hash);
	}
});