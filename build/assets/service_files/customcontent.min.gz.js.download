var SvgLoader=Backbone.View.extend({initialize:function(t,e){this.svgID=t,this.type=e},loadSVG:function(t,e){var i=(this.type===SymbolType.SHAPE?URLPaths.SVG_SHAPE_URL:URLPaths.SVG_ICON_URL)+this.svgID+".svg?t="+LinkIconVersion;$.ajax({url:i,dataType:"text",success:function(i){e&&"function"==typeof e&&e.call(t,i)}})}});SvgLoader.loadedIcons=null,SvgLoader.loadedShapes=null,SvgLoader.addLoadedIcon=function(t,e){SvgLoader.loadedIcons[t]=e},SvgLoader.addLoadedShape=function(t,e){SvgLoader.loadedShapes[t]=e},SvgLoader.getLoadedIcons=function(){return SvgLoader.loadedIcons||(SvgLoader.loadedIcons=SvgLoader.getLoadedSvgs("icons")),SvgLoader.loadedIcons},SvgLoader.getLoadedShapes=function(){return SvgLoader.loadedShapes||(SvgLoader.loadedShapes=SvgLoader.getLoadedSvgs("shapes")),SvgLoader.loadedShapes},SvgLoader.getLoadedSvgs=function(t){var e=FSWidgetModel.gi(),i="function"==typeof window[t+"_"+e.get("collectionHash")]?window[t+"_"+e.get("collectionHash")]():{};return e.get("isDownload")?i:{}};var LinkAction={GO_TO_URL:0,GO_TO_PREV_PAGE:1,GO_TO_NEXT_PAGE:2,GO_TO_FIRST_PAGE:3,GO_TO_LAST_PAGE:4,GO_TO_PAGE:5,SPOTLIGHT:30,POPUP_FRAME:31,CHARTS_LINE:32,CHARTS_BAR:33,CHARTS_PIE:34,PHOTO_SLIDESHOW:37,DOWNLOAD_PDF:6,GO_TO_FLIPSNACK_PROFILE:7,SEND_EMAIL:8,BLANK:9,VIDEO:10,AUDIO:11,CAPTION:12,PAYPAL:13,FORM:14,SHAPE:15,IMAGE:16,LIST:17,VIDEO_WIDGET:23,TAG:24,EMBED:101},PremiumTypeLinks=[23,29,30,31,32,33,34,35,46,48],PremiumActionLinks=[6],FEATURES={WIDGET_MEDIA:"WIDGET_MEDIA",DOWNLOAD_PDF:"DOWNLOAD_PDF",WIDGET_FORMS:"WIDGET_FORMS",WIDGET_TAGS:"WIDGET_TAGS",EMBED:"EMBED",PRODUCT_TAG:"PRODUCT_TAG",POPUP_FRAME:"POPUP_FRAME",CHARTS:"CHARTS",SLIDESHOW:"SLIDESHOW",PHOTO_SLIDESHOW:"PHOTO_SLIDESHOW",ADD_TO_CART:"ADD_TO_CART",SPOTLIGHT:"SPOTLIGHT"},ElementActionToFeature={6:FEATURES.DOWNLOAD_PDF,10:FEATURES.WIDGET_MEDIA,11:FEATURES.WIDGET_MEDIA,23:FEATURES.WIDGET_MEDIA,14:FEATURES.WIDGET_FORMS,24:FEATURES.WIDGET_TAGS,12:FEATURES.WIDGET_TAGS,29:FEATURES.PRODUCT_TAG,35:FEATURES.ADD_TO_CART,36:FEATURES.ADD_TO_CART,32:FEATURES.CHARTS,33:FEATURES.CHARTS,34:FEATURES.CHARTS,31:FEATURES.POPUP_FRAME,101:FEATURES.EMBED,103:FEATURES.SLIDESHOW,30:FEATURES.SPOTLIGHT},TagType={VIDEO:0,IMAGE:1,LINK:2,TEXT:3},EDITOR_DEFAULTS={width:735,height:682,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_FONT_SIZE:12,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_WIDTH:46,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_HEIGHT:24,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_ICON_SIZE:.45,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_MARGIN_RIGHT:8,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_MARGIN_LEFT:3.5,CUSTOM_BUTTON_WITH_LABEL_DEFAULT_PADDING_LEFT:2.4,CUSTOM_BUTTON_WITH_NEW_LABEL_DEFAULT_FONT_SIZE:9},ImageElementType={UPLOAD:"upload",TEXTURE:"texture",STOCK:"stock",COLOR:"color"},ImageElementScale={NONE:"none",SCALE_CROP:"scaleCrop",SCALE:"scale",TILE:"tile"},SymbolType={SHAPE:"svg",ICON:"icon"},VIDEO_POPIN_DEFAULTS={WIDTH:1280,HEIGHT:720,MARGINS:44},PhotoProviders={COLLECTION:"collection",UNSPLASH:"unsplash",PEXELS:"pexels",PIXABAY:"pixabay",EXTERNAL:"external"},VideoProviders={PEXELS:"pexels",PIXABAY:"pixabay"},LinkIconVersion="15",InteractOptions={LINK:"link",PAGE:"page",POPIN:"popin"},InteractionPopinTrigger={CLICK:"click",HOVER:"hover"},InteractionPopinPosition={TOP_LEFT:"top-left",TOP:"top",TOP_RIGHT:"top-right",RIGHT:"right",BOTTOM_RIGHT:"bottom-right",BOTTOM:"bottom",BOTTOM_LEFT:"bottom-left",LEFT:"left"},InteractionPopinContent={TITLE_FONT_SIZE:16,DESCRIPTION_FONT_SIZE:14,DESCRIPTION_MARGIN:10,CONTENT_PADDING:15,MARGIN:7},GoToActions={GO_TO_PREV_PAGE:"previous",GO_TO_NEXT_PAGE:"next",GO_TO_FIRST_PAGE:"first",GO_TO_LAST_PAGE:"last",GO_TO_PAGE:"custom"},TEXT_WRAP_TYPES={WRAP:"wrap",CLIP:"clip"},PlayerIconButton={fontSize:11,fontScaleFactor:26,iconScaleFactor:46,iconLeftRightMargin:7},CustomContentEvent={GO_TO_URL:"goToUrl",PAYPAL_POPIN:"paypalPopin",SHOW_CUSTOM_TOOLTIP:"showCustomTooltip",HIDE_CUSTOM_TOOLTIP:"hideCustomTooltip",MOVE_CUSTOM_TOOLTIP:"moveCustomTooltip",PLAY_AUDIO:"playAudio",STOP_AUDIO:"stopAudio",AUDIO_STARTED:"audioStarted",AUDIO_STOPPED:"audioStopped",CAPTION_OPENED:"captionOpened",CAPTION_CLOSED:"captionClosed",CUSTOM_CONTENT_CLICK:"customContentClick",VIDEO_EMBED_SIZE:"videoEmbedSize",SHOW_CUSTOM_INTERACTION_POPIN:"showCustomInteractionPopin",HIDE_CUSTOM_INTERACTION_POPIN:"hideCustomInteractionPopin",TOGGLE_CUSTOM_INTERACTION_POPIN:"toggleCustomInteractionPopin",CUSTOM_INTERACTION_POPIN_DISPLAYED:"customInteractionPopinDisplayed",CUSTOM_INTERACTION_POPIN_HIDDEN:"customInteractionPopinHidden"},CustomContentTemplates={button:'<a class="btn" rel="nofollow noopener"><div class="ico" /><div class="label" /></a><div class="hover" />',videoIframe:'<% if (src) { %><% if ((provider === "youtube") || (provider === "vimeo")) { %><iframe style="display: block" src="<%= src %>" frameborder="0" <% if (width) { %>width="<%= width %>"<% } %><% if (height) { %>height="<%= height %>"<% } %>></iframe><% } else { %><video <%= params %> src="<%= src %>" poster="<%= poster %>" disablepictureinpicture controlslist="nodownload" <% if (width) { %>width="<%= width %>"<% } %><% if (height) { %>height="<%= height %>"<% } %>/><% } %><% } %>',text:'<a class="no-decoration" rel="nofollow noopener"><div class="inner"><%- text %></div></a>',textBox:'<a class="no-decoration" rel="nofollow noopener"><div class="inner"><%= textContent %></div></a>',shape:'<a rel="nofollow noopener"><div style=""></div></a>',interaction:'<a class="interaction-link" rel="nofollow noopener" />',tag:'<div class="tag"><div class="color-ring" /><img class="image" /><iframe class="video" /></div>',productTag:'<div class="tag product-tag"><div class="color-ring"><div class="inner-tag" /></div></div>',tagTooltip:'<div class="content"><div class="content-media"><div class="tooltip-img"><img /><div class="play-btn"><div /></div></div><div class="tooltip-title" /></div><div class="content-text"><div class="tooltip-text" /><div class="tooltip-link"><a rel="nofollow noopener" /></div></div></div><div class="arrow" />',hiperLink:'<div class="hiperlink" />',tooltip:'<div class="content"><span class="tooltip-text"><%- tooltipText %></span></div>',galleryItem:"<div></div>",paypalPopin:'<div class="content"><div class="slideshow"><div class="slider"></div><a class="prev"></a><a class="next"></a></div><div class="info"><div class="popin-title shortTitle"><%- item_name %></div><div class="popin-title longTitle"><%- item_name %></div><div class="price"><label>Price:</label> <b><%- currencySign %><%- price %></b></div><div class="stock"><span class="success">In stock</span><span class="error">Out of stock</span></div><div class="description"><%- item_description %></div><form class="orderForm" action=""><label>Quantity:</label><input class="input-text quantity" type="number" value="1" min="1" name="quantity"><span class="error smaller-text quantityError">Quantity must be 1 or greater.</span></form><div class="shippingCost">Shipping cost not included.</div><div class="paypalDelivery">Delivery time: <%- delivery %> days.</div><div><a class="btn-contact">Contact seller</a><a class="btn-paypal"></a></div></div></div><form class="content gray contact-form"><div class="title">Contact seller</div><div class="row"><div class="col col1"><label>Your email:</label></div><div class="col col2"><input type="text" class="emailAddress" name="email" value="" placeholder="name@address.com"></div><div class="col col3 smaller-text"><span class="error emailAddressError">Invalid email address.</span></div></div><div class="row"><div class="col col1"><label>Message:</label></div><div class="col col2"><textarea class="mailMessage" placeholder="Message goes here..."></textarea></div><div class="col col3 smaller-text"><span class="error mailMessageError">Specify message.</span></div></div><div class="infoMessageSent smaller-text success">Message sent</div><a class="btn sendMail">SEND</a></form>',embedPlaceHolder:'<div class="embed-icon"><svg xmlns="http://www.w3.org/2000/svg" width="54" height="40" viewBox="0 0 54 40"><path fill="#6F7685" fill-rule="evenodd" d="M6.963 20.053L18 25.349v7.378L0 23.11v-6.218l18-9.618v7.378L6.963 20.053zM24.28 40H18L29.824 0H36L24.28 40zm22.488-20.053L36 14.598V7.273l18 9.618v6.192l-18 9.644v-7.352l10.768-5.428z"/></svg></div>',embedIframe:'<iframe width="100%" height="100%" type="text/html" sandbox="allow-popups allow-scripts allow-same-origin allow-presentation allow-forms" src="<%- baseUrl %><%- htmlSources %>iframeContainer.html?iframe=<%- content %>" frameborder="0" fs="0"></iframe>',interactionPopin:'<div class="content"><div class="interaction-popin-title"><%- interaction.title %></div><div class="interaction-popin-description"><%= interaction.description.encodeHTML() %></div><div class="interaction-popin-img"><img /><div class="play-btn"><div /></div></div><div class="interaction-popin-video" /></div>',table:'<table class="table"><%= tableBody %></table>',slideshowPlaceHolder:'<div class="slideshow-empty"><div class="slideshow-icon"><svg xmlns="http://www.w3.org/2000/svg" width="155" height="150" viewBox="0 0 155 150"><path d="M55 120a7.5 7.5 0 1 0 0-15 7.5 7.5 0 0 0 0 15zM61.92 76.833a6.243 6.243 0 0 1 0 8.838 6.235 6.235 0 0 1-4.419 1.83c-1.6 0-3.2-.612-4.418-1.83l-18.75-18.75a6.243 6.243 0 0 1 0-8.838l18.75-18.75a6.243 6.243 0 0 1 8.838 0 6.243 6.243 0 0 1 0 8.837L47.589 62.501l14.332 14.332zM77.5 120a7.5 7.5 0 1 0 0-15 7.5 7.5 0 0 0 0 15zM100 120a7.5 7.5 0 1 0 0-15 7.5 7.5 0 0 0 0 15zM121.92 66.92l-18.75 18.75a6.235 6.235 0 0 1-4.419 1.831c-1.6 0-3.2-.612-4.418-1.83a6.243 6.243 0 0 1 0-8.838l14.331-14.332-14.331-14.33a6.243 6.243 0 0 1 0-8.838 6.243 6.243 0 0 1 8.838 0l18.75 18.75a6.243 6.243 0 0 1 0 8.838z"/><path d="M133.75 150H21.25c-10.337 0-18.75-8.412-18.75-18.75V18.75C2.5 8.413 10.913 0 21.25 0h112.5c10.338 0 18.75 8.413 18.75 18.75v112.5c0 10.338-8.412 18.75-18.75 18.75zM25 15c-3.45 0-7.5 4.056-7.5 7.5v105c0 3.444 4.05 7.5 7.5 7.5h105c3.45 0 7.5-4.056 7.5-7.5v-105c0-3.444-4.05-7.5-7.5-7.5H25z"/></svg></div></div>',slideshow:'<div class="slideshow-element" />',cart:'<div class="cart-element"><% if (hasSvg) { %><div class="cart-svg"><svg width="100%" height="100%" viewBox="0 0 16 20" xmlns="http://www.w3.org/2000/svg"> <path d="M14 4H12C12 1.79 10.21 0 8 0C5.79 0 4 1.79 4 4H2C0.9 4 0 4.9 0 6V18C0 19.1 0.9 20 2 20H14C15.1 20 16 19.1 16 18V6C16 4.9 15.1 4 14 4ZM8 2C9.1 2 10 2.9 10 4H6C6 2.9 6.9 2 8 2ZM14 18H2V6H4V8C4 8.55 4.45 9 5 9C5.55 9 6 8.55 6 8V6H10V8C10 8.55 10.45 9 11 9C11.55 9 12 8.55 12 8V6H14V18Z" /></svg></div><% } %><div class="shopping-label"><%= buttonLabel %></div></div>'},CustomContentView=Backbone.View.extend({className:"custom-content",initialize:function(){this.elements=[],this.audioPlayer=null,this.listenTo(this.model,"change",this.onModelChange),this.countLoadedElements=0,this.customInteractionPopin=null,this.isDoublePageLayout=FSWidgetModel.gi().flipCollection.get("isDoublePageLayout"),this.isSinglePageLayout=FSWidgetModel.gi().widgetSettings.get("contentLayout")===ContentLayout.SINGLE_PAGE,this.isSmartViewLayout=FSWidgetModel.gi().widgetSettings.get("contentLayout")===ContentLayout.SMART_VIEW,this.offsetX=0,this.offsetY=0,Backbone.Mediator.sub("click",this.hideCustomInteractionPopin,this)},render:function(){var t,e,i=this.model.attributes,o=this,s=this.model.get("oldEditorScaling"),n=!1,a=this.model.get("pageWidth")/this.model.get("pageModel").get("width"),l={},d=this.calculatePageValues();return this.setPosition(),_.each(i.elements,(function(h,r){var c=FSWidgetModel.gi().get("collectionData").publisher,g=FSWidgetModel.gi().get("premiumLayouts"),m=h.pid||i.pageModel.get("pID");(h.provider||FSUtils.hasAccessToElement(h,FSWidgetModel.gi().get("collectionData").features)&&(!h.layoutID||FSUtils.elementCanBeDisplayed(h.layoutID,g,c)))&&(h.elementPageIndex=i.page,h.pid=m,h.index=r,h.scale=i.scale,h.oldEditorScaling=s,h.currentPageWidth=d.currentPageWidth,h.currentPageHeight=d.currentPageHeight,h.pageOffset={x:o.offsetX,y:o.offsetY},h.pageNumber=o.model.get("page")+1,h.sourcePage===SourcePage.LEFT&&d.leftPageData&&(h.leftPageData={offset:d.leftPageOffset,size:d.leftPageSize},h.scale=d.leftPageData.scale,h.oldEditorScaling=d.leftPageData.oldEditorScaling),h.sourcePage===SourcePage.RIGHT&&d.rightPageData&&(h.rightPageData={offset:d.rightPageOffset,size:d.rightPageSize},h.scale=d.rightPageData.scale,h.oldEditorScaling=d.rightPageData.oldEditorScaling),d.leftPageData&&(h.leftPageWidth=d.leftPageSize.width*d.leftPageData.scale),(t=o.generateElement(h,i.imageElements))&&(o.elements.push(t),o.$el.append(t.render().$el),l=_.extend({realScale:a},t.model.attributes),(e=o.setInteraction(l))&&(o.elements.push(e),o.$el.append(e.render().$el),t.model.attributes.interaction.interactionType===InteractOptions.POPIN&&(n=!0),n&&(o.listenTo(e,CustomContentEvent.SHOW_CUSTOM_INTERACTION_POPIN,o.showCustomInteractionPopin),o.listenTo(e,CustomContentEvent.HIDE_CUSTOM_INTERACTION_POPIN,o.hideCustomInteractionPopin),o.listenTo(e,CustomContentEvent.TOGGLE_CUSTOM_INTERACTION_POPIN,o.toggleCustomInteractionPopin)))))})),n&&(this.customInteractionPopin=new InteractionPopin({model:new InteractionPopinModel}),this.$el.append('<div class="interaction-popin-container" />'),this.$el.find(".interaction-popin-container").append(this.customInteractionPopin.render().$el)),0===i.imageElements&&this.displayPageElements(ContentLoaderStatus.COMPLETE),this},displayPageElements:function(t){t!==ContentLoaderStatus.COMPLETE&&t!==ContentLoaderStatus.ERROR||this.model.set("status",ContentLoaderStatus.COMPLETE)},onModelChange:function(){this.setPosition()},setPosition:function(){var t=FSUtils.calculateScaledSize(this.model.get("pageModel").get("width"),this.model.get("pageModel").get("height"),this.model.get("pageWidth"),this.model.get("pageHeight"),!0);this.offsetX=(this.model.get("pageWidth")-t.width)/2,this.offsetY=(this.model.get("pageHeight")-t.height)/2;var e={width:t.width+"px",height:t.height+"px",top:(this.model.get("pageHeight")-t.height)/2+"px",left:(this.model.get("pageWidth")-t.width)/2+"px"};this.$el.css(e)},setInteraction:function(t){if(t.interaction&&t.interaction.interactionType)return new InteractionView({model:new InteractionModel(t)})},generateElement:function(t,e){var i=!1;switch(t.type){case ElementType.FORM:case ElementType.GROUP:break;case ElementType.TAG:t.tagType=parseInt(t.tagType,10),i=new TagView({model:new ButtonModel(t)});break;case ElementType.VIDEO:i=new VideoWidgetView({model:new ButtonModel(t)});break;case ElementType.PLAY:i=new VideoButtonView({model:new ButtonModel(t)});break;case ElementType.TEXT:i=new TextView({model:new TextModel(t)});break;case ElementType.TEXT_BOX:i=new TextBoxView({model:new TextBoxModel(t)});break;case ElementType.SHAPES:i=new ShapeView({model:new ButtonModel(t)});break;case ElementType.IMAGE:var o=new ImageElementModel(t);this.listenTo(o,"change:status",(function(){this.countLoadedElements++,this.countLoadedElements===e&&this.displayPageElements(o.get("status"))})),i=new ImageElementView({model:o});break;case ElementType.AUDIO:i=new AudioButton({model:new ButtonModel(t)}),this.audioPlayer=AudioPlayer.gi();break;case ElementType.MASKED:i=new ImageMaskView({model:new ImageMaskModel(t)});break;case ElementType.EMBED:i=new EmbedElemetView({model:new EmbedElementModel(t)});break;case ElementType.PRODUCT_TAG:i=new ProductTagView({model:new ProductTagModel(t)});break;case ElementType.TABLE:i=new TableView({model:new TableModel(t)});break;case ElementType.SLIDESHOW:i=new SlideshowView({model:new SlideshowModel(t)});break;case ElementType.ADD_CART:case ElementType.CART_HYPERLINK:i=new CartView({model:new CartModel(t)});break;case ElementType.POPUP_FRAME:i=new PopupFrame({model:new PopupFrameModel(t)});break;default:if(FSWidgetModel.gi().get("isDownload")&&_.contains([ElementType.PAYPAL,ElementType.PAYPAL_TOOLTIP],t.type))break;t.username=FSWidgetModel.gi().get("userProfile"),i=new CustomButton({model:new ButtonModel(t)})}return i},hide:function(){this.$el.hide()},resize:function(t){if(this.model.get("scale")!==t){var e=this,i=this.model.get("pageWidth")/this.model.get("pageModel").get("width"),o=this.calculatePageValues();this.model.set({currentPageWidth:this.model.get("pageWidth"),currentPageHeight:this.model.get("pageHeight"),scale:t}),_.each(this.elements,(function(s){var n=s.model.get("interaction"),a=t;s.model.set({currentPageWidth:e.model.get("pageWidth"),currentPageHeight:e.model.get("pageHeight"),pageOffset:{x:e.offsetX,y:e.offsetY}}),s.model.get("sourcePage")===SourcePage.LEFT&&o.leftPageData&&(a=o.leftPageData.scale,s.model.set({oldEditorScaling:o.leftPageData.oldEditorScaling,leftPageData:{offset:o.leftPageOffset,size:o.leftPageSize}})),s.model.get("sourcePage")===SourcePage.RIGHT&&o.rightPageData&&(a=o.rightPageData.scale,s.model.set({oldEditorScaling:o.rightPageData.oldEditorScaling,rightPageData:{offset:o.rightPageOffset,size:o.rightPageSize}})),s.resize(a),n&&(s.model.set("realScale",i,{silent:!0}),n.interactionType===InteractOptions.POPIN&&e.customInteractionPopin&&s.cid===e.customInteractionPopin.model.get("cid")&&e.customInteractionPopin.model.set({realScale:i,scale:a,x:s.model.get("x"),y:s.model.get("y"),w:s.model.get("w"),h:s.model.get("h")}))}))}},remove:function(){_.each(this.elements,(function(t){t.remove()})),this.elements=[],this.countLoadedElements=0,this.customInteractionPopin&&(this.customInteractionPopin.remove(),this.customInteractionPopin=null),Backbone.View.prototype.remove.apply(this,arguments)},empty:function(){this.$el.empty()},delegateEvents:function(){Backbone.View.prototype.delegateEvents.apply(this,arguments),_.each(this.elements,(function(t){t.delegateEvents()}))},start:function(t){var e,i=0,o=this.elements.length;switch(t=t||"turning"){case"turning":break;case"end":this.delegateEvents()}for(;i<o;i++)"function"==typeof(e=this.elements[i]).start&&e.start(t)},stop:function(){for(var t,e=0,i=this.elements.length;e<i;e++)"function"==typeof(t=this.elements[e]).stop&&t.stop()},showCustomInteractionPopin:function(t){this.customInteractionPopin&&(this.customInteractionPopin.model.get("isDisplayed")&&this.customInteractionPopin.model.get("cid")!==t.cid&&this.customInteractionPopin.hide(),this.customInteractionPopin.model.get("isDisplayed")||(this.customInteractionPopin.model.set(t),this.customInteractionPopin.show()))},hideCustomInteractionPopin:function(){this.customInteractionPopin&&this.customInteractionPopin.hide()},toggleCustomInteractionPopin:function(t){this.customInteractionPopin&&(this.customInteractionPopin.model.get("isDisplayed")&&this.customInteractionPopin.model.get("cid")===t.cid?this.customInteractionPopin.hide():(this.customInteractionPopin.model.set(t),this.customInteractionPopin.show()))},calculatePageValues:function(){var t,e,i,o,s=this.model.get("firstPageWidth"),n=this.model.get("firstPageHeight"),a=this.model.get("pageModel").get("width"),l=this.model.get("pageModel").get("height"),d=this.model.get("pageWidth"),h=this.model.get("pageHeight"),r=this.model.get("leftPageModel"),c=this.model.get("rightPageModel");if(s!==a||n!==l){var g=FSUtils.calculateScaledSize(a,l,d,h,!0);this.offsetX=(d-g.width)/2,this.offsetY=(h-g.height)/2}if(r){var m=r.pageModel.get("width"),p=r.pageModel.get("height"),u=r.pageWidth,f=r.pageHeight;t={x:(u-(e=FSUtils.calculateScaledSize(m,p,u,f,!0)).width)/2*r.widgetZoom,y:(f-e.height)/2*r.widgetZoom},e={width:e.width*r.widgetZoom,height:e.height*r.widgetZoom}}else if(c){var E=c.pageModel.get("width"),T=c.pageModel.get("height"),S=c.pageWidth,I=c.pageHeight;i={x:(S-(o=FSUtils.calculateScaledSize(E,T,S,I,!0)).width)/2*c.widgetZoom,y:(I-o.height)/2*c.widgetZoom},o={width:o.width*c.widgetZoom,height:o.height*c.widgetZoom}}return{currentPageHeight:h,currentPageWidth:d,leftPageSize:e,rightPageSize:o,leftPageOffset:t,rightPageOffset:i,leftPageData:r,rightPageData:c}}});Backbone.Mediator.pub(WidgetEvent.CUSTOM_VIEW_LOADED);var CustomContentModel=Backbone.Model.extend({defaults:{scale:1,oldEditorScaling:1,type:0,x:0,y:0,w:0,h:0,ox:0,oy:0,ow:0,oh:0,status:ContentLoaderStatus.IDLE,sourcePage:"",pageWidth:0,offset:0,pageOffset:{x:0,y:0}},initialize:function(){var t=this.get("bounds").split(",");this.set({ox:parseFloat(t[0]),oy:parseFloat(t[1]),ow:parseFloat(t[2]),oh:parseFloat(t[3])},{silent:!0}),this.setBounds(),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.setBounds,this)},setBounds:function(){var t={x:this.get("ox")*this.get("scale"),y:this.get("oy")*this.get("scale"),w:this.get("ow")*this.get("scale"),h:this.get("oh")*this.get("scale")},e=this.get("sourcePage");this.get("leftPageWidth")&&this.set("offset",-this.get("leftPageWidth")),e&&(e===SourcePage.LEFT&&this.get("leftPageData")?(t.x=this.get("ox")*this.get("scale")-this.get("pageOffset").x-this.get("leftPageData").size.width-this.get("leftPageData").offset.x,t.y=this.get("oy")*this.get("scale")-this.get("pageOffset").y+this.get("leftPageData").offset.y):e===SourcePage.RIGHT&&this.get("rightPageData")&&(t.x=this.get("currentPageWidth")+this.get("pageOffset").x+this.get("rightPageData").offset.x+this.get("ox")*this.get("scale"),t.y=this.get("oy")*this.get("scale")-this.get("pageOffset").y+this.get("rightPageData").offset.y),this.set("offset",-this.get("currentPageWidth"))),this.set(t)},destroy:function(){Backbone.Mediator.unsubscribe(WidgetEvent.RESIZE,this.setBounds,this)}}),ButtonModel=CustomContentModel.extend({defaults:{scale:1,oldEditorScaling:1,action:0,tooltip:!1,label:!1,color:"807F7D",alpha:1,url:"",icon:!1,state:"default",rotation:0,radius:DEFAULT_BORDER_RADIUS}}),CaptionModel=Backbone.Model.extend({defaults:{scale:1,textPosition:"left",x:0,y:0,w:0,h:0,tw:0,th:0,otw:0,oth:0},initialize:function(){var t=this.get("textboxSize").split(",");this.set("otw",t[0]),this.set("oth",t[1]),this.setBounds(),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.setBounds,this)},setBounds:function(){this.set("tw",this.get("otw")*this.get("scale")),this.set("th",this.get("oth")*this.get("scale"))},destroy:function(){Backbone.Mediator.unsubscribe(WidgetEvent.RESIZE,this.setBounds,this)}}),CartModel=CustomContentModel.extend({defaults:{}}),ImageElementModel=ButtonModel.extend({defaults:_.extend({},ButtonModel.prototype.defaults,{src:"",subType:ImageElementType.UPLOAD,scaleMode:ImageElementScale.SCALE_CROP,rotation:0,radius:DEFAULT_BORDER_RADIUS,status:ContentLoaderStatus.IDLE}),getImageURL:function(t,e){var i="",o=FSWidgetModel.gi().get("accountId"),s=FSUtils.getUserExternalLibraryURL(o);switch(e){case ImageElementType.UPLOAD:i=URLPaths.HYPERLINK_UPLOADED_IMAGES_PATH+t;break;case ImageElementType.STOCK:i=this.get("provider")?this.get("provider")===PhotoProviders.EXTERNAL?s+t:URLPaths.HYPERLINK_PROVIDERS_IMAGES_PATH+t:URLPaths.HYPERLINK_STOCK_IMAGES_PATH+t;break;default:i=URLPaths.HYPERLINK_TEXTURE_IMAGES_PATH+t}return i}}),ImageMaskModel=ImageElementModel.extend({defaults:_.extend({},ImageElementModel.prototype.defaults,{shape:0,imageBounds:"",oimgx:0,oimgy:0,oimgw:0,oimgh:0,imgx:0,imgy:0,imgw:1,imgh:1}),initialize:function(){var t=this.get("imageBounds").split(",");this.set({oimgx:parseInt(t[0],10),oimgy:parseInt(t[1],10),oimgw:parseInt(t[2],10),oimgh:parseInt(t[3],10)},{silent:!0}),ImageElementModel.prototype.initialize.apply(this,arguments)},setBounds:function(){this.set({imgx:this.get("oimgx")*this.get("scale"),imgy:this.get("oimgy")*this.get("scale"),imgw:this.get("oimgw")*this.get("scale"),imgh:this.get("oimgh")*this.get("scale")}),ImageElementModel.prototype.setBounds.apply(this,arguments)}}),InteractionModel=CustomContentModel.extend({}),InteractionPopinModel=CustomContentModel.extend({defaults:{isDisplayed:!1},initialize:function(){this.processText(),this.listenTo(this,"change",this.processText)},processText:function(){var t=this.get("interaction");t&&t.description&&t.description.length&&(t.description=t.description.replace(/\n/gi,"<br>"),this.set("interaction",t,{silent:!0}))}}),EmbedElementModel=CustomContentModel.extend({defaults:{scale:1,action:101,alpha:1,rotation:0}}),TextModel=ButtonModel.extend({initialize:function(){this.set({oFontSize:this.get("fontSize"),lineHeight:this.get("lineHeight")||0===this.get("lineHeight")?this.get("lineHeight"):DEFAULT_TEXT_LINE_HEIGHT,letterSpacing:this.get("letterSpacing")||0===this.get("letterSpacing")?this.get("letterSpacing"):DEFAULT_TEXT_LETTER_SPACING},{silent:!0}),ButtonModel.prototype.initialize.apply(this,arguments)},setBounds:function(){ButtonModel.prototype.setBounds.apply(this,arguments),this.set({fontSize:this.get("oFontSize")*this.get("scale")})}}),TextBoxModel=TextModel.extend({setBounds:function(){ButtonModel.prototype.setBounds.apply(this,arguments),this.get("oFontSize")&&this.set({fontSize:this.get("oFontSize")})}}),ProductTagModel=CustomContentModel.extend({defaults:{action:29,color:"4e5565",alpha:1,rotation:0,title:"",description:"",price:"",discountPrice:"",url:"",buttonLabel:""}}),VideoEmbedModel=Backbone.Model.extend({defaults:{autoPlay:0,width:0,height:0,youtubeIframeURL:"https://www.youtube.com/embed/",youtubeVideoHash:"",youtubeVideoParams:"?wmode=opaque&fs=0",vimeoIframeUrl:"https://player.vimeo.com/video/",vimeoVideoID:"",vimeoVideoParams:"?api=1&player_id=fs_videoPlayerIframe_",mobile:0,poster:""},initialize:function(){this.set({cover:this.get("cover"),provider:FSUtils.getVideoProvider(this.get("url"),this.get("provider")),hash:FSUtils.getVideoHash(this.get("url")),extraParams:FSUtils.getVideoExtraParams(this.get("url")),autoPlay:FSUtils.getVideoParam(FSUtils.getVideoExtraParams(this.get("url")),"autoplay"),mobile:FSUtils.isMobileDevice()},{silent:!0}),this.set({src:this.getSrc(),params:this.getParamsForHtml5()},{silent:!0})},valid:function(){return this.get("provider")!==VideoProvider.YOUTUBE||this.get("provider")!==VideoProvider.VIMEO?this.has("src"):this.get("hash")&&this.get("hash").length>0&&this.has("src")&&!1!==this.get("src")},getParamsForHtml5:function(){var t,e,i="",o=0;return this.get("provider")===VideoProvider.YOUTUBE||this.get("provider")===VideoProvider.VIMEO?"":(t=FSUtils.getVideoExtraParams(this.get("url")).split("&"),e=["muted","loop","controls"],(!FSWidgetModel.gi().widgetSettings.get("exportVideo")||FSWidgetModel.gi().widgetSettings.get("exportVideo")&&this.isYoutubeOrVimeo())&&e.push("autoplay"),t.forEach((function(t){var s=t.split("=");e.includes(s[0])&&(o+=1,parseInt(s[1],10)>0&&(i+=s[0]+" "))})),o<4&&(i+=" controls"),i+=" playsinline")},getSrc:function(){var t="";switch(this.get("provider")){case VideoProvider.YOUTUBE:t=this.get("youtubeIframeURL")+this.get("hash")+this.get("youtubeVideoParams")+"&"+this.get("extraParams")+"&enablejsapi=1";break;case VideoProvider.VIMEO:t=this.get("vimeoIframeUrl")+this.get("hash")+this.get("vimeoVideoParams")+"&"+this.get("extraParams");break;case VideoProvider.OTHER:case VideoProvider.PIXABAY:case VideoProvider.PEXELS:t=this.get("url")}return!!t&&this.addAutoPlaySuffix(t)},addAutoPlaySuffix:function(t){var e=t;return FSWidgetModel.gi().widgetSettings.get("exportVideo")&&!this.isYoutubeOrVimeo()?e=this.removeAutoplayParamFromURL(e):1===parseInt(this.get("autoPlay"),10)&&(e+="&autoplay=1"),e},isYoutubeOrVimeo:function(){return this.get("provider")===VideoProvider.YOUTUBE||this.get("provider")===VideoProvider.VIMEO},removeAutoplayParamFromURL:function(t){var e=t;-1===e.indexOf("http://")&&-1===e.indexOf("https://")&&(e="https://"+e);var i=new URL(e);return i.searchParams.delete("autoplay"),i.toString()}}),TableModel=CustomContentModel.extend({defaults:{}}),SlideshowModel=CustomContentModel.extend({defaults:{loop:!1,hideBullets:!1,media:[],alpha:1}}),CustomTooltipView=Backbone.View.extend({template:_.template(CustomContentTemplates.tooltip),className:"custom-tooltip",initialize:function(){Backbone.Mediator.sub(CustomContentEvent.SHOW_CUSTOM_TOOLTIP,this.showTooltip,this),Backbone.Mediator.sub(CustomContentEvent.HIDE_CUSTOM_TOOLTIP,this.hideTooltip,this),Backbone.Mediator.sub(CustomContentEvent.MOVE_CUSTOM_TOOLTIP,this.moveTooltip,this),Backbone.Mediator.sub(WidgetEvent.PAGE_CHANGED,this.hideTooltip,this),Backbone.Mediator.sub(WidgetEvent.ITEM_CHANGED,this.hideTooltip,this)},render:function(t){return t?this.$el.html(t.encodeHTML()):this.$el.html(t),this},showTooltip:function(t){this.render(t),this.$el.show()},hideTooltip:function(){this.$el.hide()},moveTooltip:function(t){var e=$("#docView");this.$el.css({top:t.pageY+20,left:t.pageX+15}),this.$el.offset().top+this.$el.outerHeight()>e.offset().top+e.outerHeight()&&this.$el.css({top:t.pageY-this.$el.outerHeight()-20}),this.$el.offset().left+this.$el.outerWidth()>e.offset().left+e.outerWidth()&&this.$el.css({left:t.pageX-this.$el.outerWidth()-15})}}),GalleryImage=Backbone.View.extend({initialize:function(t){this.src=t},render:function(){return this.$el.css({backgroundImage:"url("+this.src+")"}),this}}),PaypalPopin=Backbone.View.extend({template:_.template(CustomContentTemplates.paypalPopin),className:"paypal-content",events:{"click .btn-contact":"showContactForm","click .sendMail":"sendMail","click .prev":"prevImg","click .next":"nextImg","change .quantity":"checkQuantity","change .emailAddress":"checkEmailAddress","change .mailMessage":"checkMailMessage","keydown .quantity":"onKeyDownQuantity","focus .emailAddress":"onFocusEmailAddress","focus .mailMessage":"onFocusMailMessage","keydown .emailAddress":"onKeyDown","keydown .mailMessage":"onKeyDown","click .btn-paypal":"sendPaypalRequest"},initialize:function(t){this.attributes=t,this.listenTo(FSWidgetModel.gi().widgetState,"change:displayState",this.onExitFullScreen)},render:function(){switch(this.attributes.currency){case"EUR":this.attributes.currencySign="€";break;case"GBP":this.attributes.currencySign="£";break;default:this.attributes.currencySign="$"}return this.$el.html(this.template(this.attributes)),this.attributes.stock>0?(this.$el.find(".stock .error").hide(),this.$el.find(".stock .success").show()):(this.$el.find(".stock .error").show(),this.$el.find(".stock .success").hide()),1!==parseInt(this.attributes.contact,10)&&this.$el.find(".btn-contact").addClass("hidden"),this.sellerEmail=this.attributes.business,this.productName=this.attributes.item_name,this.price=this.attributes.price,this.currency=this.attributes.currency,this.paypalHash=this.attributes.hash,this.quantity=1,this.error=!1,this.setGallery(),this},setGallery:function(){var t,e,i,o=this.$el.find(".slider");if(void 0!==this.attributes.images&&0!==this.attributes.images.length&&(t=this.attributes.images.split(","),this.imagesCount=t.length,this.currentImage=1,this.imagesCount>0)){for(o.css({width:100*this.imagesCount+"%"}),i=0;i<this.imagesCount;i++)e=new GalleryImage(FlipSnackEmbed.urls.uploadPath+t[i]),o.append(e.render().$el);this.imagesCount>1&&this.$el.find("a").show()}},prevImg:function(){this.currentImage>1&&(this.currentImage--,this.$el.find(".slider").animate({left:this.$el.find(".slideshow").width()*(this.currentImage-1)*-1}),this.$el.find(".next").css({opacity:1}),1===this.currentImage&&this.$el.find(".prev").css({opacity:.4}))},nextImg:function(){this.currentImage<this.imagesCount&&(this.currentImage++,this.$el.find(".slider").animate({left:this.$el.find(".slideshow").width()*(this.currentImage-1)*-1}),this.$el.find(".prev").css({opacity:1}),this.currentImage===this.imagesCount&&this.$el.find(".next").css({opacity:.4}))},setContent:function(t){},showModal:function(){Backbone.Mediator.pub(WidgetEvent.POPIN_OPEN,this.render().el)},showContactForm:function(){this.$el.find(".contact-form").slideToggle()},sendMail:function(){var t,e=this.checkEmailAddress(),i=this.checkMailMessage();e&&i&&(Backbone.Mediator.pub(WidgetEvent.SEND_SQS_MAIL,{fromEmail:this.$el.find(".emailAddress").val(),message:this.$el.find(".mailMessage").val(),toEmail:this.attributes.business,productName:this.attributes.item_name,collectionHash:FSWidgetModel.gi().get("collectionHash"),collectionTitle:FSWidgetModel.gi().get("collectionData").title}),this.$el.find(".infoMessageSent").show(),t=this.$el.find(".contact-form"),setTimeout((function(){t.slideUp(),t.find(".infoMessageSent").hide(),t.find(".mailMessage").val("")}),1e3))},checkEmailAddress:function(){var t=this.$el.find(".emailAddress").val();return t&&t.length>0&&FSUtils.isEmailValid(t)?(this.$el.find(".emailAddress").removeClass("error"),this.$el.find(".emailAddressError").hide(),!0):(this.$el.find(".emailAddress").addClass("error"),this.$el.find(".emailAddressError").show(),!1)},checkMailMessage:function(){var t=this.$el.find(".mailMessage").val();return t&&t.length>0?(this.$el.find(".mailMessage").removeClass("error"),this.$el.find(".mailMessageError").hide(),!0):(this.$el.find(".mailMessage").addClass("error"),this.$el.find(".mailMessageError").show(),!1)},checkQuantity:function(){var t,e,i=this.$el.find(".quantity"),o=this.$el.find(".quantityError"),s=this.$el.find(".orderForm"),n=i.val();for(this.error=!1,t=0;t<n.length;t++)"0"===n[t]&&"0"!==n[t]&&(e=n.split(n[t],n.substring(1,n.length)),n=e[1]);return i.val(parseInt(n,10)),this.quantity=parseInt(n,10),parseInt(n,10)>0&&!isNaN(n)&&parseInt(n,10)<=parseInt(this.attributes.stock,10)?(i.removeClass("error"),o.hide(),s.removeClass("error"),!0):(0!==parseInt(n,10)&&n?parseInt(n,10)>parseInt(this.attributes.stock,10)&&o.html("Not enough in stock"):o.html("Quantity must be 1 or more."),i.addClass("error"),o.show(),s.addClass("error"),this.error=!0,!1)},onExitFullScreen:function(){FSWidgetModel.gi().widgetState.get("displayState")===DisplayState.NORMAL&&Backbone.Mediator.pub(WidgetEvent.POPIN_CLOSE)},onKeyDownQuantity:function(t){this.onKeyDown(t),37!==t.keyCode&&39!==t.keyCode&&8!==t.keyCode&&46!==t.keyCode&&(t.keyCode<48||t.keyCode>105||t.keyCode>57&&t.keyCode<96)&&t.preventDefault(),t.stopPropagation()},onKeyDown:function(t){13===t.keyCode&&t.preventDefault(),t.stopPropagation()},onFocusEmailAddress:function(){var t=this.$el.find(".emailAddress");t.hasClass("error")&&(t.removeClass("error"),this.$el.find(".emailAddressError").hide())},onFocusMailMessage:function(){var t=this.$el.find(".mailMessage");t.hasClass("error")&&(t.removeClass("error"),this.$el.find(".mailMessageError").hide())},sendPaypalRequest:function(){var t=URLPaths.PAYPAL_URL;return!this.error&&(t+="?"+("cmd=_xclick&business="+encodeURIComponent(this.sellerEmail)+"&item_name="+encodeURIComponent(this.productName.replace(/[^a-zA-Z0-9\s]+/g,""))+"&amount="+encodeURIComponent(this.price)+"&currency_code="+encodeURIComponent(this.currency)+"&quantity="+encodeURIComponent(this.quantity)+"&notify_url="+encodeURIComponent(URLPaths.PAYPAL_NOTIFY_URL)+"&custom="+encodeURIComponent(URLPaths.collectionHashId+","+this.paypalHash)),window.open(t,"_blank"),!0)}}),CustomButton=Backbone.View.extend({events:function(){return{"click .btn":"onClick","click .hover":"onClick","mouseover .btn":"mouseOver","mouseover .hover":"mouseOver","mousemove .btn":"mouseMove","mousemove .hover":"mouseMove","mouseout .btn":"mouseOut","mouseout .hover":"mouseOut"}},template:_.template(CustomContentTemplates.button),className:"customBtn custom-element",initialize:function(){var t=this.model.get("type"),e=this.model.get("tooltip"),i=[ElementType.CART_TOOLTIP,ElementType.PAYPAL_TOOLTIP,ElementType.CREDIT_CARD_TOOLTIP,ElementType.CART_WITH_LABEL,ElementType.CREDIT_CARD_WITH_LABEL];this.isMobileDevice=FSUtils.isMobileDevice(),this.tooltip=e&&""!==e,this.$button=void 0,this.$hover=void 0,this.tooltip&&i.indexOf(t)>=0&&(this.model.set("label",e),this.tooltip=!1),this.listenTo(this.model,"change:state",this.setIcon),this.listenTo(this.model,"change:w",this.onModelChangeWidth),this.listenTo(this.model,"change:h",this.onModelChangeHeight),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.onResize,this)},isGoToUrlAction:function(t){var e=this.model.get("action")===LinkAction.GO_TO_URL;return void 0!==t&&t?e&&""!==this.model.get("url"):e},isGoToProfileAction:function(){return this.model.get("action")===LinkAction.GO_TO_FLIPSNACK_PROFILE},setLinkUrl:function(){var t=this.isGoToUrlAction(!0),e=this.isGoToProfileAction();(t||e)&&(t?this.$el.find("a.btn").attr({href:this.model.get("url"),target:this.model.get("target")||"_blank"}):e&&this.$el.find("a.btn").attr({href:FlipSnackEmbed.urls.siteURL+"/"+this.model.get("username")+"/",target:"_blank"}))},render:function(){var t=this.model.get("radius")+"px";return this.$el.html(this.template(this.model.attributes)).css(this.getCssObj()),"rounded"===this.model.get("shape")&&(this.$el.addClass("rounded"),t="50%"),this.$button=this.$el.find(".btn"),this.$hover=this.$el.find(".hover"),this.$button.css({background:"rgba("+this.hexToRgba(this.model.get("color"),this.model.get("alpha"))+")",height:"100%",borderRadius:t}),this.setLinkUrl(),this.model.get("action")===LinkAction.CAPTION&&this.$el.addClass("caption-button"),this.setHover(),this.setIcon(),this},getCssObj:function(){var t={left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("w"),height:this.model.get("h")};return this.model.get("action")!==LinkAction.CAPTION&&(t.opacity=this.model.get("alpha")||0===this.model.get("alpha")?this.model.get("alpha"):1),t},hexToRgba:function(t,e){var i=3===t.length?t[0]+t[0]+t[1]+t[1]+t[2]+t[2]:t,o=parseInt(i,16);return(o>>16&255)+","+(o>>8&255)+","+(255&o)+","+e},setIcon:function(){var t,e,i=this.model.get("icon"),o=this.model.get("state"),s=i&&i[o]&&i[o].id?"icon_"+i[o].id:null;this.model.get("type")!==ElementType.OUTLINE&&s?SvgLoader.getLoadedIcons()[s]?this.renderIcon($(SvgLoader.getLoadedIcons()[s])):(t=new SvgLoader(s),e=this,t.loadSVG(e,(function(t){SvgLoader.addLoadedIcon(s,t),e.renderIcon($(t))}))):this.$el.find(".ico").empty()},renderIcon:function(t){t.css({fill:"ffffff"===this.model.get("color")||"fff"===this.model.get("color")?"#000":"#fff",opacity:this.model.get("alpha")||0===this.model.get("alpha")?this.model.get("alpha"):1}),this.$el.find(".ico").empty().append(t),this.model.get("label")&&this.setIconSize(),this.setLabel(),this.model.get("label")&&this.setIconLeft()},setIconSize:function(){this.$el.find(".ico").css("width",this.getIconSize()+"px")},getIconSize:function(){var t=Math.min(this.model.get("w")/EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_WIDTH,this.model.get("h")/EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_HEIGHT)*EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_ICON_SIZE;return Math.ceil(EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_WIDTH*t)},setLabel:function(){var t=this.model.get("label");t?(this.$el.find(".label").css({fontFamily:"Arial",lineHeight:this.model.get("h")+"px",color:"ffffff"===this.model.get("color")?"#000":"#fff"}).append(t.encodeHTML()),this.setPadding(),this.setFontSize(),this.$el.addClass("with-label")):this.$el.find(".label").remove()},getFontSize:function(){var t=[ElementType.CART_WITH_LABEL,ElementType.CREDIT_CARD_WITH_LABEL].indexOf(this.model.get("type"))>-1?EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_NEW_LABEL_DEFAULT_FONT_SIZE:EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_FONT_SIZE;return Math.min(this.model.get("w")/EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_WIDTH,this.model.get("h")/EDITOR_DEFAULTS.CUSTOM_BUTTON_WITH_LABEL_DEFAULT_HEIGHT)*t},setFontSize:function(){this.$el.find(".label").css("font-size",this.getFontSize()+"px")},getPadding:function(){return Math.ceil(Math.min(this.model.get("w"),this.model.get("h"))/2*2.4)},setPadding:function(){this.$el.find(".label").css("padding-left",this.getPadding()+"px")},getIconLeft:function(){return Math.min(this.$el.find(".ico svg").outerWidth(),this.$el.find(".ico svg").outerHeight())/2},setIconLeft:function(){this.$el.find(".ico").css("left",parseInt(this.getIconLeft()+"px",10))},onClick:function(){var t,e,i,o=this.model.attributes,s=FSWidgetModel.gi().widgetState.get("currentItem").get("noOfPages");switch(o.action){case LinkAction.GO_TO_URL:Tracker.gtag(FSWidgetModel.gi().get("collectionHash"),"Click","Page "+(o.elementPageIndex+1)+": "+o.url,o.eID);break;case LinkAction.PAYPAL:FSWidgetModel.gi().widgetState.get("displayState")!==DisplayState.FULLSCREEN&&Backbone.Mediator.pub(WidgetEvent.ENTER_FULLSCREEN),this.popin&&(this.popin.remove(),this.popin=null),this.popin=new PaypalPopin(o),this.popin.showModal();break;case LinkAction.GO_TO_PREV_PAGE:Backbone.Mediator.pub(WidgetEvent.PREV_PAGE);break;case LinkAction.GO_TO_NEXT_PAGE:Backbone.Mediator.pub(WidgetEvent.NEXT_PAGE);break;case LinkAction.GO_TO_FIRST_PAGE:Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,0);break;case LinkAction.GO_TO_LAST_PAGE:Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,s-1);break;case LinkAction.GO_TO_PAGE:t=parseInt(o.page||1,10)-1,e=FSWidgetModel.gi().singlePageView||t%2!=0?t:t-1,e=Math.min(Math.max(0,e),s-1),FSWidgetModel.gi().arabicStyle&&(e=s-e-1),Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,e);break;case LinkAction.DOWNLOAD_PDF:if(FlipSnackEmbed.isEditor)return i=new Backbone.Model({action:"download"}),FSWidgetModel.gi().sendMessage(i),!1;this.registerDownloadEvent(),"getCollectionDownloadLink",window.open(FSWidgetModel.gi().getCollectionDownloadLink(),"_blank");break;case LinkAction.CAPTION:this.setCaptionState();break;case LinkAction.SPOTLIGHT:Backbone.Mediator.pub(WidgetEvent.OPEN_SPOTLIGHT_POPIN,this.model.attributes);break;case LinkAction.PHOTO_SLIDESHOW:FSWidgetModel.gi().get("collectionData").features[FEATURES.PHOTO_SLIDESHOW]&&Backbone.Mediator.pub(WidgetEvent.OPEN_SPOTLIGHT_POPIN,this.model.attributes);break;case LinkAction.POPUP_FRAME:FSWidgetModel.gi().get("collectionData").features[FEATURES.POPUP_FRAME]&&Backbone.Mediator.pub(WidgetEvent.OPEN_POPUP_FRAME,this.model.attributes);break;case LinkAction.SEND_EMAIL:o.email&&Backbone.Mediator.pub(WidgetEvent.SEND_EMAIL,o.email)}return this.registerClickEvent(),this.sendClickNotification(),!0},registerDownloadEvent:function(){var t=FSWidgetModel.gi().widgetSettings.get("mergePdfs"),e=1===FSWidgetModel.gi().flipCollection.get("noOfItems"),i=t||e?Stats.TYPE.DOWNLOAD_COLLECTION:Stats.TYPE.DOWNLOAD_ITEM;Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:i})},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},setCaptionState:function(){"default"===this.model.get("state")?(this.model.set("state","active"),this.showCaption()):(this.model.set("state","default"),this.hideCaption())},mouseOver:function(t){var e=[LinkAction.SPOTLIGHT,LinkAction.GO_TO_FLIPSNACK_PROFILE,LinkAction.POPUP_FRAME,LinkAction.CHARTS_LINE,LinkAction.CHARTS_BAR,LinkAction.CHARTS_PIE].includes(this.model.get("action"));!this.isMobileDevice&&this.tooltip&&(this.model.get("type")!==ElementType.OUTLINE||this.model.get("type")===ElementType.OUTLINE&&e)&&(this.mouseMove(t),Backbone.Mediator.pub(CustomContentEvent.SHOW_CUSTOM_TOOLTIP,this.model.get("tooltip"))),this.showHover()},mouseMove:function(t){!this.isMobileDevice&&this.tooltip&&Backbone.Mediator.pub(CustomContentEvent.MOVE_CUSTOM_TOOLTIP,t)},mouseOut:function(){!this.isMobileDevice&&this.tooltip&&Backbone.Mediator.pub(CustomContentEvent.HIDE_CUSTOM_TOOLTIP),this.hideHover()},showHover:function(){this.$hover.show()},hideHover:function(){this.$hover.hide()},showCaption:function(){this.caption||(this.caption=new CaptionView({model:new CaptionModel(this.model.attributes)}),this.$el.append(this.caption.render().el),this.caption.checkPosition()),this.caption.$el.show(),Backbone.Mediator.pub(CustomContentEvent.CAPTION_OPENED)},hideCaption:function(){this.caption&&(this.caption.$el.hide(),Backbone.Mediator.pub(CustomContentEvent.CAPTION_CLOSED))},resize:function(t){var e=this.model.get("radius")*t+"px";this.model.get("type")===ElementType.CAPTION&&"rounded"===this.model.get("shape")&&(e="50%"),this.model.set("scale",t),this.model.setBounds(),this.model.get("action")===LinkAction.CAPTION&&this.caption&&(this.caption.remove(),this.caption=null,2===this.model.get("state")&&this.showCaption()),this.$el.css(this.getCssObj()).find(".label").css({lineHeight:this.model.get("h")+"px"}),this.$button.css({borderRadius:e}),(this.model.get("action")===LinkAction.SPOTLIGHT||this.model.get("action")===LinkAction.PHOTO_SLIDESHOW||this.model.get("action")===LinkAction.POPUP_FRAME)&&Backbone.Mediator.pub(WidgetEvent.SCALE_SPOTLIGHT_POPIN,t)},setHover:function(){this.$hover.css({opacity:.7,background:"#ffffff",height:"100%",position:"relative"}).hide()},onResize:function(){var t=this;window.setTimeout((function(){t.setHover()}),100),this.model.get("label")&&(this.onModelChangeWidth(),this.onModelChangeHeight())},onModelChangeWidth:function(){this.model.get("label")&&(this.setIconSize(),this.setPadding(),this.setIconLeft())},onModelChangeHeight:function(){this.model.get("label")&&this.setFontSize()},start:function(t){"turning"===t&&this.model.get("label")&&(this.onModelChangeWidth(),this.onModelChangeHeight())},remove:function(){this.$button.off(),this.$button=void 0,this.$hover.off(),this.$hover=void 0,this.$el.off(),this.off(),Backbone.Mediator.unsubscribe(WidgetEvent.RESIZE,this.onResize,this),Backbone.View.prototype.remove.apply(this,arguments)}}),AudioButton=CustomButton.extend({initialize:function(){this.isPlaying=!1,CustomButton.prototype.initialize.apply(this,arguments),Backbone.Mediator.sub(CustomContentEvent.AUDIO_STARTED,this.audioStarted,this),Backbone.Mediator.sub(CustomContentEvent.AUDIO_STOPPED,this.audioStopped,this),this.model.set("state","active",{silent:!0})},onClick:function(){"string"==typeof this.model.get("hash")&&this.model.get("hash").length>0&&(this.isPlaying?Backbone.Mediator.pub(CustomContentEvent.STOP_AUDIO,{pageIndex:this.model.get("elementPageIndex"),customElementIndex:this.model.get("index"),audioHash:this.model.get("hash"),autoplay:this.model.attributes.autoplay,enableCustomDuration:this.model.attributes.enableCustomDuration,audioInterval:this.model.attributes.audioInterval}):Backbone.Mediator.pub(CustomContentEvent.PLAY_AUDIO,{pageIndex:this.model.get("elementPageIndex"),customElementIndex:this.model.get("index"),audioHash:this.model.get("hash"),autoplay:this.model.attributes.autoplay,enableCustomDuration:this.model.attributes.enableCustomDuration,audioInterval:this.model.attributes.audioInterval})),this.registerClickEvent(),this.sendClickNotification()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},audioStarted:function(t){this.isCurrentButton(t)&&(this.isPlaying=!0,this.model.set("state","default"))},audioStopped:function(t){this.isCurrentButton(t)&&(this.isPlaying=!1,this.model.set("state","active"))},isCurrentButton:function(t){return t.pageIndex===this.model.get("elementPageIndex")&&t.customElementIndex===this.model.get("index")&&t.audioHash===this.model.get("hash")},stop:function(){Backbone.Mediator.pub(CustomContentEvent.STOP_AUDIO,{pageIndex:this.model.get("elementPageIndex"),customElementIndex:this.model.get("index"),audioHash:this.model.get("hash"),autoplay:this.model.attributes.autoplay,enableCustomDuration:this.model.attributes.enableCustomDuration,audioInterval:this.model.attributes.audioInterval})},remove:function(){Backbone.Mediator.sub(CustomContentEvent.AUDIO_STARTED,this.audioStarted,this),Backbone.Mediator.sub(CustomContentEvent.AUDIO_STOPPED,this.audioStopped,this),CustomButton.prototype.remove.apply(this,arguments)}}),VideoButtonView=CustomButton.extend({events:function(){var t=CustomButton.prototype.events;return _.isFunction(t)&&(t=t()),_.extend({},t,{"click .btn":"onClick"})},initialize:function(){var t=this.getVideoSize(),e=t.width,i=t.height,o=FSUtils.getVideoProvider(this.model.get("ytlink"))===VideoProvider.OTHER;CustomButton.prototype.initialize.apply(this,arguments),this.videoEmbed=new VideoEmbed({model:new VideoEmbedModel({url:this.model.get("ytlink"),width:e,height:i,x:0,y:0,skipResize:!0,autoPlay:!o,genericVideoButton:o})}),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.onResize,this)},getVideoSize:function(){var t=FSWidgetModel.gi().get("width")-VIDEO_POPIN_DEFAULTS.MARGINS,e=FSWidgetModel.gi().get("height")-VIDEO_POPIN_DEFAULTS.MARGINS,i=this.model.get("size").split(","),o=i[0]>t?t:i[0],s=i[1]>e?e:i[1];return"fullscreen"===this.model.get("size")?{width:t,height:e}:{width:o,height:s}},onClick:function(){this.model.get("ytlink")&&this.videoEmbed.model.valid()&&Backbone.Mediator.pub(WidgetEvent.POPIN_OPEN,this.videoEmbed.render().$el,this.videoEmbed.model.attributes),this.registerClickEvent(),this.sendClickNotification()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},onResize:function(){var t=this.getVideoSize();this.videoEmbed.model.set({width:t.width+"px",height:t.height+"px"}),Backbone.Mediator.pub(WidgetEvent.POPIN_RESIZE)}});VideoButtonView.DEFAULT_VIDEO_WIDTH=853,VideoButtonView.DEFAULT_VIDEO_HEIGHT=480;var CaptionView=Backbone.View.extend({className:"caption custom-element",events:{"click .caption":"onClick"},render:function(){var t=this.model.attributes,e=this.model.get("fontFamily")||this.model.get("font").family,i=FontManager.gi().getFontFamily(e),o=FontManager.gi().getFontWeight(e,this.model.get("fontWeight")),s=FontManager.gi().getFontStyle(e);return this.css={fontFamily:'"'+i+'",Helvetica,Arial,sans-serif',fontSize:t.fontSize*t.scale,fontWeight:o,width:t.tw,padding:Math.floor(10*t.scale)+"px "+Math.floor(14*t.scale)+"px",fontStyle:s},this.setPosition(),this.$el.html(this.getCaptionText()).css(this.css),this},getCaptionText:function(){return(this.model.get("text")+this.getUrlHtml()).encodeHTML()},getUrlHtml:function(){return this.model.get("url")&&""!==this.model.get("url")?'<br /><a href="'+this.model.get("url")+'" target="_blank" rel="nofollow noopener">Open link</a>':""},setPosition:function(){var t=this.model.attributes;switch(t.textPosition){case"left":t.tw>t.x&&t.tw+t.x+t.w<FlipView.gi().docView.pageWidth?(this.model.set("textPosition","right"),this.setPosition()):(t.th+t.y>FlipView.gi().docView.pageHeight?(this.css.bottom=0,this.css.top="unset"):(this.css.top=0,this.css.bottom="unset"),this.css.right=t.w+1);break;case"right":t.tw+t.x+t.w>FlipView.gi().docView.pageWidth&&t.tw<t.x?(this.model.set("textPosition","left"),this.setPosition()):(t.th+t.y>FlipView.gi().docView.pageHeight?(this.css.bottom=0,this.css.top="unset"):(this.css.top=0,this.css.bottom="unset"),this.css.left=t.w+1);break;case"top":t.th>t.y&&t.th+t.y+t.h<FlipView.gi().docView.pageHeight?(this.model.set("textPosition","bottom"),this.setPosition()):(t.tw>t.x?(this.css.left=0,this.css.right="unset"):(this.css.right=0,this.css.left="unset"),this.css.bottom=t.h+1);break;case"bottom":t.th+t.y+t.h>FlipView.gi().docView.pageHeight&&t.th<t.y?(this.model.set("textPosition","top"),this.setPosition()):(t.tw+t.x>FlipView.gi().docView.pageWidth?(this.css.right=0,this.css.left="unset"):(this.css.left=0,this.css.right="unset"),this.css.top=t.h+1)}},checkPosition:function(){this.model.attributes.type===ElementType.CAPTION&&(this.model.set("th",this.$el.height()),this.setPosition(),this.$el.css(this.css))},onClick:function(){this.sendClickNotification()},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)}}),CartView=Backbone.View.extend({template:_.template(CustomContentTemplates.cart),className:"cart-container custom-element",resize:function(t){t!==this.model.get("scale")&&(this.model.set("scale",t),this.model.setBounds(),this.setCSS())},setCSS:function(){var t="area"===this.model.get("displayIcon"),e=this.$el.find(".shopping-label");if(this.$el.css({position:"absolute",top:this.model.get("y")+"px",left:this.model.get("x")+"px",width:this.model.get("w")+"px",height:this.model.get("h")+"px",borderRadius:(t?0:8)+"px",display:"flex",alignItems:"center",backgroundColor:"#"+this.model.get("color"),opacity:this.model.get("alpha")||0===this.model.get("alpha")?this.model.get("alpha"):1}),!t){var i=this.$el.find(".cart-svg"),o=this.model.get("h")?this.model.get("h")*PlayerIconButton.iconLeftRightMargin/PlayerIconButton.iconScaleFactor:0;i.css({minWidth:"20px",height:"55%",width:this.model.get("buttonLabel")?this.model.get("h")?32*this.model.get("h")/PlayerIconButton.iconScaleFactor:0:"50%",marginRight:this.model.get("buttonLabel")?o:0,marginLeft:this.model.get("buttonLabel")?o:0}),i.find("path").attr({fill:this.model.get("labelColor")})}e&&e.css({fontSize:this.model.get("h")?this.model.get("h")*PlayerIconButton.fontSize/PlayerIconButton.fontScaleFactor:0})},render:function(){var t="area"===this.model.get("displayIcon");this.model.set("buttonLabel",t?"":this.model.get("buttonLabel")),this.model.set("hasSvg",!t),this.model.set("fill","#"+this.model.get("labelColor")),this.$el.html(this.template(this.model.attributes));var e=this.$el.find(".cart-element"),i=this.$el.find(".shopping-label");return e&&(e.css({width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"}),i&&i.css({color:this.model.get("labelColor"),whiteSpace:"nowrap",overflow:"hidden"})),this.resize(this.model.get("scale")),this.setCSS(),this}}),TagView=Backbone.View.extend({events:{click:"onClick",mouseover:"mouseOverContainer",mouseout:"mouseOutContainer"},template:_.template(CustomContentTemplates.tag),className:"custom-tag custom-element",initialize:function(){this.newEditor=FSWidgetModel.gi().widgetSettings.get("editorVersion")&&2===parseInt(FSWidgetModel.gi().widgetSettings.get("editorVersion"),10),this.tagTooltip=new TagTooltipView({model:new Backbone.Model({newEditor:this.newEditor,scale:this.model.get("scale")})}),this.youtubeIframeURL="https://www.youtube.com/embed/",this.youtubeVideoHash="",this.youtubeVideoParams="?wmode=opaque&rel=0",this.vimeoIframeUrl="https://player.vimeo.com/video/",this.vimeoVideoID="",this.vimeoVideoParams="?api=1&player_id=fs_videoPlayerIframe_",this.dimensions={w:this.newEditor?this.model.get("w")/this.model.get("scale"):19,h:this.newEditor?this.model.get("h")/this.model.get("scale"):19},Backbone.Mediator.sub(WidgetEvent.BEFORE_POPIN_CLOSE,this.onPopinClose,this),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.onResize,this)},render:function(){return this.$el.html(this.template(this.model.attributes)).append(this.tagTooltip.render().$el),this.tag=this.$el.find(".tag"),this.colorRing=this.tag.find(".color-ring"),this.extension=this.$el.find(".tag-ext"),this.setCSS(),this},setCSS:function(){var t=this.model.attributes;this.$el.css({left:t.x,top:t.y,width:this.dimensions.w*t.scale,height:this.dimensions.h*t.scale}),this.colorRing.css({border:this.dimensions.w/4*t.scale+"px solid #"+t.color,left:2*t.scale,top:2*t.scale,width:(this.dimensions.w-4)*t.scale,height:(this.dimensions.h-4)*t.scale,opacity:this.model.get("alpha")||0===this.model.get("alpha")?this.model.get("alpha"):1})},resize:function(t){t!==this.model.get("scale")&&(this.model.set("scale",t),this.model.setBounds(),this.setCSS())},onClick:function(){var t,e,i,o,s=this,n=this.model.attributes;switch(t=FSWidgetModel.gi().get("width")-VIDEO_POPIN_DEFAULTS.MARGINS,e=FSWidgetModel.gi().get("height")-VIDEO_POPIN_DEFAULTS.MARGINS,n.tagType){case TagType.VIDEO:i=$('<iframe class="video"></iframe>'),(o=this.getVideoSrc(n.tagUrl))&&(i.attr({src:o+"?rel=0&amp;autoplay=1",allowfullscreen:"allowfullscreen",frameborder:"0"}).css({position:"relative",zIndex:1,display:"block"}),this.resizeVideo(i,t,e),Backbone.Mediator.pub(WidgetEvent.POPIN_OPEN,i,t,e),this.positionPopinCloseButton());break;case TagType.IMAGE:$('<img class="image"/>').on("load",(function(){s.originalImageWidth=this.width,s.originalImageHeight=this.height,s.resizeImage(this,t,e),Backbone.Mediator.pub(WidgetEvent.POPIN_OPEN,this,this.width,this.height)})).css({padding:"9px"}).attr("src",URLPaths.UPLOADS_PATH+n.thumbHash);break;default:n.tagUrl&&Backbone.Mediator.pub(WidgetEvent.HYPERLINK,n.tagUrl,"_blank")}this.registerClickEvent()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},getVideoSrc:function(t){var e=FSUtils.getVideoHash(t);if(e.length){if(t.indexOf("youtube.com/")>-1||t.indexOf("youtu.be/")>-1)return this.youtubeIframeURL+e+this.youtubeVideoParams;if(t.indexOf("vimeo.com/")>-1)return this.vimeoIframeUrl+e+this.vimeoVideoParams}return!1},mouseOverContainer:function(){this.tagTooltip.showTooltip(this.model.attributes),this.model.attributes.tagVideoTitle&&this.$el.find(".tooltip-title").text(this.model.attributes.text?this.model.attributes.text:this.model.attributes.tagVideoTitle),this.model.attributes.tagType===TagType.VIDEO&&(this.model.attributes.tagVideoTitle||this.$el.find(".tooltip-title").hide(),this.model.attributes.url||this.$el.find(".tooltip-link").hide()),this.model.attributes.tagType!==TagType.TEXT&&this.model.attributes.tagType!==TagType.LINK||(this.model.attributes.tagUrl||this.$el.find(".tooltip-link").hide(),this.model.attributes.text||this.$el.find(".tooltip-text").hide(),this.model.attributes.tagUrl||this.model.attributes.text||this.$el.find(".content-text").hide()),(isNaN(this.model.attributes.tagType)||(void 0===this.model.get("text")||0===this.model.get("text").length)&&0===this.model.get("tagUrl").length&&0===this.model.get("tagVideoTitle").length)&&(this.$el.find(".content-text").hide(),this.$el.find(".tag-tooltip").hide())},mouseOutContainer:function(){this.tagTooltip.hideTooltip()},resizeImage:function(t,e,i){var o,s,n,a;this.originalImageWidth<=e&&this.originalImageHeight<=i||((o=this.originalImageWidth/e)>(s=this.originalImageHeight/i)?(n=e,a=this.originalImageHeight/o):(a=i,n=this.originalImageWidth/s),this.setImageAttributes(t,n,a))},setImageAttributes:function(t,e,i){t.setAttribute("width",e+"px"),t.setAttribute("height",i+"px")},resizeVideo:function(t,e,i){var o=e>VIDEO_POPIN_DEFAULTS.WIDTH?VIDEO_POPIN_DEFAULTS.WIDTH:e,s=i>VIDEO_POPIN_DEFAULTS.HEIGHT?VIDEO_POPIN_DEFAULTS.HEIGHT:i;t.attr("width",o+"px"),t.attr("height",s+"px")},unfocusTagOnPage:function(){this.mouseOutContainer(),this.mouseOutCircle(),this.colorRing.hide()},onPopinClose:function(t){var e=this.model.get("tagType");e===TagType.VIDEO&&t.find("iframe").remove(),e===TagType.IMAGE&&(this.originalImageWidth=!1,this.originalImageHeight=!1)},positionPopinCloseButton:function(){this.$el.find(".btn-x").css("z-index",2)},onResize:function(){var t=FSWidgetModel.gi().get("width")-VIDEO_POPIN_DEFAULTS.MARGINS,e=FSWidgetModel.gi().get("height")-VIDEO_POPIN_DEFAULTS.MARGINS,i=this.$el.find(".popin-content .image"),o=this.$el.find(".popin-content .video");this.model.get("tagType")===TagType.IMAGE&&this.originalImageWidth&&this.originalImageHeight&&this.resizeImage(i[0],t,e),this.model.get("tagType")===TagType.VIDEO&&this.resizeVideo(o,t,e),Backbone.Mediator.pub(WidgetEvent.POPIN_RESIZE)}}),TagTooltipView=Backbone.View.extend({template:_.template(CustomContentTemplates.tagTooltip),className:"tag-tooltip",initialize:function(){this.initialized=!1,this.scale=!1,this.newEditor=this.model.get("newEditor")},render:function(){return this.$el.html(this.template()),this},setTooltip:function(t){var e=this;switch(t.tagType){case TagType.VIDEO:this.$el.find(".tooltip-title").html(t.text.encodeHTML()),this.$el.find(".content-media").show(),this.$el.find(".content-text").hide(),this.$el.find(".tooltip-img img").on("load",(function(){e.tooltipReady(t)})).attr("src",t.tagVideoThumb);break;case TagType.IMAGE:this.$el.find(".tooltip-title").html(t.text.encodeHTML()),this.$el.find(".content-media").show(),this.$el.find(".content-text").hide(),this.$el.find(".play-btn").hide(),this.$el.find(".tooltip-img img").on("load",(function(){e.tooltipReady(t)})).attr("src",URLPaths.UPLOADS_PATH+t.thumbHash);break;default:this.$el.find(".tooltip-text").html(t.text.encodeHTML()),this.$el.find(".tooltip-link a").html(t.tagUrl.encodeHTML()),this.$el.find(".content-media").hide(),this.$el.find(".content-text").show(),this.tooltipReady(t)}},tooltipReady:function(t){var e={w:this.newEditor?t.w:19,h:this.newEditor?t.h:19};t.y<this.$el.height()&&this.$el.addClass("bellow").css({top:e.h,bottom:"auto"}),this.$el.css({opacity:1})},showTooltip:function(t){var e,i,o,s=this.newEditor?t.w:19,n=this.newEditor?t.h:19,a=t.offset?-1*t.offset:0,l=t.pageOffset?t.pageOffset.x:0;this.scale!==t.scale&&(i=s/2-(e=t.tagPreviewWidth*t.scale)/2,o=0,t.x+l+a<-1*i&&(o=i+t.x+l+a-2*t.scale),t.x+l+i+e>t.currentPageWidth&&(o=t.x+l+i+(e-t.currentPageWidth)+2*t.scale),this.$el.find(".content > div").css({right:o}),this.$el.css({fontSize:10*t.scale,width:e,left:i,bottom:n-3,opacity:0}).show(),this.$el.find(".content > div > div").css({padding:9*t.scale}),this.$el.find(".tooltip-title").css({paddingTop:0}),this.$el.find(".play-btn").css({border:2*t.scale+"px solid #979797",borderRadius:8*t.scale,width:46*t.scale,height:30*t.scale,marginLeft:46*t.scale*-1/2,marginTop:30*t.scale*-1/2}),this.$el.find(".play-btn div").css({width:0,height:0,borderTop:8*t.scale+"px solid transparent",borderBottom:8*t.scale+"px solid transparent",borderLeft:13*t.scale+"px solid #464646",marginLeft:-6*t.scale,marginTop:-8*t.scale})),this.initialized?this.tooltipReady(t):this.setTooltip(t)},hideTooltip:function(){this.$el.hide()}}),TextView=Backbone.View.extend({events:{click:"onClick"},template:_.template(CustomContentTemplates.text),className:"text-element custom-element",initialize:function(){Backbone.Mediator.sub(WidgetEvent.PREV_PAGE,(function(){this.setCSS()}),this),Backbone.Mediator.sub(WidgetEvent.NEXT_PAGE,(function(){this.setCSS()}),this)},resize:function(t){t!==this.model.get("scale")&&(this.model.set("scale",t),this.model.setBounds(),this.setCSS())},setCSS:function(){this.$el.width(this.model.get("w")).css({left:this.model.get("x")+"px",top:this.model.get("y")+"px",opacity:this.model.get("alpha"),transform:"rotate("+this.model.get("rotation")+"deg)"}),this.$el.find(".inner").css({width:this.model.get("ow")+"px",fontSize:this.model.get("oFontSize")+"px",lineHeight:this.model.get("lineHeight"),letterSpacing:this.model.get("letterSpacing"),transformOrigin:"left top 0",transform:"translateY(0em) scale("+this.model.get("scale")+")",textAlign:this.model.get("textAlign"),color:"#"+this.model.get("color")}),this.$el.height(this.$el.find(".inner").height()*this.model.get("scale"))},render:function(){var t=this,e=this.model.get("fontFamily")?this.model.get("fontFamily"):"",i=FontManager.gi().getFontFamily(e),o=FontManager.gi().getFontWeight(e,this.model.get("fontWeight")),s=FontManager.gi().getFontStyle(e);return this.$el.css({fontFamily:'"'+i+'",Helvetica,Arial,sans-serif',fontWeight:o,fontStyle:s,transform:"rotate("+this.model.get("rotation")+"deg)"}).html(this.template(this.model.attributes)),this.setCSS(),this.model.get("url")&&this.$el.find("a").attr({href:this.model.get("url"),target:"_blank"}),setTimeout((function(){t.$el.height(t.$el.find(".inner").height()*t.model.get("scale"))}),100),this},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)}}),TextBoxView=Backbone.View.extend({events:{click:"onClick"},template:_.template(CustomContentTemplates.textBox),className:"text-box-element custom-element",initialize:function(){this.scaling=this.model.get("scale")*this.model.get("oldEditorScaling"),Backbone.Mediator.sub(WidgetEvent.PREV_PAGE,(function(){this.setCSS()}),this),Backbone.Mediator.sub(WidgetEvent.NEXT_PAGE,(function(){this.setCSS()}),this)},resize:function(t){t!==this.model.get("scale")&&(this.model.set("scale",t),this.scaling=this.model.get("scale")*this.model.get("oldEditorScaling"),this.model.setBounds(),this.setCSS())},setCSS:function(){this.$el.css({left:this.model.get("x")+"px",top:this.model.get("y")+"px",width:this.model.get("w")+"px",height:this.model.get("h")+"px",transform:"rotate("+this.model.get("rotation")+"deg)",overflow:this.model.get("textWrap")&&this.model.get("textWrap")===TEXT_WRAP_TYPES.CLIP?"hidden":"unset"}),this.$el.find(".inner").css({lineHeight:0,textAlign:this.model.get("textAlign"),color:"#"+this.model.get("color"),width:this.model.get("w")/this.scaling+"px",height:this.model.get("h")/this.scaling+"px",transformOrigin:"left top 0",transform:"translateY(0em) scale("+this.scaling+")",fontSize:this.model.get("oFontSize"),letterSpacing:0})},render:function(){var t=this.model.get("fontFamily")?this.model.get("fontFamily"):"",e=FontManager.gi().getFontFamily(t),i=FontManager.gi().getFontWeight(t,this.model.get("fontWeight")),o=FontManager.gi().getFontStyle(t),s=this.generateTextContent();return this.$el.css({fontFamily:e?'"'+e+'",Helvetica,Arial,sans-serif':"",fontWeight:i,fontStyle:o,transform:"rotate("+this.model.get("rotation")+"deg)"}).html(this.template({textContent:s})),this.setCSS(),this.model.get("url")&&this.$el.find("a").attr({href:this.model.get("url"),target:"_blank"}),this},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},replaceWhiteSpace:function(t){return"string"==typeof t?t.replace(/(\s|&nbps;)(\s|&nbps;)/gi,String.fromCharCode(160,160)):t},generateTextContent:function(){var t,e,i,o,s=document.createElement("div"),n=this;return this.model.get("nodes").forEach((function(o,a){if(t=document.createElement(o.tag),e=o.text.split("\n"),o.style&&(i=Object.keys(o.style)).length&&i.forEach((function(e){"fontSize"===e||"letterSpacing"===e?t.style[e]=o.style[e]+"px":"font"===e?t.style.fontFamily=o.style[e].family:t.style[e]=o.style[e]})),1===e.length)t.appendChild(document.createTextNode(n.replaceWhiteSpace(e[0])));else{for(var l=e.pop(),d=0;d<e.length;d++)t.appendChild(document.createTextNode(n.replaceWhiteSpace(e[d]))),t.appendChild(document.createElement("br"));t.appendChild(document.createTextNode(n.replaceWhiteSpace(l)))}t.className+="fragment-"+a,s.appendChild(t)})),o="<span>"+s.innerHTML+"</span>",s instanceof HTMLElement?o:"<span />"},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)}}),VideoWidgetView=Backbone.View.extend({className:"video-widget custom-element",events:{click:"onClick"},initialize:function(){this.videoEmbed=new VideoEmbed({model:new VideoEmbedModel({cover:this.model.get("cover"),provider:this.model.get("provider"),url:this.getVideoUrl(),width:this.model.get("w"),height:this.model.get("h"),x:this.model.get("x"),y:this.model.get("y"),genericVideoButton:!1,poster:this.getThumbFromSrc()})}),this.init=!1},getVideoUrl:function(){if(this.model.get("src")){if(this.model.get("provider"))return this.model.get("src");var t=URLPaths.HYPERLINK_UPLOADED_IMAGES_PATH+this.model.get("src"),e=-1!==t.indexOf("//")?"":".mp4";return t+e}return this.model.get("ytlink")},getThumbFromSrc:function(){if(this.model.get("src")){if(this.model.get("provider"))return this.model.get("cover");var t="";return this.model.get("version")&&(t="?v="+this.model.get("version")),URLPaths.HYPERLINK_UPLOADED_IMAGES_PATH+this.model.get("src").split("?")[0]+"_cover"+t}},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},resize:function(t){t!==this.model.get("scale")&&(this.model.set("scale",t),this.model.setBounds(),this.setCSS())},setCSS:function(){this.$el.width(this.model.get("w")).height(this.model.get("h")).css({left:this.model.get("x")+"px",top:this.model.get("y")+"px"}),this.videoEmbed&&this.videoEmbed.model.set({width:this.model.get("w"),height:this.model.get("h")})},render:function(){return this.$el.css({display:this.videoEmbed.model.valid()?"block":"none"}),this.setCSS(),this},start:function(t){"end"!==t||this.init||(this.$el.html(this.videoEmbed.render().$el),this.init=!0)},stop:function(){this.videoEmbed.$el.empty(),this.init=!1},remove:function(){this.videoEmbed&&(this.videoEmbed.remove(),this.videoEmbed=null),Backbone.View.prototype.remove.apply(this,arguments)}}),VideoEmbed=Backbone.View.extend({template:_.template(CustomContentTemplates.videoIframe),attributes:function(){return{class:"video-autoplay-"+this.model.get("autoPlay")}},initialize:function(){this.listenTo(this.model,"change:width",this.onChangeDimensions),this.listenTo(this.model,"change:height",this.onChangeDimensions)},autoPlayVideoMobile:function(){if(this.model.get("mobile")&&this.model.get("autoPlay")){var t=document.getElementsByClassName("video-autoplay-1");setTimeout((function(){for(var e=0;e<t.length;e++){var i;t[e]&&"IFRAME"!==t[e].tagName.toUpperCase()&&(i=t[e].getElementsByTagName("iframe")[0]),i&&i.contentWindow&&i.contentWindow.postMessage(JSON.stringify({event:"command",func:"playVideo",args:[],className:"video-autoplay-1"}),"*")}}),1500)}},onChangeDimensions:function(){this.model.get("provider")===VideoProvider.YOUTUBE||this.model.get("provider")===VideoProvider.VIMEO?this.$("iframe").eq(0).attr({width:this.model.get("width"),height:this.model.get("height")}):this.$("video").eq(0).attr({width:this.model.get("width"),height:this.model.get("height")})},render:function(){if(this.$el.html(this.template(this.model.attributes)),this.model.get("genericVideoButton")){var t=this.$el.find("video")[0];t&&t.addEventListener("loadedmetadata",(function(){Backbone.Mediator.pub(CustomContentEvent.VIDEO_EMBED_SIZE,{videoWidth:this.videoWidth,videoHeight:this.videoHeight})}))}else this.autoPlayVideoMobile();return this}}),ShapeView=Backbone.View.extend({template:_.template(CustomContentTemplates.shape),className:"shape-element custom-element",events:{click:"onClick"},initialize:function(){this.setCSS()},render:function(){return this.$el.html(this.template(this.model.attributes)),this.loadMaskShape(),this.setCSS(),this.model.get("url")&&this.$el.find("a").attr({href:this.model.get("url"),target:"_blank"}),this},loadMaskShape:function(){var t,e,i=parseInt(this.model.get("shape"),10);(i=0===i?1:i)&&(SvgLoader.getLoadedShapes()[i]?this.renderSVG($(SvgLoader.getLoadedShapes()[i])):(t=new SvgLoader(i,SymbolType.SHAPE),e=this,t.loadSVG(e,(function(t){SvgLoader.addLoadedShape(i,t),e.renderSVG(t)}))))},decodeShadowFilter:function(t){var e,i=this.model.get("scale")*this.model.get("oldEditorScaling");return t?(e="rgba("+t.r+", "+t.g+", "+t.b+", "+t.a+")","drop-shadow("+t.x*i+"px "+t.y*i+"px "+t.blur*i+"px "+e+")"):""},getFilters:function(t){var e,i="";for(e in t)e===ShapeView.filterType.SHADOW&&(i+=this.decodeShadowFilter(t[e]));return i},getBorder:function(t,e){return t?t.width*e+"px solid "+t.color:null},renderSVG:function(t){var e=this,i=this.model.get("scale")/2,o=this.$el.find("div:first").eq(0),s=$(t),n="pattern-"+ ++ShapeView.patternIdCount,a=this.model.get("rotation")?parseInt(this.model.get("rotation"),10):0;s.css({border:this.getBorder(this.model.get("border"),i),borderRadius:this.model.get("radius")*i+"px",opacity:this.model.get("alpha"),filter:this.getFilters(this.model.get("filter"))}),this.model.get("repeat")&&(s.find("pattern").attr("id",n),s.children("rect:first").attr("fill","url(#"+n+")")),s.attr("stroke")||"none"!==s.attr("fill")||s.attr("stroke","#"+e.getColor()),s.find("path,pattern *").each((function(t,i){$(i).attr("fill")&&"none"!==$(i).attr("fill")&&$(i).attr("fill","#"+e.getColor())})),o.css({fill:"#"+e.getColor()}),o.html(s),this.patternHeight=parseFloat(s.find("pattern svg").attr("height")),this.resizeSvg(i),"number"==typeof a&&0!==a&&this.$el.css("transform","rotate("+a+"deg)")},getColor:function(){return"number"==typeof this.model.get("color")?"000000":this.model.get("color")},resize:function(t){t!==this.model.get("scale")&&(this.model.set("scale",t),this.model.setBounds(),this.setCSS(),this.resizeSvg(t/2))},resizeSvg:function(t){var e=!!this.model.get("repeat")&&1===parseInt(this.model.get("repeat"),10),i=this.$("svg:first").eq(0);i.attr({width:e?"100%":this.model.get("w")+"px",height:this.model.get("h")>1?this.model.get("h")+"px":"1px"}),e&&i.find("defs + rect").attr({transform:"scale("+this.model.get("h")/this.patternHeight+")",width:this.model.get("w")/(this.model.get("h")/this.patternHeight)+"px"}),i.css({border:this.getBorder(this.model.get("border"),t),borderRadius:this.model.get("radius")*t+"px",filter:this.getFilters(this.model.get("filter")),opacity:this.model.get("alpha")}),this.$("div:first").eq(0).css({fill:"#"+this.getColor(),width:this.model.get("w")+"px",height:this.model.get("h")+"px",minHeight:"1px"})},setCSS:function(){this.$el.width(this.model.get("w")).height(this.model.get("h")).css({left:this.model.get("x")+"px",top:this.model.get("y")+"px"})},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)}});ShapeView.patternIdCount=0,ShapeView.filterType={SHADOW:"shadow",BLUR:"blur",VIGNETTE:"vignette",TINT:"hue-rotate",PRESET:"preset"};var ImageElementView=Backbone.View.extend({className:"image-element custom-element",events:{click:"onClick"},initialize:function(){this.image=null,this.preloadImage=new Image,this.imgSrcAppend=null,this.model.get("subType")!==ImageElementType.COLOR?this.model.get("w")&&this.model.get("h")?this.createImage():this.model.set("status",ContentLoaderStatus.ERROR):this.setColor(),this.resize(this.model.get("scale"))},decodeShadowFilter:function(t){var e,i=this.model.get("scale")*this.model.get("oldEditorScaling");return t?(e="rgba("+t.r+", "+t.g+", "+t.b+", "+t.a+")","drop-shadow("+t.x*i+"px "+t.y*i+"px "+t.blur*i+"px "+e+")"):""},getFilters:function(t){var e,i="";for(e in t)if(Object.prototype.hasOwnProperty.call(t,e)&&t)switch(e){case ShapeView.filterType.BLUR:i+=" "+e+"("+parseFloat(t[e].toFixed(2))+"px)";break;case ShapeView.filterType.TINT:i+=" "+e+"("+t[e]+"turn)";break;case ShapeView.filterType.VIGNETTE:case ShapeView.filterType.SHADOW:case ShapeView.filterType.PRESET:i+="";break;default:i+=" "+e+"("+t[e]+")"}return i},getVignetteStyle:function(t,e,i){var o=Math.min(e,i)/2;return"0 0 "+o+"px "+o/4+"px rgba(0,0,0,"+Math.max(t,.01)+") inset"},getContainerFilter:function(t){return this.decodeShadowFilter(t)},getBorder:function(t,e){return t?Math.ceil(t.width*e)+"px solid "+t.color:null},render:function(){var t,e,i,o=this.model.get("scale")/2,s="unset",n=this.model.get("imageScale"),a=n&&n.x?n.x:1,l=n&&n.y?n.y:1;return this.$el.css({opacity:parseFloat(this.model.get("alpha"))}),this.image&&(t=parseInt(this.model.get("rotation"),10),this.model.get("filter")&&this.model.get("filter")[ShapeView.filterType.BLUR]&&(s="hidden"),e={transform:"rotate("+t+"deg)","-webkit-transform":"rotate("+t+"deg)","-moz-transform":"rotate("+t+"deg)","-ms-transform":"rotate("+t+"deg)","-o-transform":"rotate("+t+"deg)",border:this.getBorder(this.model.get("border"),o),borderRadius:this.model.get("radius")*o+"px",filter:this.getFilters(this.model.get("filter"))},this.$el.css({overflow:s}),this.image.$el.css(e),this.model.get("filter")&&this.model.get("filter")[ShapeView.filterType.SHADOW]&&this.$el.css({filter:this.getContainerFilter(this.model.get("filter")[ShapeView.filterType.SHADOW])}),this.model.get("filter")&&this.model.get("filter")[ShapeView.filterType.VIGNETTE]&&this.image.$el.find(".vignette-layer").css({boxShadow:this.getVignetteStyle(this.model.get("filter")[ShapeView.filterType.SHADOW],this.model.get("w"),this.model.get("h"))}),1===a&&1===l||(i={transform:"scale("+a+", "+l+")","-webkit-transform":"scale("+a+", "+l+")","-moz-transform":"scale("+a+", "+l+")","-ms-transform":"scale("+a+", "+l+")","-o-transform":"scale("+a+", "+l+")"},this.image.$el.find(".fsw-simpleimage").css(i))),this.model.get("url")&&this.$el.find("a").attr({href:this.model.get("url"),target:"_blank"}),this},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},resize:function(t){this.model.set("scale",t),this.model.setBounds(),this.$el.css({width:this.model.get("w")+"px",height:this.model.get("h")+"px",left:this.model.get("x")+"px",top:this.model.get("y")+"px"}),this.image&&(this.resizeImage(t/2),this.loadImageSpecificSize(t))},loadImageSpecificSize:function(){var t=this.getImageSrcAppend();this.imgSrcAppend!==t&&(this.imgSrcAppend=t,this.loadImage(t))},getImageSrcAppend:function(){var t=this.getPageDimensions(),e=null,i=this.image.model.get("width"),o=this.image.model.get("height"),s=this.image.model.get("cropData");return s&&s.width&&s.height&&(i/=s.width,o/=s.height),e=(e=this.image?FSUtils.getImageSizeType(i,o):FSUtils.getImageSizeType(t.width,t.height))===ImageTypes.THUMB?ImageTypes.SMALL:e,ImageSizeAppend[e]},getPageDimensions:function(){var t=this.model.get("scale"),e=FSWidgetModel.gi().getFirstPage();return{width:e.get("width")*t,height:e.get("height")*t}},loadImage:function(t){var e=this,i=function(){e.image.$el.find(".fsw-simpleimage").attr("src",e.preloadImage.src)};this.preloadImage.removeEventListener("load",i,this),this.preloadImage.addEventListener("load",i,this),this.preloadImage.src=this.model.getImageURL(this.model.get("src")+t,this.model.get("subType"))},resizeImage:function(t){if(this.image){var e="unset",i=this.model.get("w"),o=this.model.get("h"),s=parseInt(this.model.get("rotation"),10),n=FSWidgetModel.gi().widgetSettings.get("editorVersion");!(void 0===n||n<2)||90!==s&&270!==s||(i=this.model.get("h"),o=this.model.get("w"),this.image.$el.css({left:((this.model.get("w")-i)/2).toFixed(2)+"px",top:((this.model.get("h")-o)/2).toFixed(2)+"px"})),this.model.get("filter")&&this.model.get("filter")[ShapeView.filterType.BLUR]&&(e="hidden"),this.$el.css({overflow:e}),this.image.$el.css({border:this.getBorder(this.model.get("border"),t),borderRadius:this.model.get("radius")*t+"px",filter:this.getFilters(this.model.get("filter"))}),this.model.get("filter")&&this.model.get("filter").vignette&&this.image.$el.find(".vignette-layer").css({boxShadow:this.getVignetteStyle(this.model.get("filter").vignette,this.model.get("w"),this.model.get("h"))}),this.model.get("filter")&&this.model.get("filter")[ShapeView.filterType.SHADOW]&&this.$el.css({filter:this.getContainerFilter(this.model.get("filter")[ShapeView.filterType.SHADOW])}),this.image.model.set({width:i,height:o})}},createImage:function(){var t=90===parseInt(this.model.get("rotation"),10)||270===parseInt(this.model.get("rotation"),10),e=this.model.get("scaleMode"),i=t?this.model.get("h"):this.model.get("w"),o=t?this.model.get("w"):this.model.get("h");e="none"===e?"stretch":e,this.image=new SimpleLoader({model:new SimpleLoaderModel({scaleMode:e,width:i,height:o,showPreloader:!1,cropData:this.model.get("cropData")?this.model.get("cropData").proportions:null,isMapped:!!this.model.get("productFeedProperty")})});var s=this.getImageSrcAppend(),n=this.model.getImageURL(this.model.get("src")+s,this.model.get("subType"));this.image.model.set("source",n),this.listenTo(this.image.model,"change:status",(function(){var t=this.image.model.get("status");t===ContentLoaderStatus.ERROR&&null!==this.getImageSrcAppend()&&this.image.model.set("source",this.model.getImageURL(this.model.get("src"),this.model.get("subType"))),t!==ContentLoaderStatus.COMPLETE&&t!==ContentLoaderStatus.ERROR||this.model.set("status",t)})),"tile"!==e?this.$el.append(this.image.render().$el):this.image.model.get("status")!==ContentLoaderStatus.COMPLETE?this.listenTo(this.image.model,"change:status",this.createTile):this.createTile()},createTile:function(){var t,e,i;this.image.model.get("status")===ContentLoaderStatus.COMPLETE&&(t=this.image.model.get("originalWidth")/this.model.get("ow")*100,e=this.image.model.get("originalHeight")/this.model.get("oh")*100,i=this.model.getImageURL(this.model.get("src"),this.model.get("subType")),this.$el.css("background","url("+i+") repeat scroll 0% 0% / "+t+"% "+e+"%"))},setColor:function(){this.$el.css({backgroundColor:"#"+this.model.get("color")})},remove:function(){this.image&&(this.stopListening(this.image.model),this.image.remove(),this.image=null),Backbone.View.prototype.remove.apply(this,arguments)}}),InteractionPopin=Backbone.View.extend({template:_.template(CustomContentTemplates.interactionPopin),className:"interaction-popin",initialize:function(){this.listenTo(this.model,"change",this.setupPopin),this.displayTimeout=0},setupPopin:function(){if(!("isDisplayed"in this.model.changed)){var t=this.model.get("x"),e=this.model.get("y"),i=this.model.get("w"),o=this.model.get("h"),s=this.model.get("interaction").width,n=this.model.get("interaction").height,a=InteractionPopinContent.CONTENT_PADDING,l={};switch("cid"in this.model.changed&&this.$el.html(this.template(this.model.attributes)),this.$el.find(".content").css({width:s+"px",height:n+"px",padding:a+"px"}),this.model.get("interaction").positionActionType){case InteractionPopinPosition.TOP:l.left=t+(i-s)/2+"px",l.top=e-InteractionPopinContent.MARGIN-n+"px",this.addCssClass("top");break;case InteractionPopinPosition.TOP_RIGHT:l.left=t+i-s/2+"px",l.top=e-InteractionPopinContent.MARGIN-n+"px",this.addCssClass("top");break;case InteractionPopinPosition.TOP_LEFT:l.left=t-s/2+"px",l.top=e-InteractionPopinContent.MARGIN-n+"px",this.addCssClass("top");break;case InteractionPopinPosition.BOTTOM:l.left=t+(i-s)/2+"px",l.top=e+o+InteractionPopinContent.MARGIN+"px",this.addCssClass("bottom");break;case InteractionPopinPosition.BOTTOM_RIGHT:l.left=t+i-s/2+"px",l.top=e+o+InteractionPopinContent.MARGIN+"px",this.addCssClass("bottom");break;case InteractionPopinPosition.BOTTOM_LEFT:l.left=t-s/2+"px",l.top=e+o+InteractionPopinContent.MARGIN+"px",this.addCssClass("bottom");break;case InteractionPopinPosition.LEFT:l.left=t-InteractionPopinContent.MARGIN-s+"px",l.top=e+(o-n)/2+"px",this.addCssClass("left");break;default:l.left=t+i+InteractionPopinContent.MARGIN+"px",l.top=e+(o-n)/2+"px",this.addCssClass("right")}this.$el.css(l),this.$el.find(".interaction-popin-title").css({fontSize:InteractionPopinContent.TITLE_FONT_SIZE+"px"}),this.$el.find(".interaction-popin-description").css({fontSize:InteractionPopinContent.DESCRIPTION_FONT_SIZE+"px",margin:InteractionPopinContent.DESCRIPTION_MARGIN+"px 0"})}},render:function(){return this},show:function(){var t=this;clearTimeout(this.displayTimeout),this.$el.show(),this.model.set("isDisplayed",!0),this.displayTimeout=setTimeout((function(){t.$el.css("opacity",1)}),30),Backbone.Mediator.pub(CustomContentEvent.CUSTOM_INTERACTION_POPIN_DISPLAYED)},hide:function(){var t=this;clearTimeout(this.displayTimeout),this.$el.css("opacity",0),this.model.set("isDisplayed",!1),this.displayTimeout=setTimeout((function(){t.$el.hide()}),100),Backbone.Mediator.pub(CustomContentEvent.CUSTOM_INTERACTION_POPIN_HIDDEN)},addCssClass:function(t){this.$el.hasClass(t)||(this.$el.removeClass("bottom top right left"),this.$el.addClass(t))}}),InteractionView=Backbone.View.extend({className:"interaction",template:_.template(CustomContentTemplates.interaction),events:{"click .interaction-link":"setPageInteraction","mouseover .interaction-link":"onMouseOver","mouseout .interaction-link":"onMouseOut","mousemove .interaction-link":"onMouseMove","mouseup .interaction-link":"onMouseUp","mousedown .interaction-link":"onMouseDown","dragstart .interaction-link":"onDragStart","mouseenter .interaction-link":"mouseEnter","mouseleave .interaction-link":"mouseLeave"},initialize:function(){this.shouldOpenLink=!0,this.interaction=this.model.attributes.interaction,this.interactionType=this.interaction.interactionType,this.tooltip=this.interaction.popinTooltip,this.actionType=this.interaction.actionType,this.isMobileDevice=FSUtils.isMobileDevice(),this.hasTooltip=this.interaction.openActionType===InteractionPopinTrigger.CLICK&&this.tooltip&&this.tooltip.length>0,this.button=null,this.isPopinDisplayed=!1,Backbone.Mediator.sub(CustomContentEvent.CUSTOM_INTERACTION_POPIN_DISPLAYED,this.hideTooltip,this),Backbone.Mediator.sub(CustomContentEvent.CUSTOM_INTERACTION_POPIN_HIDDEN,this.canShowTooltip,this)},render:function(){var t=parseInt(this.model.get("rotation"),10);switch(this.$el.html(this.template()),this.$el.css({backgroundColor:this.model.get("interaction").color,opacity:0,transform:"rotate("+t+"deg)","-webkit-transform":"rotate("+t+"deg)","-moz-transform":"rotate("+t+"deg)","-ms-transform":"rotate("+t+"deg)","-o-transform":"rotate("+t+"deg)"}),this.setElementPosition(),this.button=this.$el.find("a"),this.interactionType){case InteractOptions.LINK:this.setLinkInteraction(this.button,this.interaction);break;case InteractOptions.PAGE:this.setPageTooltip(this.button,this.interaction)}return this.$el.on("click",$.proxy(this,"onLinkClick")),this},resize:function(t){this.model.set("scale",t),this.model.setBounds(),this.setElementPosition()},setElementPosition:function(){this.$el.css({left:this.model.get("x"),top:this.model.get("y"),width:this.model.get("w"),height:this.model.get("h")})},setLinkInteraction:function(t,e){t.attr("target","_blank"),t.attr("href",e.url),t.attr("title",e.tooltip)},setPageTooltip:function(t,e){t.attr("title",e.actionTooltip)},hideTooltip:function(t){!this.isMobileDevice&&this.hasTooltip&&(Backbone.Mediator.pub(CustomContentEvent.HIDE_CUSTOM_TOOLTIP),t||(this.isPopinDisplayed=!0))},canShowTooltip:function(){!this.isMobileDevice&&this.hasTooltip&&(this.isPopinDisplayed=!1)},onMouseOver:function(){this.$el.css("opacity","number"==typeof this.model.get("interaction").alpha?this.model.get("interaction").alpha:.3),this.isMobileDevice||!this.hasTooltip||this.isPopinDisplayed||Backbone.Mediator.pub(CustomContentEvent.SHOW_CUSTOM_TOOLTIP,this.tooltip)},onMouseOut:function(){this.$el.css("opacity",0),this.hideTooltip(!0)},setShouldOpenLink:function(t){this.shouldOpenLink=t},onLinkClick:function(t){return!!this.shouldOpenLink||(t.preventDefault(),t.stopPropagation(),!1)},onMouseMove:function(t){this.setShouldOpenLink(!1),this.isMobileDevice||!this.hasTooltip||this.isPopinDisplayed||Backbone.Mediator.pub(CustomContentEvent.MOVE_CUSTOM_TOOLTIP,t),t.preventDefault()},onMouseUp:function(){this.$el.find("a")[0].removeEventListener("click",this.onLinkClick)},onDragStart:function(t){return t.preventDefault(),!1},onMouseDown:function(){this.setShouldOpenLink(!0)},mouseEnter:function(){this.interaction.openActionType===InteractionPopinTrigger.HOVER&&this.showPopin()},mouseLeave:function(){this.interaction.openActionType===InteractionPopinTrigger.HOVER&&this.hidePopin()},setPageInteraction:function(t){var e,i,o=FSWidgetModel.gi().widgetState.get("currentItem").get("noOfPages");if(this.interactionType!==InteractOptions.LINK&&(t.preventDefault(),t.stopPropagation()),this.registerClickEvent(),this.sendClickNotification(),this.interactionType!==InteractOptions.POPIN||this.interaction.openActionType!==InteractionPopinTrigger.CLICK)switch(this.actionType){case GoToActions.GO_TO_PREV_PAGE:Backbone.Mediator.pub(WidgetEvent.PREV_PAGE);break;case GoToActions.GO_TO_NEXT_PAGE:Backbone.Mediator.pub(WidgetEvent.NEXT_PAGE);break;case GoToActions.GO_TO_FIRST_PAGE:Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,0);break;case GoToActions.GO_TO_LAST_PAGE:Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,o-1);break;case GoToActions.GO_TO_PAGE:e=parseInt(this.interaction.pageNumber||1,10)-1,i=FSWidgetModel.gi().singlePageView||e%2!=0?e:e-1,i=Math.min(Math.max(0,i),o-1),FSWidgetModel.gi().arabicStyle&&(i=o-i-1),Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,i)}else this.togglePopin()},showPopin:function(){var t=_.extend({cid:this.cid},this.model.attributes);this.trigger(CustomContentEvent.SHOW_CUSTOM_INTERACTION_POPIN,t)},hidePopin:function(){this.trigger(CustomContentEvent.HIDE_CUSTOM_INTERACTION_POPIN)},togglePopin:function(){var t=_.extend({cid:this.cid},this.model.attributes);this.trigger(CustomContentEvent.TOGGLE_CUSTOM_INTERACTION_POPIN,t)},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},remove:function(){this.button&&this.button.off(),Backbone.View.prototype.remove.apply(this,arguments)}}),AudioPlayer=Backbone.View.extend({initialize:function(){this.isPlaying=!1,this.audioPlayer=this.createAudioPlayer(),Backbone.Mediator.sub(CustomContentEvent.PLAY_AUDIO,this.playAudio,this),Backbone.Mediator.sub(CustomContentEvent.STOP_AUDIO,this.stopAudio,this)},createAudioPlayer:function(){var t=document.createElement("audio"),e=this;return t.id="audioPlayer",t.preload="auto",t.style.position="absolute",t.addEventListener("ended",(function(){e.hAudioEnd()})),t.addEventListener("pause",(function(){e.stopAudio()})),t},playAudio:function(t){this.audioPlayer&&this.isPlaying&&this.stopAudio(),this.model.set("audioHash",t.audioHash),this.model.set("pageIndex",t.pageIndex),this.model.set("customElementIndex",t.customElementIndex),this.model.set("autoplay",t.autoplay),this.model.set("enableCustomDuration",t.enableCustomDuration),this.model.set("audioInterval",t.audioInterval);var e=FSWidgetModel.gi().get("isDownload")?".mp3":"";if(this.audioPlayer){var i=this.model.get("audioInterval");let t="";this.model.get("enableCustomDuration")&&i&&i.length&&(t=i.map((t=>t/1e3)),t="#t="+t.join(",")),this.audioPlayer.src=URLPaths.UPLOADS_PATH+this.model.get("audioHash")+e+t,this.audioPlayer.play(),this.isPlaying=!0,Backbone.Mediator.pub(CustomContentEvent.AUDIO_STARTED,{pageIndex:this.model.get("pageIndex"),customElementIndex:this.model.get("customElementIndex"),audioHash:this.model.get("audioHash"),autoplay:this.model.get("autoplay"),enableCustomDuration:this.model.get("enableCustomDuration"),audioInterval:this.model.get("audioInterval")})}},stopAudio:function(){this.audioPlayer&&this.isPlaying&&(this.audioPlayer.pause(),this.audioPlayer.currentTime=0,this.hAudioEnd())},hAudioEnd:function(){this.isPlaying=!1,Backbone.Mediator.pub(CustomContentEvent.AUDIO_STOPPED,{pageIndex:this.model.get("pageIndex"),customElementIndex:this.model.get("customElementIndex"),audioHash:this.model.get("audioHash"),autoplay:this.model.get("autoplay"),enableCustomDuration:this.model.get("enableCustomDuration"),audioInterval:this.model.get("audioInterval")})}});AudioPlayer._instance=null,AudioPlayer.gi=function(){return AudioPlayer._instance||(AudioPlayer._instance=new AudioPlayer({model:new Backbone.Model})),AudioPlayer._instance};var ImageMaskView=Backbone.View.extend({className:"image-mask custom-element",events:{click:"onClick"},initialize:function(){this.clipPathID="mask_"+this.model.get("elementPageIndex")+"_"+this.model.get("index"),this.svg=null,this.paths=new Array,this.svgimg=null,this.pathWidth=0,this.pathHeight=0,this.imgSrcAppend=null,this.preloadImage=new Image,this.loadMaskShape(),this.resize(this.model.get("scale"))},render:function(){return this},resize:function(t){this.model.set("scale",t),this.model.setBounds(),this.$el.css({left:this.model.get("x")+"px",top:this.model.get("y")+"px"}),this.svg&&(this.setShapeSize(),this.setImageSize())},createImage:function(){this.model.get("src").length>0&&(this.svgimg=document.createElementNS(ImageMaskView.SVG_NAMESPACE,"image"),this.svgimg.setAttribute("clip-path","url(#"+this.clipPathID+")"),this.svg.appendChild(this.svgimg))},loadMaskShape:function(){var t,e,i=parseInt(this.model.get("shape"),10);(i=0===i?1:i)&&(SvgLoader.getLoadedShapes()[i]?this.renderShape($(SvgLoader.getLoadedShapes()[i])):(t=new SvgLoader(i,SymbolType.SHAPE),e=this,t.loadSVG(e,(function(t){SvgLoader.addLoadedShape(i,t),e.renderShape(t)}))))},renderShape:function(t){this.createMask($(t)),this.setShapeSize(),this.createImage(),this.setImageSize(),this.$el[0].appendChild(this.svg),this.$el.css("opacity",parseFloat(this.model.get("alpha")))},createMask:function(t){parseInt(this.model.get("rotation"),10);var e,i=document.createElementNS(ImageMaskView.SVG_NAMESPACE,"svg"),o=t[0].attributes.viewBox.value.split(" "),s=this;i.setAttribute("xmlns:xlink",ImageMaskView.XLINK_NAMESPACE),this.pathWidth=parseInt(o[2],10),this.pathHeight=parseInt(o[3],10),(e=document.createElementNS(ImageMaskView.SVG_NAMESPACE,"clipPath")).setAttribute("id",this.clipPathID),i.appendChild(e),this.paths=[],$(t).find("path").each((function(i){let o=document.createElementNS(ImageMaskView.SVG_NAMESPACE,"path");o.setAttribute("fill","#807F7D"),o.setAttribute("d",$(t).find("path")[i].attributes.d.nodeValue),s.paths.unshift(o),e.appendChild(o)})),this.svg=i},setShapeSize:function(){var t,e,i="",o=parseInt(this.model.get("rotation"),10),s=this.model.get("w"),n=this.model.get("h"),a=Math.abs(s-n)/2,l=s/parseFloat(this.model.get("bounds").split(",")[2]),d=ImageMaskView.ROUNDED_RECTANGLE_RADIUS*l;0===parseInt(this.model.get("shape"),10)&&"true"===this.model.get("roundedCorners")&&(i+="border-radius: "+d+"px;"),o>0&&(i+="transform: rotateZ("+o+"deg);",90!==o&&270!==o||FSWidgetModel.gi().widgetSettings.get("editorVersion")||(a>0&&(i+="margin-left:"+(s/n>1?a:-a)+"px;margin-top:"+(s/n>1?-a:a)+"px;"),s=this.model.get("h"),n=this.model.get("w"))),this.svg.setAttribute("style",i),this.svg.setAttribute("width",s.toString()),this.svg.setAttribute("height",n.toString()),this.svg.setAttribute("viewbox","0 0 "+s+" "+n),t=s/this.pathWidth,e=n/this.pathHeight,this.paths.forEach((function(i){i.setAttribute("transform","scale("+t+", "+e+")")}))},setImageSize:function(){this.svgimg.setAttribute("width","100%"),this.svgimg.setAttribute("height","100%"),this.svgimg.setAttribute("x",0),this.svgimg.setAttribute("y",0),this.svgimg.setAttribute("preserveAspectRatio","xMidYMid slice"),this.loadImageSpecificSize()},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},loadImageSpecificSize:function(){var t=this.getImageSrcAppend();this.imgSrcAppend!==t&&(this.imgSrcAppend=t,this.loadImage(t))},getImageSrcAppend:function(){var t=null;return t=(t=FSUtils.getImageSizeType(this.model.get("imgw"),this.model.get("imgh")))===ImageTypes.THUMB?ImageTypes.SMALL:t,ImageSizeAppend[t]},loadImage:function(t){var e=this,i=function(){e.svgimg.setAttributeNS(ImageMaskView.XLINK_NAMESPACE,"href",e.preloadImage.src)},o=function(){e.preloadImage.removeEventListener("error",o,e),e.preloadImage.src=e.model.getImageURL(e.model.get("src"),e.model.get("subType"))};this.preloadImage.removeEventListener("load",i,this),this.preloadImage.removeEventListener("error",o,this),this.preloadImage.addEventListener("load",i,this),this.preloadImage.addEventListener("error",o,this),this.preloadImage.src=this.model.getImageURL(this.model.get("src")+t,this.model.get("subType"))}});ImageMaskView.SVG_NAMESPACE="http://www.w3.org/2000/svg",ImageMaskView.XLINK_NAMESPACE="http://www.w3.org/1999/xlink",ImageMaskView.ROUNDED_RECTANGLE_RADIUS=20;var EmbedElemetView=Backbone.View.extend({placeHolderTemplate:_.template(CustomContentTemplates.embedPlaceHolder),template:_.template(CustomContentTemplates.embedIframe),className:"embed-element custom-element",events:{click:"onClick"},initialize:function(){this.$iframe=null},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},resize:function(t){t!==this.model.get("scale")&&(this.model.set("scale",t),this.model.setBounds(),this.setCSS())},setCSS:function(){this.$el.width(this.model.get("w")).height(this.model.get("h")).css({left:this.model.get("x")+"px",top:this.model.get("y")+"px"})},render:function(){return this.model.get("content")&&this.model.get("content").length&&this.model.get("valid")?this.$el.html(this.template({content:encodeURIComponent(this.model.get("content")),baseUrl:FlipSnackEmbed.urls.baseUrl,htmlSources:FlipSnackEmbed.urls.htmlSources})):this.$el.html(this.placeHolderTemplate(this.model.attributes)),this.$iframe=this.$el.find("iframe"),this.$iframe&&this.$iframe.is("iframe")&&(this.$iframe.removeAttr("allowfullscreen"),this.$iframe.removeAttr("allow")),this.setCSS(),this},remove:function(){Backbone.View.prototype.remove.apply(this,arguments)}}),ProductTagView=Backbone.View.extend({template:_.template(CustomContentTemplates.productTag),className:"product-tag custom-tag custom-element",events:{click:"onClick"},onClick:function(){Backbone.Mediator.pub(WidgetEvent.OPEN_PRODUCT_TAG_POPIN,this.model.attributes),this.registerClickEvent(),this.sendClickNotification()},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},resize:function(t){t!==this.model.get("scale")&&(this.model.set("scale",t),this.model.setBounds(),this.setCSS(),Backbone.Mediator.pub(WidgetEvent.SCALE_PRODUCT_TAG_POPIN,t))},setCSS:function(){var t=this.model.attributes;this.$el.css({left:t.x,top:t.y,width:this.model.get("w"),height:this.model.get("h")}),this.colorRing.css({border:this.model.get("w")/6+"px solid #"+t.color,left:2,top:2,width:this.model.get("w")-4,height:this.model.get("h")-4,opacity:this.model.get("alpha")||0===this.model.get("alpha")?this.model.get("alpha"):1}),this.innerTag.css({background:"#"+t.color})},render:function(){return this.$el.html(this.template()),this.tag=this.$el.find(".tag"),this.animationRing=this.tag.find(".animation-ring"),this.colorRingHover=this.tag.find(".color-ring-hover"),this.colorRing=this.tag.find(".color-ring"),this.innerTag=this.tag.find(".inner-tag"),this.setCSS(),this},remove:function(){Backbone.View.prototype.remove.apply(this,arguments)}}),TableView=Backbone.View.extend({events:{click:"onClick"},template:_.template(CustomContentTemplates.table),className:"table-element custom-element",initialize:function(){this.setCSS()},resize:function(t){t!==this.model.get("scale")&&(this.model.set("scale",t),this.model.setBounds(),this.render())},setCSS:function(){this.$el.css({left:this.model.get("x")+"px",top:this.model.get("y")+"px",width:this.model.get("w")+"px",height:this.model.get("h")+"px"})},render:function(){var t=document.createElement("div"),e=this.model.attributes.rows,i=document.createElement("tbody"),o=this.model.attributes.scale*this.model.get("oldEditorScaling");return e.forEach((function(t,e){var s=document.createElement("tr");t.forEach((function(t,e){var i=document.createElement("td");i.style.width=t.width*o+"px",i.style.height=t.height*o+"px",i.style.backgroundColor=t.background,i.style.borderTopColor=t.border.top.color,i.style.borderLeftColor=t.border.left.color,i.style.borderBottomColor=t.border.bottom.color,i.style.borderRightColor=t.border.right.color,i.style.borderTopStyle="solid",i.style.borderLeftStyle="solid",i.style.borderBottomStyle="solid",i.style.borderRightStyle="solid",i.style.textAlign="center",i.style.overflow="hidden";var n=document.createElement("div"),a=document.createElement("span");a.style.display="block",a.style.maxWidth="100%",a.style.padding="10px";var l=t.elements[0].textStyle;if(l){var d=Object.keys(l);d.length&&d.forEach((function(t){"zoom"!==t&&(n.style[t]="fontSize"===t||"letterSpacing"===t?l[t]+"px":l[t])}))}if(n.style.textAlign="center",n.style.position="absolute",n.style.transform="translateY(0em) scale("+o+")",n.style.transformOrigin="left top 0px",n.style.width=t.width+"px",n.style.height=t.height+"px",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.overflowWrap="break-word",n.style.whiteSpace="pre-wrap",t.elements&&t.elements[0]&&t.elements[0].nodes&&t.elements[0].nodes[0]){var h=document.createElement(t.elements[0].nodes[0].tag);h.innerText=t.elements[0].nodes[0].text;var r=t.elements[0].nodes[0];if(r.style){var c=Object.keys(r.style);c.length&&c.forEach((function(t){h.style[t]="fontSize"===t||"letterSpacing"===t?r.style[t]+"px":r.style[t]}))}a.appendChild(h),n.appendChild(a),i.appendChild(n)}s.appendChild(i)})),i.appendChild(s)})),t.appendChild(i),this.model.set("tableBody",t.innerHTML),this.$el.html(this.template(this.model.attributes)),this.$el.find("table").attr("border","1"),this.setCSS(),this},onClick:function(){this.registerClickEvent(),this.sendClickNotification()},registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},sendClickNotification:function(){Backbone.Mediator.pub(CustomContentEvent.CUSTOM_CONTENT_CLICK,this.model)}}),SlideshowView=Backbone.View.extend({placeHolderTemplate:_.template(CustomContentTemplates.slideshowPlaceHolder),template:_.template(CustomContentTemplates.slideshow),className:"slideshow-container custom-element",registerClickEvent:function(){Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.CLICK_ELEMENT,pid:this.model.get("pid"),elid:this.model.get("eID")})},getImageSrcAppend:function(t,e){var i=null;return i=(i=FSUtils.getImageSizeType(t,e))===ImageTypes.THUMB?ImageTypes.SMALL:i,ImageSizeAppend[i]},resize:function(t){t!==this.model.get("scale")&&(this.model.set("scale",t),this.model.setBounds(),this.setCSS(this.model.get("media")))},getImageSrc:function(t){if(t.provider&&"external"===t.provider){var e=FSWidgetModel.gi().get("accountId"),i=window.URLPaths.CONTENT_PATH.length?"/":"";return window.URLPaths.CONTENT_PATH+i+e+"/library/external/"+t.hash}return FlipSnackEmbed.urls.uploadPath+t.hash},setCSS:function(t){var e=this.model.get("w"),i=this.model.get("h"),o={height:"100%",display:"flex",justifyContent:"center",alignItems:"center"};if(this.$el.css({width:e+"px",height:i+"px",left:this.model.get("x")+"px",top:this.model.get("y")+"px",position:"absolute",backgroundColor:"rgba(242, 242, 242, 0.9)",backgroundPosition:"center",opacity:this.model.get("alpha")||0===this.model.get("alpha")?this.model.get("alpha"):1}),t.length){var s="",n=t[0];if(n)if(FSWidgetModel.gi().get("isDownload"))s=this.getImageSrc(n);else{var a=this.getImageSrcAppend(e,i);s=this.getImageSrc(n)+a}this.$el.css({backgroundRepeat:"no-repeat",backgroundSize:"contain",backgroundImage:"url("+s+")",backgroundColor:"transparent"}),this.slideshowElement.css(o)}else this.$el.find(".slideshow-empty").css(o),this.$el.find(".slideshow-icon").css({height:"30%",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",top:"50%"})},render:function(){var t=this.model.get("media");return t.length?(this.$el.html(this.template()),this.slideshowElement=this.$el.find(".slideshow-element")):this.$el.html(this.placeHolderTemplate()),this.setCSS(t),this}});