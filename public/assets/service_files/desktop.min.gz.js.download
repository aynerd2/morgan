var FlipTemplates={flipPageNavigation:'<div class="page-navigation-view" ignore="1"><% if(!player) { %><div class="flip-previous-page nav-button"><svg class="nav-button" width="36" height="93" viewBox="0 0 36 93" xmlns="http://www.w3.org/2000/svg"><path class="nav-button" d="M29.958 0L0 46.035l29.958 46.02H36L6.042 46.035 36 0z" /></svg></div><div class="flip-next-page nav-button"><svg class="nav-button" width="36" height="93" viewBox="0 0 36 93" xmlns="http://www.w3.org/2000/svg"><path class="nav-button" d="M6.042 0L36 46.035 6.042 92.055H0l29.958-46.02L0 0z" /></svg></div><% } else { %><div class="flip-previous-page nav-button previous-player"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="47" viewBox="0 0 33 54"><path d="M.967 25.44l19.338 19.906c1.29 1.267 2.438 1.267 3.728 0 1.29-1.266 1.29-2.392 0-3.658L6.087 23.148l17.945-18.54c1.29-1.266 1.29-2.392 0-3.658-1.29-1.267-2.437-1.267-3.727 0L.967 20.856a3.2 3.2 0 000 4.584z" fill="#FFF" fill-rule="evenodd"/></svg></div><div class="flip-next-page nav-button next-player"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="47" viewBox="0 0 33 54"><path d="M24.033 25.44L4.695 45.346c-1.29 1.267-2.438 1.267-3.728 0-1.29-1.266-1.29-2.392 0-3.658l17.946-18.54L.968 4.608C-.322 3.342-.322 2.216.968.95c1.29-1.267 2.437-1.267 3.727 0l19.338 19.906a3.2 3.2 0 010 4.584z" fill="#FFF" fill-rule="evenodd"/></svg></div><% } %></div>',flipItemNavigation:'<div class="left-container"><span class="action"><i></i> <%- prevlabel %></span></div><div class="right-container"><span class="action"><%- nextlabel %> <i></i></span></div>',leftPageContainer:'<div class="hardcover-gradient"></div><div class="gradient"></div><div class="page-content"><div class="image-container"></div><div class="link-container"></div><div class="custom-content-container"></div></div>',rightPageContainer:'<div class="hardcover-gradient"></div><div class="even"><div class="gradient"></div></div><div class="gradient"></div><div class="page-content"><div class="image-container"></div><div class="link-container"></div><div class="custom-content-container"></div></div>',documentViewContainer:'<div id="viewLimiter"><div id="docView"></div></div>'},FlipEvents={PREVIOUS_ITEM:"previousItem",NEXT_ITEM:"nextItem",PREVIOUS_PAGE:"previousPage",NEXT_PAGE:"nextPage",FLIP_START:"flipStart",FLIP_END:"flipEnd",FLIP_TAP:"flipTap",FLIP_POSITIONED:"flipPositioned"},DocumentModel=Backbone.Model.extend({defaults:{collectionSize:[640,385],maxSize:[640,385],displayType:"small",item:void 0,currentPageIndex:0,offset:{},navButtonWidth:40,singlePageView:!1,arabicStyle:!1,enableSounds:!1,showPageShadows:!1,mergePdfs:!1,retryFirstImage:!1,status:ContentLoaderStatus.IDLE}}),ItemNavigationView=Backbone.View.extend({events:function(){return FSUtils.isMobileDevice()?{"touchend .left-container span":"previousItem","touchend .right-container span":"nextItem"}:{"click .left-container span":"previousItem","click .right-container span":"nextItem"}},id:"itemNavigationView",template:_.template(FlipTemplates.flipItemNavigation),initialize:function(){this.listenTo(this.model,"change:collectionSize",this.resize),this.listenTo(this.model,"change:totalItems",this.render),this.listenTo(this.model,"change:currentItem",this.render),this.listenTo(FSWidgetModel.gi(),"change:labels",this.updateLabels),this.resize()},render:function(){return this.$el.html(this.template(this.model.attributes)),0===this.model.get("currentItem")?(this.$el.find(".left-container span").hide(),this.$el.find(".right-container span").show()):this.model.get("currentItem")===this.model.get("totalItems")-1?(this.$el.find(".left-container span").show(),this.$el.find(".right-container span").hide()):(this.$el.find(".left-container span").show(),this.$el.find(".right-container span").show()),this},updateLabels:function(){this.model.set({prevlabel:FSWidgetModel.gi().get("labels").l_prevLabelText,nextlabel:FSWidgetModel.gi().get("labels").l_nextLabelText}),this.render()},resize:function(){this.model.get("collectionSize")[0]<FlipView.SMALL_MAX_WIDTH||this.model.get("collectionSize")[1]<FlipView.SMALL_MAX_HEIGHT?this.$el.addClass("small"):this.$el.removeClass("small")},show:function(){this.$el.show()},hide:function(){this.$el.hide()},getHeight:function(){return this.$el.height()+parseInt(this.$el.css("margin-top"),10)+parseInt(this.$el.css("margin-bottom"),10)},previousItem:function(){this.trigger(FlipEvents.PREVIOUS_ITEM)},nextItem:function(){this.trigger(FlipEvents.NEXT_ITEM)},remove:function(){this.$el.find(".left-container span").off(),this.$el.find(".right-container span").off(),Backbone.View.prototype.remove.apply(this,arguments)}}),PageNavigationView=Backbone.View.extend({events:function(){var e=FSUtils.isMobileDevice()?"touchend":"click",t={};return t[e+" .flip-previous-page"]="previousPage",t[e+" .flip-next-page"]="nextPage",t},template:_.template(FlipTemplates.flipPageNavigation),initialize:function(){this.isPlayerSkin=FSWidgetModel.gi().widgetSettings.get("skinType")===WidgetSkinType.PLAYER,this.setElement(this.template({player:this.isPlayerSkin})),this.previousButton=this.$el.find(".flip-previous-page"),this.nextButton=this.$el.find(".flip-next-page"),this.isMobileDeveice=FSUtils.isMobileDevice(),this.isSmall=!0,this.isZoomed=!1,this.listenTo(this.model,"change",this.modelChanged),Backbone.Mediator.sub(WidgetEvent.ZOOM_CHANGED,this.handleZoomChanged,this),Backbone.Mediator.sub(WidgetEvent.ZOOM_END,this.handleZoomChanged,this),this.resize()},modelChanged:function(){("collectionSize"in this.model.changed||"maxHeight"in this.model.changed||"fullHeight"in this.model.changed||"displayType"in this.model.changed)&&this.resize(),("totalPages"in this.model.changed||"isBuyCurtainDisplayed"in this.model.changed)&&this.render(),("navDistance"in this.model.changed||"maxHeight"in this.model.changed||"flipViewLeft"in this.model.changed)&&this.positionButtons()},render:function(){return this.model.get("isBuyCurtainDisplayed")?(this.hidePrevious(),this.hideNext(),this):(0===this.model.get("currentPage")?(this.hidePrevious(),this.showNext()):this.model.get("currentPage")===this.model.get("totalPages")-1?(this.showPrevious(),this.hideNext()):(this.showPrevious(),this.showNext()),this)},showPrevious:function(){this.previousButton.css("opacity",1)},hidePrevious:function(){this.previousButton.css("opacity",0)},showNext:function(){this.nextButton.css("opacity",1)},hideNext:function(){this.nextButton.css("opacity",0)},resize:function(){},previousPage:function(){this.trigger(FlipEvents.PREVIOUS_PAGE)},nextPage:function(){this.trigger(FlipEvents.NEXT_PAGE)},positionButtons:function(){var e=FSWidgetModel.gi().widgetSettings.get("singlePageView"),t=this.$el.width(),i=this.getNavButtonWidth(),o=this.model.get("navDistance"),n=Math.ceil((t-o)/2)-i,s=FSWidgetModel.gi().get("height")/10;FSWidgetModel.gi().get("currentZoom")>0?this.positionButtonsInZoom():(e&&FSUtils.isInFullScreen()&&FSUtils.isPortrait()?this.$el.removeClass("visible"):this.$el.addClass("visible"),e||this.$el.removeClass("visible"),this.previousButton.css({left:e?n+"px":-i+"px"}),this.nextButton.css({right:e?n+"px":-i+"px"}),this.previousButton.children().css("height",s),this.nextButton.children().css("height",s))},positionButtonsInZoom:function(){this.previousButton.css({left:"0"}),this.nextButton.css({right:"0"})},remove:function(){this.previousButton.off(),this.nextButton.off(),Backbone.View.prototype.remove.apply(this,arguments)},getNavButtonWidth:function(){return Math.ceil(this.model.get("maxHeight")/10)},getButtonsTotalWidth:function(){return 2*this.getNavButtonWidth()},handleZoomChanged:function(){var e=FSWidgetModel.gi().get("currentZoom");this.positionButtons(),e>0&&!1===this.isZoomed?this.isZoomed=!0:0===e&&!0===this.isZoomed&&(this.isZoomed=!1)}}),DocumentView=Backbone.View.extend({events:function(){return FSUtils.isIOS()?{"touchstart #viewLimiter":"mouseDownDocView","touchend #viewLimiter":"mouseUpDocView"}:{"mouseover .page-wrapper":"mouseOverPage","mouseout .page-wrapper":"mouseOutPage","mouseenter #viewLimiter":"mouseEnterView","mousemove #viewLimiter":"mouseMoveDocView","mousedown #viewLimiter":"mouseDownDocView","mouseup #viewLimiter":"mouseUpDocView"}},template:_.template(FlipTemplates.documentViewContainer),id:"docContainer",initialize:function(){this.$el.html(this.template()),this.arabicStyle=this.model.get("arabicStyle"),this.isMobileDevice=FSUtils.isMobileDevice(),this.isIOS=FSUtils.isIOS(),this.singlePageView=this.model.get("singlePageView"),this.docContainer=this.$el,this.viewLimiter=this.$el.find("#viewLimiter"),this.flipbook=this.$el.find("#docView"),this.customContent={},this.pagesToStopCustomContentOn=[],this.flipSoundUrl=URLPaths.ASSETS_PATH+"page_flip.mp3",this.soundEnabled=!1,this.soundMuted=!1,this.currentZoom=0,this.firstImageRetries=5,this.flipTotalPages=FSWidgetModel.gi().flipCollection.totalPages,this.documentViewObj={},this.pdfLinks={},this.updateSoundSettings(),this.disableRightClick(),this.listenTo(this.model,"change:maxSize",this.resize),this.listenTo(this.model,"change:item",this.initDocumentView),this.listenTo(this.model,"change:currentPageIndex",this.pageChanged),this.listenTo(this.model,"change:singlePageView",this.initDocumentView),this.listenTo(this.model,"change:enableSounds",this.updateSoundSettings),this.listenTo(this.model,"change:showPageShadows",this.setGradientVisibility),Backbone.Mediator.sub(WidgetEvent.LEAD_FORM_SENT,this.closeForm,this),Backbone.Mediator.sub(WidgetEvent.PDF_LINKS_LOADED,this.pdfLinksLoaded,this),Backbone.Mediator.sub(WidgetEvent.MUTE,this.muteFlipSound,this),Backbone.Mediator.sub(WidgetEvent.UN_MUTE,this.unmuteFlipSound,this),Backbone.Mediator.sub(ShelfEvents.SHELF_OPENED,this.handleShelfOpened,this),Backbone.Mediator.sub(ShelfEvents.SHELF_CLOSED,this.handleShelfClosed,this),Backbone.Mediator.sub(WidgetEvent.PREVIEW_PAGES_UPDATED,this.updatePreviewPages,this),Backbone.Mediator.sub(NewShelfEvents.CLOSE_ITEM,this.destroyFlippingBookView,this),this.isMobileDevice?(Backbone.Mediator.sub(WidgetEvent.ZOOM_CHANGED,this.oldDesktopHandleZoomChanged,this),Backbone.Mediator.sub(WidgetEvent.ZOOM_END,this.oldDesktopHandleZoomEnd,this)):(Backbone.Mediator.sub(WidgetEvent.ZOOM_CHANGED,this.oldDesktopHandleZoomChanged,this),Backbone.Mediator.sub(WidgetEvent.ZOOM_END,this.oldDesktopHandleZoomEnd,this),this.initFlipSound(),$(document.body).on("mouseleave",$.proxy(this,"mouseOutBody")),$(document.body).on("mouseup",$.proxy(this,"mouseUpBody")),this.flipbook.on("dblclick",$.proxy(this,"enterZoom")),this.flipbook.on("mousewheel",$.proxy(this,"handleMouseWheel")))},initFlipSound:function(){this.flipSound=document.createElement("audio"),this.flipSound.id="flipSound",this.flipSound.preload="auto",this.flipSound.style.position="absolute",this.flipSound.src=this.flipSoundUrl},playFlipSound:function(){var e;this.flipSound&&this.soundEnabled&&!this.soundMuted&&(0===this.flipSound.currentTime||this.flipSound.currentTime>=.3)&&(this.flipSound.currentTime=0,"undefined"!=typeof Promise&&-1!==Promise.toString().indexOf("[native code]")?void 0!==(e=this.flipSound.play())&&e.then((function(){})).catch((function(){})):this.flipSound.play())},updateSoundSettings:function(){this.soundEnabled=this.model.get("enableSounds")},muteFlipSound:function(){this.soundMuted=!0},unmuteFlipSound:function(){this.soundMuted=!1},destroySound:function(){this.flipSound&&(this.flipSound.pause(),this.flipSound.src="",this.flipSound=null)},render:function(){return this.initDocumentView(),this},resize:function(e){this.oldResize(e)},setDocumentMaxZoom:function(){FSWidgetModel.gi().set("maxZoomValue",DocumentView.MAX_ZOOM_VALUE)},setCustomContentPageSize:function(){this.oldSetCustomContentPageSize()},initDocumentView:function(){this.closeForm(),this.isInFullScreen=FSUtils.isInFullScreen(),this.totalItemPages=this.model.get("item").get("pages").length,this.singlePageView=this.model.get("singlePageView"),this.isDoublePageLayout=FSWidgetModel.gi().flipCollection.get("isDoublePageLayout"),this.isSinglePageLayout=FSWidgetModel.gi().widgetSettings.get("contentLayout")===ContentLayout.SINGLE_PAGE,this.isSmartViewLayout=FSWidgetModel.gi().widgetSettings.get("contentLayout")===ContentLayout.SMART_VIEW,this.flipbook.turn&&this.flipbook.turn("pages")>0&&this.destroyFlippingBookView(),this.singlePageView?this.$el.addClass("single-page-view"):this.$el.removeClass("single-page-view"),this.arabicStyle?this.$el.addClass("right-to-left"):this.$el.removeClass("right-to-left"),!FSWidgetModel.gi().widgetSettings.get("singlePageView")&&this.flipTotalPages>1&&this.flipbook.append(this.model.get("navigationView").render().$el),this.loadFonts(),this.calculatePageSize(),this.createFlippingBookView(),this.resize(!0),this.flipbook.turn.initialLoading||(this.flipbook.turn.initialLoading=!0),this.setDocumentMaxZoom(),Backbone.Mediator.pub(WidgetEvent.ITEM_VIEW_INIT)},createFlippingBookView:function(){var e=this;this.flipbook.turn({display:"double",width:this.pageWidth,height:this.pageHeight,duration:PAGE_TURN_DURATION,acceleration:!1,gradients:!0,autoCenter:!this.singlePageView,cornerSize:this.isMobileDevice?0:100,elevation:50,page:this.model.get("currentPageIndex")+1,pages:this.totalItemPages,isDoublePageLayout:this.isDoublePageLayout,when:{start:function(t,i,o){e.handleTurnStart(t,i,o)},turning:function(t,i,o){e.handleTurning(t,i-1,o)},turned:function(t,i){e.handleTurned(t,i-1)},missing:function(t,i){e.handleMissing(t,i)},end:function(t,i,o){e.handleTurnEnd(t,i,o)},afterOverflowEnabled:function(t,i){e.handleAfterOverflowEnabled(i)},afterOverflowDisabled:function(t,i){e.handleAfterOverflowDisabled(i)}}}),this.initPdflinks()},setGradientVisibility:function(){this.model.get("showPageShadows")?this.$el.find(".page .gradient").show():this.$el.find(".page .gradient").hide()},pdfLinksLoaded:function(){this.removePdfLinks(),window.linksJs&&this.showPdfLinks(this.model.get("currentPageIndex"))},removePdfLinks:function(){$.each(this.pdfLinks,(function(e,t){$.each(t,(function(e,t){t.remove(),t=null}))})),this.pdfLinks={}},showPdfLinks:function(e){this.pdfLinks[e]?this.pdfLinksDelegateEvents(e):this.generatePdfLinks(e),this.isLeftPage(e)||0===e||(this.pdfLinks[e-1]?this.pdfLinksDelegateEvents(e-1):this.generatePdfLinks(e-1)),this.isLeftPage(e)&&e<this.totalItemPages-1&&(this.pdfLinks[e+1]?this.generatePdfLinks(e+1):this.pdfLinksDelegateEvents(e+1))},pdfLinksDelegateEvents:function(e){$.each(this.pdfLinks[e],(function(e,t){t.delegateEvents()})),this.resizePdfLinksContainer(e)},generatePdfLinks:function(e){var t,i,o,n,s,a,l,h=this;window.linksJs&&(this.singlePageView&&(!this.arabicStyle&&this.isLeftPage(e)||this.arabicStyle&&!this.isLeftPage(e))||(t=this.model.get("item").get("pages").at(e),n=(o=this.getPageContainer(e+1)).find("img.page-image"),l=this.model.get("mergePdfs"),t&&parseInt(t.get("type"),10)!==PageType.EMPTY_PAGE&&o.length&&n.length&&(i=l?this.singlePageView?this.arabicStyle?Math.floor(e/2):Math.ceil(e/2):e:parseInt(t.get("pdfidx"),10),window.linksJs[i]&&(l||t.get("type")!==PageType.MOVED_PAGE||window.linksJs[e])&&(this.pdfLinks[e]?this.pdfLinksDelegateEvents(e):window.linksJs[i]&&(o.find(".pdf-links").length||this.createPdfLinkContainer(o),s=this.getPdfLinksContainer(e),this.pdfLinks[e]=[],a=h.getPageScale(e),this.resizePdfLinksContainer(e),$.each(window.linksJs[i],(function(t,i){var o=_.extend(i,{scale:a,pageIndex:e,linkIndex:t}),n=new PdfLinkView({model:new Backbone.Model(o)});h.pdfLinks[e].push(n),s.append(n.render().$el)})))))))},resizePdfLinksContainer:function(e,t){var i=this.getPageContainer(e+1),o=i.find("img.page-image"),n={width:o.width()+"px",height:o.height()+"px",top:o.css("top"),left:o.css("left")};i.find(".pdf-links").css(n),t&&this.resizePdfLinks(e)},createPdfLinkContainer:function(e){var t=$('<div class="pdf-links" />');e.find(".link-container").append(t)},getPdfLinksContainer:function(e){return this.getPageContainer(e+1).find(".pdf-links")},resizePdfLinks:function(e){var t;this.pdfLinks&&this.pdfLinks[e]&&(t=this.getPageScale(e),$.each(this.pdfLinks[e],(function(e,i){i.resize(t)})))},initPdflinks:function(){var e=!1;this.model.get("mergePdfs")?$.each(FSWidgetModel.gi().get("collectionData").collection,(function(t,i){return"pdf"!==i.extension||(e=!0,!1)})):"pdf"===FSWidgetModel.gi().widgetState.get("currentItem").get("extension")&&(e=!0),e&&(new PdfLinks).get()},handleAfterOverflowEnabled:function(e){this.isDoublePageLayout&&e.page>1&&this.toggleLeftPageCustomContent(e,!0)},handleAfterOverflowDisabled:function(e){this.isDoublePageLayout&&e.page>1&&this.toggleLeftPageCustomContent(e,!1)},toggleLeftPageCustomContent:function(e,t){var i=e.page%2==0?e.page:e.page-1,o=[i];i-2>1&&o.push(i-2),i+2<this.flipTotalPages&&o.push(i+2);for(var n=0;n<o.length;n++)t?this.$el.find(".even .custom-content").show():this.$el.find(".even .custom-content").hide()},handleTurnStart:function(e,t,i){var o;if(1!==this.flipTotalPages)if(o=this.getPageBlockedCorners(t.page-1),this.setGradientVisibility(),this.resizePageContents(),o&&o.indexOf(i)>-1||this.currentZoom>0)e.preventDefault();else{if(this.singlePageView){if(this.arabicStyle&&2===t.page)return void e.preventDefault();if(!this.arabicStyle){if(t.page===this.totalItemPages-1)return void e.preventDefault();t.next%2==0&&this.$(".page.p"+t.next).addClass("turning")}}if(this.isDoublePageLayout&&t.page>1){var n=t.page%2==0?t.page:t.page-1,s=this.getPageContainer(n).find(".custom-content");s&&s.length&&s.show()}Backbone.Mediator.pub(WidgetEvent.PAGE_TURN_START,{previousPageIndex:t.page-1,nextPageIndex:t.next-1})}else e.preventDefault()},handleTurnEnd:function(e,t,i){i?t.next%2==0&&this.$(".page.p"+t.next).removeClass("turning"):Backbone.Mediator.pub(WidgetEvent.PAGE_TURN_CANCELED,t)},handleTurning:function(e,t,i){if(1!==this.flipTotalPages)if(this.getIfNextNavIsBlocked(this.arabicStyle,this.flipbook.turn("page"),i[0]))e.preventDefault();else{if(this.singlePageView){if(!this.arabicStyle&&t===this.totalItemPages-1)return void e.preventDefault();if(this.arabicStyle&&0===t)return void e.preventDefault()}clearTimeout(this.renderCustomContentTimeout),this.renderCustomContentTimeout=setTimeout($.proxy(this,"renderCustomContent",t),100),this.closeForm(),this.playFlipSound()}else e.preventDefault()},handleTurned:function(e,t){var i,o,n,s;this.closeForm(),this.trigger(WidgetEvent.PAGE_TURN_END,{currentPageIndex:t}),this.trigger(WidgetEvent.PAGE_CHANGED,t),this.stopCustomContent(),this.startCustomContent(t),this.showPdfLinks(t),this.checkFormAndShowIt(t),FSWidgetModel.gi().get("isForSelling")&&FSWidgetModel.gi().get("sellSettingsPage")&&(s=this,i=this.arabicStyle?FSWidgetModel.gi().get("sell").previewPages.map((function(e){return s.flipTotalPages-e+1})):FSWidgetModel.gi().get("sell").previewPages,o=this.getRange(),(n=_.range(o[0],o[1]+1,1)).forEach((function(e){var o=e-1,a=s.getPageContainer(e),l=s.model.get("item").get("pages").at(t),h=a.find("img.page-image").attr("src"),d=!!h&&h.indexOf("/thumb?")>0,r=l.get("isBlockedForSellingPreview");0!==a.length&&r!==d&&(i.indexOf(e)>-1&&a.hasClass("locked")&&!r?n.indexOf(e)&&(a.find(".image-container .page-image").off(),a.find(".image-container").empty(),a.find(".fsw-wheelpreloader").empty().remove(),s.loadPage(o,a)):-1===i.indexOf(e)&&!a.hasClass("locked")&&r&&(a.find(".image-container .page-image").off(),a.find(".image-container").empty(),a.find(".fsw-wheelpreloader").empty().remove(),s.stopCustomContentOnPage(o),s.customContent[o]&&(s.customContent[o].remove(),s.customContent[o].empty(),s.customContent[o]=null,delete s.customContent[o]),a.find(".custom-content-container").empty(),s.loadPage(o,a)))})))},checkFormAndShowIt:function(e){0!==e&&e!==this.totalItemPages-1||this.arabicStyle?this.arabicStyle?(e=this.isLeftPage(e)?e+1:e,formData=this.getPageForm(e),formData?this.showForm(e,formData.form):(formData=this.getPageForm(e-1),formData&&this.showForm(e-1,formData.form))):(e=this.isLeftPage(e)?e:e-1,formData=this.getPageForm(e),formData?this.showForm(e,formData.form):(formData=this.getPageForm(e+1),formData&&this.showForm(e+1,formData.form))):(formData=this.getPageForm(e),formData&&this.showForm(e,formData.form))},handleMissing:function(e,t){var i;for(i=0;i<t.length;i++)this.addPage(t[i]-1,this.flipbook)},hasAccessToForm:function(){return FSUtils.hasAccessToElement({action:LinkAction.FORM},FSWidgetModel.gi().get("collectionData").features)},pageHasForm:function(e){return!!this.hasAccessToForm()&&(!FSWidgetModel.gi().get("isDownload")&&null!=this.getPageForm(e))},pageHasBlockingForm:function(e){var t=this.getPageForm(e);return null!=t&&t.form&&t.form.limit===LeadFormBlocking.ALL},getPageForm:function(e){if(this.hasAccessToForm()){var t=FSWidgetModel.gi().widgetState.get("currentItem")&&FSWidgetModel.gi().widgetState.get("currentItem").get("forms"),i=this.getSinglePageIndex(e);if(!(i<-1||FSWidgetModel.gi().widgetSettings.get("exportVideo")))return _.find(t,(function(e){return e.index===i}))}},getPageContainer:function(e){return this.flipbook.find(".p"+e+" .page-content")},getSinglePageIndex:function(e){var t=e,i=e%2==0;if(this.singlePageView)if(this.arabicStyle){if(i)return-1;t=(e-1)/2}else{if(!i)return-1;t=e/2}return t},showForm:function(e,t){var i;FSWidgetModel.gi().get("isDownload")||(i=this.getPageContainer(e+1),LeadFormView.gi({model:new LeadFormModel({eID:t.eID,pid:this.model.get("item").get("pages").at(e).get("pID"),limit:t.limit,header:t.header,placeholder:t.placeholder,bookIndex:this.model.get("item").get("itemIndex"),pageIndex:this.model.get("item").get("pages").at(e).get("pageIndex"),realPageNumber:this.model.get("item").get("pages").at(e).get("pageIndexInBook"),bookTitle:FSWidgetModel.gi().get("collectionData").title,elements:t.elements,pageSize:[this.pageWidth,this.pageHeight],pageContainer:i,widgetContainer:$(ComponentContainers.MAIN_LAYOUT),labels:{buttonLabel:t.label,requiredFieldLabel:"required fields",fieldRequiredLabel:"This field is required.",validEmailLabel:"Please enter a valid email address."},formVersion:t.formVersion})}))},closeForm:function(e){var t,i,o,n,s,a,l;LeadFormView.close(),e&&"number"==typeof e.pageIndex&&(t=e.pageIndex+1,i=e.pageIndex,this.singlePageView&&(this.arabicStyle?i=2*i+1:i*=2,t=i+1),o=this.getPageContainer(t),this.loadPage(i,o),this.arabicStyle?(n=i-1,!this.isLeftPage(i)&&n>-1&&(this.pageHasForm(n)?this.showForm(n,this.getPageForm(n).form):e.limit===LeadFormBlocking.ALL&&(a=this.getPageContainer(i),this.loadPage(n,a)))):(s=i+1,this.isLeftPage(i)&&s<this.totalItemPages&&(this.pageHasForm(s)?this.showForm(s,this.getPageForm(s).form):e.limit===LeadFormBlocking.ALL&&(l=this.getPageContainer(t+1),this.loadPage(s,l)))),this.startCustomContent(i))},getPageBlockedCorners:function(e){var t=["tl","bl","l"],i=["tr","br","r"];return this.pageHasBlockingForm(e)?this.arabicStyle?t:i:this.arabicStyle?this.getCornersIfBlocked(e,t):this.getCornersIfBlocked(e,i)},getCornersIfBlocked:function(e,t){var i=null;return(this.isLeftPage(e)&&this.pageHasBlockingForm(e+1)||!this.isLeftPage(e)&&this.pageHasBlockingForm(e-1))&&(i=t),i},getIfNextNavIsBlocked:function(e,t,i){var o=i-t,n=!1;return(e&&o<0||!e&&o>0)&&(n=this.isPageTurnBlocked(t-1)),n},isPageTurnBlocked:function(e){var t=this.isLeftPage(e)?e:e-1,i=t+1;return this.pageHasBlockingForm(t)||this.pageHasBlockingForm(i)},destroyFlippingBookView:function(){this.$el.find(".page-content img.page-image").each((function(){$(this).off().remove()})),this.flipbook.turn("destroy"),$(".fsw-embedmsg-container").remove(),this.destroyCustomContent()},destroyCustomContent:function(){var e;if(this.customContent){for(e in this.customContent)this.customContent.hasOwnProperty(e)&&(this.customContent[e].remove(),delete this.customContent[e]);this.customContent={}}},addPage:function(e,t){var i=$("<div />",{}),o=this.model.get("item"),n=e;o.get("hardCover")&&this.setHardCover(n,i,o),t.turn("addPage",i,n+1)&&(n%2==0?i.html(FlipTemplates.rightPageContainer):i.html(FlipTemplates.leftPageContainer),this.model.get("showPageShadows")||i.find(".gradient").hide(),this.canLoadContent(n)&&this.loadPage(n,i.find(".page-content")))},setHardCover:function(e,t,i){[0,1,i.get("noOfPages")-2,i.get("noOfPages")-1].indexOf(e)>-1&&(t.addClass("hard"),0===e||e===i.get("noOfPages")-1?t.addClass("outer"):t.addClass("inner"))},canLoadContent:function(e){var t=this.arabicStyle&&this.isLeftPage(e)&&e+1<this.totalItemPages-1&&this.pageHasBlockingForm(e+1),i=!this.arabicStyle&&!this.isLeftPage(e)&&e-1>0&&this.pageHasBlockingForm(e-1),o=this.pageHasForm(e);return!t&&!i&&!o},loadPage:function(e,t){var i=this.model.get("item").get("pages").at(e);i.get("isBlockedForSellingPreview")?(t.addClass("locked"),this.loadThumbPage(e,t,!0)):(t.removeClass("locked"),this.setBackgroundColor(i.get("bgColor"),t),this.loadImageContent(e,t,!0),i.get("type")===PageType.CUSTOM_PAGE&&this.loadCustomContent(e,t))},loadImageContent:function(e,t,i){if(this.model.get("item").get("pages").at(e).get(ImageTypes.ORIGINAL))switch(this.isInFullScreen=FSUtils.isInFullScreen(),this.isInFullScreen||this.currentZoom>0?ImageTypes.ORIGINAL:FSUtils.getImageSizeType(this.pageWidth,this.pageHeight)){case ImageTypes.THUMB:case ImageTypes.SMALL:this.loadSmallPage(e,t,i);break;case ImageTypes.MEDIUM:this.loadMediumPage(e,t,i);break;default:this.loadOriginalPage(e,t,i)}},loadCustomContent:function(e,t){this.hasCustomContent(e)&&this.addCustomContent(e,t.find(".custom-content-container"))},hasCustomContent:function(e){var t;return e>=this.totalItemPages?null:(t=(t=this.model.get("item").get("pages").at(e).get("customElements")||[]).filter((function(e){return e&&"number"==typeof e.type&&"number"==typeof e.action&&e.type!==ElementType.FORM})))&&t.length>0},loadThumbPage:function(e,t,i){this.loadImage(e,t,ImageTypes.THUMB,i)},loadSmallPage:function(e,t,i){this.loadImage(e,t,ImageTypes.SMALL,i)},loadMediumPage:function(e,t,i){this.loadImage(e,t,ImageTypes.MEDIUM,i)},loadOriginalPage:function(e,t,i){this.loadImage(e,t,ImageTypes.ORIGINAL,i)},loadImage:function(e,t,i,o){var n,s,a,l=t.find(".image-container"),h=l.find("img"),d=this,r=!1,g=this.model.get("item").get("pages").at(e);h.attr("data-type")!==i&&(n=$('<img class="page-image" data-type="'+i+'" />').mousedown((function(e){e.preventDefault()})).one("load",(function(){var i=l.find("img");if(image=$(this),i.length){l.find("img").off().remove(),image.attr({"data-width":this.width,"data-height":this.height,"data-page":e+1});var o=d.currentZoom+1;d.scaleImage(d.pageWidth*o,d.pageHeight*o,this),image.appendTo(l),t.find(".fsw-wheelpreloader").empty().remove(),g.get("isBlockedForSellingPreview")||(d.loadCustomContent(e,t),e===d.model.get("currentPageIndex")&&d.startCustomContent(e),d.showPdfLinks(e))}image.off(),n.off(),n=null,i=null,h=null})).one("error",(function(){(r=0===e&&d.model.get("retryFirstImage")&&d.firstImageRetries>0)&&d.firstImageRetries--,($(this).attr("data-type")!==ImageTypes.ORIGINAL||r)&&setTimeout((function(){d.loadOriginalPage(e,t,ImageTypes.ORIGINAL,!0)}),r?2e3:0),t.find(".fsw-wheelpreloader").empty().remove(),n.off(),n=null,l=null,h=null})),o&&(a=new WheelPreloader(40),t.append($("<div/>").addClass("fsw-wheelpreloader").append(a.render().$el))),s=this.model.get("item").get("pages").at(e).get(i),n.appendTo(l),n.attr("src",s))},appendImage:function(e,t,i){e.find(".fsw-wheelpreloader").empty().remove(),t.appendTo(i),t=null,i=null},scaleImage:function(e,t,i){var o=$(i),n=o.attr("data-width"),s=o.attr("data-height"),a=FSUtils.calculatePageSize(e,t,n,s,Math.ceil);o.width()===a.width&&o.height()===a.height||$(i).css({position:"absolute",width:a.width+"px",height:a.height+"px",left:Math.ceil((e-a.width)/2)+"px",top:Math.ceil((t-a.height)/2)+"px"})},getImageSize:function(e){var t=this.getPageContainer(e+1).find("img.page-image");return t.length?{w:t.width(),h:t.height()}:{w:this.pageWidth,h:this.pageHeight}},countImageElements:function(e){var t,i=0;for(t=0;t<e.length;t++)e[t].type===ElementType.IMAGE&&i++;return i},getPageCustomContentModel:function(e,t){var i=this.model.get("item").get("pages").at(e),o=i.get("customElements"),n=this.countImageElements(o);return{pageModel:i,elements:o,page:e,scale:this.getScale(e),oldEditorScaling:FSUtils.getOldEditorScaling(i.get("height"),i.get("width"),EDITOR_DEFAULTS),firstPageWidth:this.firstPageWidth,firstPageHeight:this.firstPageHeight,pageWidth:this.pageWidth,pageHeight:this.pageHeight,status:ContentLoaderStatus.IDLE,imageElements:n,widgetZoom:t||1}},addCustomContent:function(e,t){var i=new WheelPreloader(40),o=this.getPageCustomContentModel(e,this.currentZoom+1);this.isDoublePageLayout&&e>0&&(this.flipTotalPages%2!=0||e!==this.flipTotalPages-1)&&(e%2!=0?this.model.get("item").get("pages").at(e+1)&&(o.rightPageModel=this.getPageCustomContentModel(e+1,this.currentZoom+1)):this.model.get("item").get("pages").at(e-1)&&(o.leftPageModel=this.getPageCustomContentModel(e-1,this.currentZoom+1)));this.customContent[e]?this.customContent[e].model.set(o):(this.customContent[e]=new CustomContentView({model:new Backbone.Model(o)}),this.customContent[e].render(),0===o.imageElements?t.append(this.customContent[e].$el):(t.append($("<div/>").addClass("fsw-wheelpreloader").append(i.render().$el)),this.listenTo(this.customContent[e].model,"change:status",(function(){t.append(this.customContent[e].$el),t.find(".fsw-wheelpreloader").empty().remove()})))),this.model.get("currentPageIndex")===e-1&&this.startCustomContent(e-1)},renderCustomContent:function(e){this.renderContent(e,this.getPageContainer(e+1)),this.isLeftPage(e)||0===e||this.renderContent(e-1,this.getPageContainer(e)),this.isLeftPage(e)&&e<this.totalItemPages-1&&this.renderContent(e+1,this.getPageContainer(e+2))},renderContent:function(e,t){!this.pageHasForm(e)&&this.customContent[e]&&t&&this.customContent[e].start("turning")},handleShelfOpened:function(){this.stopCurrentCustomContent(),LeadFormView.close()},handleShelfClosed:function(){var e=FSWidgetModel.gi().widgetState.get("currentPageIndex");LeadFormView.close(),this.startCustomContent(e),this.checkFormAndShowIt(e)},startCustomContent:function(e){this.startContent(e,this.getPageContainer(e+1)),this.isLeftPage(e)||0===e||this.startContent(e-1,this.getPageContainer(e)),this.isLeftPage(e)&&e<this.totalItemPages-1&&this.startContent(e+1,this.getPageContainer(e+2))},startContent:function(e,t){!this.pageHasForm(e)&&this.customContent[e]&&t&&this.customContent[e].start("end")},startCurrentCustomContent:function(){this.startCustomContent(this.model.get("currentPageIndex"))},stopCurrentCustomContent:function(){this.stopCustomContentOnPage(this.model.get("currentPageIndex"))},stopCustomContent:function(){for(var e,t=0,i=this.pagesToStopCustomContentOn.length;t<i;t+=1)e=this.pagesToStopCustomContentOn[t],this.model.get("currentPageIndex")!==e&&this.stopCustomContentOnPage(e)},stopCustomContentOnPage:function(e){var t;this.customContent[e]&&this.customContent[e].stop(),t=-1,this.isLeftPage(e)?e+1<=this.totalItemPages-1&&this.customContent[e+1]&&(t=e+1):e-1>0&&this.customContent[e-1]&&(t=e-1),t>-1&&this.model.get("currentPageIndex")!==t&&this.customContent[t].stop()},loadFonts:function(){var e,t,i;for(t=0;t<this.totalItemPages;t++)if(e=this.model.get("item").get("pages").at(t).get("customElements"))for(i=0;i<e.length;i++){if(e[i].fontFamily&&e[i].fontFamily.length>0&&FontManager.gi().addFont(e[i].fontFamily),e[i].nodes&&e[i].nodes.length>0)for(var o=0;o<e[i].nodes.length;o++)e[i].nodes[o]&&e[i].nodes[o].style&&e[i].nodes[o].style.font&&e[i].nodes[o].style.font.family&&FontManager.gi().addFont(e[i].nodes[o].style.font.family,e[i].nodes[o].style.font.source,e[i].nodes[o].style.font.isSuperUser);!e[i].nodes&&e[i].font&&e[i].font.family&&FontManager.gi().addFont(e[i].font.family,e[i].font.source,e[i].font.isSuperUser),e[i].type!==ElementType.PAYPAL&&e[i].type!==ElementType.PAYPAL_TOOLTIP||FontManager.gi().addFont("Open Sans")}FontManager.gi().loadFonts()},calculatePageSize:function(){this.oldCalculatePageSize()},positionFlip:function(){this.oldPositionFlip()},resizePageContents:function(){this.oldResizePageContents()},getScale:function(e){var t,i=parseInt(e,10),o=this.model.get("item").get("pages").at(i),n=this.pageWidth,s=this.pageHeight,a=n*(this.currentZoom+1),l=s*(this.currentZoom+1);return o?(t=FSUtils.calculateScaledSize(o.get("width"),o.get("height"),EDITOR_DEFAULTS.width,EDITOR_DEFAULTS.height),1/FSUtils.calculateScale(t.width,t.height,a,l,!0)):1},getPageScale:function(e){return this.oldGetPageScale(e)},pageChanged:function(){this.pagesToStopCustomContentOn.push(this.model.get("lastPageIndex")),this.flipbook.turn("page",this.model.get("currentPageIndex")+1)},isLeftPage:function(e){return e%2!=0},isWidgetZoomed:function(){return 1!==FSUtils.getZoomLevel()},getTargetPage:function(e){var t=e.parent();return t.hasClass("page")?t.hasClass("right")?DocumentView.PAGE_RIGHT:DocumentView.PAGE_LEFT:0},remove:function(){LeadFormView.hasInstance()&&(LeadFormView.gi().remove(),LeadFormView.gi().model.destroy(),LeadFormView._instance=null),this.destroySound(),this.removePdfLinks(),this.flipbook.turn&&this.flipbook.turn("pages")>0&&this.destroyFlippingBookView(),Backbone.Mediator.unsubscribe(WidgetEvent.LEAD_FORM_SENT,this.closeForm,this),Backbone.Mediator.unsubscribe(WidgetEvent.PDF_LINKS_LOADED,this.pdfLinksLoaded,this),Backbone.Mediator.unsubscribe(WidgetEvent.MUTE,this.muteFlipSound,this),Backbone.Mediator.unsubscribe(WidgetEvent.UN_MUTE,this.unmuteFlipSound,this),Backbone.Mediator.unsubscribe(ShelfEvents.SHELF_OPENED,this.handleShelfOpened,this),Backbone.Mediator.unsubscribe(ShelfEvents.SHELF_CLOSED,this.startCurrentCustomContent,this),Backbone.Mediator.unsubscribe(WidgetEvent.ZOOM_CHANGED,this.oldDesktopHandleZoomChanged,this),Backbone.Mediator.unsubscribe(WidgetEvent.ZOOM_END,this.oldDesktopHandleZoomEnd,this),Backbone.Mediator.unsubscribe(NewShelfEvents.CLOSE_ITEM,this.destroyFlippingBookView,this),$(document.body).off(),this.flipbook.off(),Backbone.View.prototype.remove.apply(this,arguments)},mouseOverPage:function(e){Backbone.Mediator.pub(WidgetEvent.MOUSE_OVER_PAGE,e.currentTarget.attributes.page.value)},mouseOutPage:function(e){Backbone.Mediator.pub(WidgetEvent.MOUSE_OUT_PAGE,e.currentTarget.attributes.page.value)},mouseEnterView:function(e){"docView"!==(e?$(e.target).attr("id"):void 0)&&this.model.get("displayType")!==DisplayType.SMALL&&(e&&$(e.target).hasClass("nav-button")||e&&this.mouseMoveDocView(e))},mouseMoveDocView:function(e){this.oldMouseMoveDocView(e)},mouseDownDocView:function(e){FSUtils.isMobileDevice()||"IMG"!==e.target.tagName&&"image"!==e.target.tagName||e.preventDefault(),this.flipbook.addClass("mousedown"),this.startTranslatePos=FSUtils.getElementCSSTransform(this.viewLimiter[0]),this.startMouseX=e.pageX,this.startMouseY=e.pageY},mouseUpDocView:function(){this.flipbook.hasClass("mousedown")&&this.currentZoom>0&&(this.deltaX||this.deltaY)&&(this.deltaX=this.deltaX||0,this.deltaY=this.deltaY||0,this.deltaX=Math.max(this.xmin,Math.min(this.xmax,this.deltaX)),this.deltaY=Math.max(this.ymin,Math.min(this.ymax,this.deltaY)),this.viewLimiter.css({transition:"transform 0.2s",transform:"translate3d("+this.deltaX+"px, "+this.deltaY+"px, 0) scale(1)"})),this.flipbook.removeClass("mousedown")},enterZoom:function(e){var t=this.isMobileDevice?e.originalEvent.changedTouches[0].clientX:e.pageX,i=this.isMobileDevice?e.originalEvent.changedTouches[0].clientY:e.pageY;this.model.get("displayType")===DisplayType.SMALL||$(e.target).hasClass("nav-button")||(0===this.currentZoom?(this.xZoom=t-this.documentViewObj.viewLimiter.left,this.yZoom=i-this.documentViewObj.viewLimiter.top,Backbone.Mediator.pub(WidgetEvent.CHANGE_ZOOM,{value:FSWidgetModel.gi().get("maxZoomValue")})):(this.deltaX=this.deltaY=this.xmin=this.ymin=this.xmax=this.ymax=void 0,Backbone.Mediator.pub(WidgetEvent.CHANGE_ZOOM,{value:0})))},handleMouseWheel:function(e){var t,i,o;this.currentZoom>0&&(o=e.deltaY>0?1:-1,t=FSWidgetModel.gi().get("maxZoomValue"),i=this.currentZoom+o*t*DEFAULT_ZOOM_STEP/100,i=Math.max(0,Math.min(t,i)),this.xZoom=this.yZoom=void 0,Backbone.Mediator.pub(WidgetEvent.CHANGE_ZOOM,{value:i}))},mouseOutBody:function(){this.getPageContainer(this.model.get("currentPageIndex")+1).mouseup()},mouseUpBody:function(){this.flipbook.hasClass("mousedown")&&this.mouseUpDocView()},disableRightClick:function(){location.host.indexOf("site.flipsnack.net")>-1||location.host.indexOf("flipsnack.io")>-1||"widget"===location.host||"widgetjs"===location.host||document.addEventListener("contextmenu",(function(e){e.preventDefault()}))},calculateTranslation:function(){var e,t,i,o,n,s,a,l,h=this.singlePageView||0===this.model.get("currentPageIndex")||this.model.get("currentPageIndex")===this.totalItemPages-1;return t=FSUtils.getElementCSSTransform(this.viewLimiter[0]),i=0===this.currentZoom?0:t.x,o=0===this.currentZoom?0:t.y,e=h?4:2,e=this.singlePageView?2:e,n=-(s=this.documentViewObj.viewLimiter.width/e*this.currentZoom),a=-(l=this.documentViewObj.flipbook.height/2*this.currentZoom),this.xZoom&&this.yZoom&&(i=this.xZoom<=$(window).width()/2?(this.documentViewObj.viewLimiter.width/2-this.xZoom)*this.currentZoom:(this.documentViewObj.viewLimiter.width/2-(this.documentViewObj.viewLimiter.width-this.xZoom))*-this.currentZoom,o=this.yZoom<=$(window).height()/2?(65+this.documentViewObj.flipbook.height/2-this.yZoom)*this.currentZoom:(this.documentViewObj.flipbook.height/2-(65+this.documentViewObj.flipbook.height-this.yZoom))*-this.currentZoom,this.xZoom=this.yZoom=void 0),{tx:i=Math.max(Math.min(i,s),n),ty:o=Math.max(Math.min(o,l),a)}},oldDesktopHandleZoomChanged:function(e){var t,i,o;this.currentZoom=e.value,i=0===(t=this.calculateTranslation()).tx?0:t.tx+"px",o=0===t.ty?0:t.ty+"px",this.resize(!0),this.viewLimiter.css({transition:"none",transform:"perspective(1px) translate3d("+i+", "+o+", 0) scale(1)"})},oldDesktopHandleZoomEnd:function(){var e,t,i;"string"==typeof FSWidgetModel.gi().get("collectionData").trackingId&&FSWidgetModel.gi().get("collectionData").trackingId.length&&!FlipSnackEmbed.isEditor&&Tracker.gtag(FSWidgetModel.gi().get("collectionData").title,"Zoom"),0===this.currentZoom&&(this.flipbookBoundsRect=this.flipbook[0].getBoundingClientRect(),this.viewLimiterBoundsRect=this.viewLimiter[0].getBoundingClientRect()),this.currentZoom>0&&(this.deltaX=0,this.deltaY=0),t=0===(e=this.calculateTranslation()).tx?0:e.tx+"px",i=0===e.ty?0:e.ty+"px",this.resize(!1),this.viewLimiter.css({transition:"none",transform:"perspective(1px) translate3d("+t+", "+i+", 0) scale(1)"}),this.currentZoom>0?this.flipbook.addClass("zoomed"):this.flipbook.removeClass("zoomed")},oldResize:function(){this.model.get("displayType")===DisplayType.SMALL?this.model.get("collectionSize")[0]<FlipView.SMALL_MAX_WIDTH||this.model.get("collectionSize")[1]<FlipView.SMALL_MAX_HEIGHT?this.$el.removeClass("large").addClass("small"):this.$el.removeClass("small").addClass("large"):this.$el.removeClass("small large"),"boolean"==typeof pageSizes&&pageSizes||(this.calculatePageSize(),LeadFormView.hasInstance()&&LeadFormView.gi().model.set("pageSize",[this.pageWidth,this.pageHeight]),this.setCustomContentPageSize()),this.positionFlip()},oldCalculatePageSize:function(){var e,t=this.model.get("item").get("pages"),i=this.arabicStyle?t.at(this.totalItemPages-1):t.at(0),o=this.singlePageView?this.model.get("maxSize")[0]:Math.floor(this.model.get("maxSize")[0]/2),n=this.model.get("maxSize")[1];this.firstPageWidth=i.get("width"),this.firstPageHeight=i.get("height"),this.pageWidth=Math.min(o,this.firstPageWidth),this.pageHeight=Math.min(n,this.firstPageHeight),this.pageWidth/this.pageHeight!==this.firstPageWidth/this.firstPageHeight&&(e=Math.max(this.firstPageWidth/o,this.firstPageHeight/n),this.pageWidth=Math.ceil(this.firstPageWidth/e),this.pageHeight=Math.ceil(this.firstPageHeight/e))},oldPositionFlip:function(){var e,t=this,i=this.currentZoom+1,o=2*this.pageWidth*i,n=this.pageHeight*i,s=this.model.get("maxSize")[0],a=this.model.get("maxSize")[1],l=this.model.get("offset"),h=Math.round((s-o)/2)+l.left,d=Math.round((a-n)/2)+l.top,r=this.model.get("navButtonWidth"),g=this.singlePageView?this.pageWidth*i:o,c=n+l.top,u=FSWidgetModel.gi().get("height");FSUtils.isPlayerSkin()&&FSWidgetModel.gi().get("collectionData").watermark&&(d-=WidgetWatermarkBar.WATERMARK_BAR_HEIGHT/2),this.flipbook.css({left:this.arabicStyle?0:g-o+"px",top:this.currentZoom>0?0:d+"px",width:o+"px",height:n+"px"}),e=Math.ceil((s+2*r-g)/2)+l.left,this.viewLimiter.css({left:e+"px",top:0===this.currentZoom?0:d+"px",width:g+"px",height:Math.max(c,u)+"px"}),this.documentViewObj.viewLimiter={left:e,top:0===this.currentZoom?0:d,width:g,height:Math.max(c,u)},this.documentViewObj.flipbook={left:this.arabicStyle?0:g-o,top:this.currentZoom>0?0:d,width:o,height:n},this.docContainer.css({left:-l.left+"px",top:-l.top+"px",width:$(window).width()+"px",height:$(window).height()+"px"}),this.flipbook.turn("size",o,n),this.flipbook.turn("resize"),this.resizePageContents(),this.trigger(FlipEvents.FLIP_POSITIONED,{top:d,left:h,width:g,height:n}),0===this.currentZoom&&setTimeout((function(){t.flipbookBoundsRect=t.flipbook[0].getBoundingClientRect(),t.viewLimiterBoundsRect=t.viewLimiter[0].getBoundingClientRect()}),10)},oldResizePageContents:function(){var e=this,t=this.flipbook.find("img.page-image").toArray(),i=this.currentZoom+1;_.each(t,(function(t){var o=$(t),n=parseInt(o.data("page")-1,10),s=o.parents(".page-content"),a=e.model.get("item").get("pages").at(n);e.scaleImage(e.pageWidth*i,e.pageHeight*i,t),a&&!a.get("isBlockedForSellingPreview")&&e.loadImageContent(n,s,!1),e.resizePdfLinksContainer(n,!0)})),_.each(this.customContent,(function(t,o){var n=parseInt(o,10);e.isDoublePageLayout&&n>0&&(e.flipTotalPages%2!=0||n!==e.flipTotalPages-1)&&(n%2!=0?e.model.get("item").get("pages").at(n+1)&&t.model.set("rightPageModel",e.getPageCustomContentModel(n+1,i)):e.model.get("item").get("pages").at(n-1)&&t.model.set("leftPageModel",e.getPageCustomContentModel(n-1,i)));t.resize(e.getScale(n))}))},oldMouseMoveDocView:function(e){var t,i,o,n;$(e.target).attr("id");if(this.currentZoom>0&&this.flipbook.hasClass("mousedown"))return t=parseInt(this.viewLimiter.css("left"),10)+parseInt(this.viewLimiter.css("margin-left"),10),i=parseInt(this.viewLimiter.css("top"),10)+parseInt(this.viewLimiter.css("margin-top"),10),o=Math.round(this.viewLimiter.width())+t,n=Math.round(this.viewLimiter.height())+i,this.deltaX=e.pageX-this.startMouseX+this.startTranslatePos.x,this.xmax=this.viewLimiterBoundsRect.left-t,this.xmin=this.viewLimiterBoundsRect.right-o,this.deltaY=e.pageY-this.startMouseY+this.startTranslatePos.y,this.ymax=this.flipbookBoundsRect.top-i,this.ymin=this.flipbookBoundsRect.bottom+this.flipbookBoundsRect.top-n,void this.viewLimiter.css({transition:"none",transform:"translate3d("+this.deltaX+"px, "+this.deltaY+"px, 0px) scale(1)"});e.mousePositionY=e.clientY+this.$el.position().top},oldSetCustomContentPageSize:function(){var e;if(this.customContent)for(e in this.customContent)this.customContent.hasOwnProperty(e)&&this.customContent[e].model.set({pageWidth:this.pageWidth*(this.currentZoom+1),pageHeight:this.pageHeight*(this.currentZoom+1)})},oldGetPageScale:function(e){var t,i=this.model.get("item").get("pages").at(parseInt(e,10));return i?(t=FSUtils.calculatePageSize(this.pageWidth*(this.currentZoom+1),this.pageHeight*(this.currentZoom+1),i.get("width"),i.get("height"),Math.ceil),i.get("height")>i.get("width")?t.height/i.get("height"):t.width/i.get("width")):1},updatePreviewPages:function(e){var t,i,o=this,n=this.arabicStyle?e.map((function(e){return o.flipTotalPages-e+1})):e,s=this.getRange(),a=_.range(s[0],s[1]+1,1),l=_.intersection(a,n);l.length&&l.forEach((function(e){t=o.getPageContainer(e),i=e-1,t.find(".image-container img.page-image").off(),t.find(".image-container").empty(),t.find(".fsw-wheelpreloader").empty().remove(),o.stopCustomContentOnPage(i),o.customContent[i]&&(o.customContent[i].remove(),o.customContent[i].empty(),o.customContent[i]=null,delete o.customContent[i]),t.find(".custom-content-container").empty(),o.loadPage(i,t)}))},getRange:function(){var e=this.flipbook.find(".page-wrapper"),t=[];return e.length>0?(_.each(e,(function(e){var i=isNaN(e.getAttribute("page"))?-1:parseInt(e.getAttribute("page"),10);i>=0&&t.push(i)})),t.length>0?(t.sort((function(e,t){return e-t})),[t[0],t[t.length-1]]):[]):[]},setBackgroundColor:function(e,t){""!==e&&t.css({backgroundColor:e})}});DocumentView.DOUBLE_TAP_RADIUS=30,DocumentView.DOUBLE_TAP_TIMEOUT=300,DocumentView.MAX_ZOOM_VALUE=5,function(e){var t=this;function i(){FlipView.gi()}e.FlipView=Backbone.View.extend({el:ComponentContainers.FLIP_VIEW,initialize:function(){this.isPlayerSkin=FSWidgetModel.gi().widgetSettings.get("skinType")===WidgetSkinType.PLAYER,this.isSinglePageView=FSWidgetModel.gi().widgetSettings.get("singlePageView"),this.isArabicStyle=FSWidgetModel.gi().widgetSettings.get("arabicStyle"),this.totalItems=FSWidgetModel.gi().flipCollection.get("noOfItems"),this.itemNavigationVisible=FSWidgetModel.gi().widgetState.get("displayType")===DisplayType.SMALL&&this.totalItems>1,this.docViewHeight=0,this.docPageIndex=this.calculatePageIndexForLocal(FSWidgetModel.gi().widgetState.get("currentPageIndex")),this.touchStartPosX=0,this.deltaX=0,this.currentTouchPosX=0,this.isMobileDevice=FSUtils.isMobileDevice(),this.isIOS=FSUtils.isIOS(),this.flipTotalPages=FSWidgetModel.gi().flipCollection.totalPages,this.isInFullScreen=FSUtils.isInFullScreen(),this.timeout=null,this.firstTouchPos=null,this.lastTap=0,this.startZoom=1,this.flipViewContainer=this.$el.parent().find(ComponentContainers.FLIP_VIEW),this.processCurrentItem(),this.createPageNavigation(),this.createItemNavigation(),this.createDocumentView(),this.createGenericElementsContainer(),this.itemNavigationVisible?this.itemNavigation.show():this.itemNavigation.hide(),Backbone.Mediator.sub(WidgetEvent.RESIZE,this.resize,this),Backbone.Mediator.sub(WidgetEvent.RENDER_LAYOUT,this.resize,this),Backbone.Mediator.sub(WidgetEvent.PAGE_TURN_START,this.pageTurnStart,this),Backbone.Mediator.sub(WidgetEvent.PAGE_TURN_CANCELED,this.pageTurnCanceled,this),Backbone.Mediator.sub(WidgetEvent.FULLSCREEN_CHANGED,this.handleFullScreenChanged,this),this.listenTo(FSWidgetModel.gi().widgetState,"change:displayType",this.displayTypeChange),this.listenTo(FSWidgetModel.gi().widgetState,"change:currentItem",this.itemChanged),this.listenTo(FSWidgetModel.gi().widgetState,"change:currentPageIndex",this.pageChanged),this.listenTo(FSWidgetModel.gi().widgetState,"change:isBuyCurtainDisplayed",this.handleBuyCurtain),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:singlePageView",this.widgetSettingsChanged),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:enableSounds",this.widgetSettingsChanged),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:arabicStyle",this.widgetSettingsChanged),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:mergePdfs",this.widgetSettingsChanged),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:showPageShadows",this.widgetSettingsChanged),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:showControls",this.resize),this.isMobileDevice&&(this.$el.on("touchstart",$.proxy(this,"handleTouchStart")),this.$el.on("touchend touchcancel",$.proxy(this,"handleTouchEnd"))),this.resize()},createPageNavigation:function(){this.pageNavigation1=new PageNavigationView({model:new Backbone.Model({totalPages:this.totalItemPages,currentPage:this.docPageIndex,displayType:FSWidgetModel.gi().widgetState.get("displayType"),collectionSize:[FSWidgetModel.gi().get("width"),FSWidgetModel.gi().get("height")],fullHeight:!this.itemNavigationVisible,maxHeight:this.$el.height()})}),this.pageNavigation2=new PageNavigationView({model:new Backbone.Model({totalPages:this.totalItemPages,currentPage:this.docPageIndex,displayType:FSWidgetModel.gi().widgetState.get("displayType"),collectionSize:[FSWidgetModel.gi().get("width"),FSWidgetModel.gi().get("height")],fullHeight:!this.itemNavigationVisible,maxHeight:this.$el.height()})}),this.flipTotalPages>1&&this.$el.append(this.pageNavigation2.render().$el),this.isPlayerSkin&&this.flipViewContainer.append(this.pageNavigation2.render().el),this.pageNavigation1.on(FlipEvents.PREVIOUS_PAGE,this.sendPreviousPageEvent,this),this.pageNavigation1.on(FlipEvents.NEXT_PAGE,this.sendNextPageEvent,this),this.pageNavigation2.on(FlipEvents.PREVIOUS_PAGE,this.sendPreviousPageEvent,this),this.pageNavigation2.on(FlipEvents.NEXT_PAGE,this.sendNextPageEvent,this)},createItemNavigation:function(){this.itemNavigation=new ItemNavigationView({model:new Backbone.Model({totalItems:this.totalItems,currentItem:FSWidgetModel.gi().widgetState.get("currentItemIndex"),prevlabel:FSWidgetModel.gi().get("labels").l_prevLabelText,nextlabel:FSWidgetModel.gi().get("labels").l_nextLabelText,collectionSize:[FSWidgetModel.gi().get("width"),FSWidgetModel.gi().get("height")]})}),this.$el.append(this.itemNavigation.render().$el),this.itemNavigation.on(FlipEvents.PREVIOUS_ITEM,this.sendPreviousItemEvent,this),this.itemNavigation.on(FlipEvents.NEXT_ITEM,this.sendNextItemEvent,this)},createDocumentView:function(){var e;e=this.isMobileDevice&&FSUtils.isInFullScreen()&&$(window).width()<$(window).height()?0:this.pageNavigation1.getButtonsTotalWidth(),this.docView=new DocumentView({model:new DocumentModel({displayType:FSWidgetModel.gi().widgetState.get("displayType"),maxSize:[Math.floor(this.$el.width()-e),Math.floor(this.$el.height())],collectionSize:[FSWidgetModel.gi().get("width"),FSWidgetModel.gi().get("height")],item:this.localItem,currentPageIndex:this.docPageIndex,offset:this.$el.offset(),navButtonWidth:e/2,singlePageView:this.isSinglePageView,arabicStyle:this.isArabicStyle,enableSounds:FSWidgetModel.gi().widgetSettings.get("enableSounds"),showPageShadows:FSWidgetModel.gi().widgetSettings.get("showPageShadows"),mergePdfs:FSWidgetModel.gi().widgetSettings.get("mergePdfs"),retryFirstItem:!1,navigationView:this.pageNavigation1})}),this.docView.on(FlipEvents.FLIP_TAP,this.sendClickOrTapEvent,this),this.docView.on(FlipEvents.PREVIOUS_PAGE,this.sendPreviousPageEvent,this),this.docView.on(FlipEvents.NEXT_PAGE,this.sendNextPageEvent,this),this.docView.on(FlipEvents.FLIP_POSITIONED,this.positionPageNav,this),this.docView.on(WidgetEvent.PAGE_TURN_END,this.pageTurnEnd,this),this.docView.on(WidgetEvent.PAGE_CHANGED,this.docPageChanged,this),this.$el.append(this.docView.render().$el)},createGenericElementsContainer:function(){this.$genericElements=this.$el.find("#genericElements")},render:function(){return this},resize:function(){var e,t=this.$el.width(),i=this.$el.height();FSUtils.isPlayerSkin()&&this.$el.css({top:($(window).height()-i)/2}),e=this.isMobileDevice&&FSUtils.isInFullScreen()&&$(window).width()<$(window).height()?0:this.pageNavigation1.getButtonsTotalWidth(),"number"==typeof this.docView.bookScale&&this.docView.bookScale>1||(this.itemNavigationVisible&&(this.itemNavigation.model.set({collectionSize:[FSWidgetModel.gi().get("width"),FSWidgetModel.gi().get("height")]}),i-=this.itemNavigation.getHeight()),this.pageNavigation1.model.set({collectionSize:[FSWidgetModel.gi().get("width"),FSWidgetModel.gi().get("height")],maxHeight:"number"==typeof this.docViewHeight&&this.docViewHeight>0?this.docViewHeight:i,displayType:FSWidgetModel.gi().widgetState.get("displayType")}),this.pageNavigation2.model.set({collectionSize:[FSWidgetModel.gi().get("width"),FSWidgetModel.gi().get("height")],maxHeight:"number"==typeof this.docViewHeight&&this.docViewHeight>0?this.docViewHeight:i,displayType:FSWidgetModel.gi().widgetState.get("displayType")}),this.docView.model.set({maxSize:[Math.floor(t-e),Math.floor(i)],collectionSize:[FSWidgetModel.gi().get("width"),FSWidgetModel.gi().get("height")],displayType:FSWidgetModel.gi().widgetState.get("displayType"),offset:this.$el.offset(),navButtonWidth:e/2}))},displayTypeChange:function(){this.docView.model.set("displayType",FSWidgetModel.gi().widgetState.get("displayType")),this.pageNavigation1.model.set("displayType",FSWidgetModel.gi().widgetState.get("displayType")),this.pageNavigation2.model.set("displayType",FSWidgetModel.gi().widgetState.get("displayType")),FSWidgetModel.gi().widgetState.get("displayType")===DisplayType.SMALL&&this.totalItems>1?(this.itemNavigationVisible=!0,this.itemNavigation.show(),this.pageNavigation1.model.set({fullHeight:!1}),this.pageNavigation2.model.set({fullHeight:!1})):(this.itemNavigationVisible=!1,this.itemNavigation.hide(),this.pageNavigation1.model.set({fullHeight:!0}),this.pageNavigation2.model.set({fullHeight:!0})),this.resize()},handleFullScreenChanged:function(e){e.displayState===DisplayState.NORMAL&&this.resize()},sendPreviousItemEvent:function(){Backbone.Mediator.pub(WidgetEvent.PREV_ITEM)},sendNextItemEvent:function(){Backbone.Mediator.pub(WidgetEvent.NEXT_ITEM)},sendPreviousPageEvent:function(){Backbone.Mediator.pub(WidgetEvent.PREV_PAGE)},sendNextPageEvent:function(){Backbone.Mediator.pub(WidgetEvent.NEXT_PAGE)},itemChanged:function(){this.processCurrentItem(),this.itemNavigation.model.set({currentItem:FSWidgetModel.gi().widgetState.get("currentItemIndex")}),this.pageNavigation1.model.set({totalPages:this.totalItemPages,currentPage:this.docPageIndex}),this.pageNavigation2.model.set({totalPages:this.totalItemPages,currentPage:this.docPageIndex}),this.docView.model.set({item:this.localItem,currentPageIndex:this.docPageIndex})},processCurrentItem:function(){this.generateLocalItem(),this.totalItemPages=this.localItem.get("pages").length,this.docPageIndex=this.calculatePageIndexForLocal(FSWidgetModel.gi().widgetState.get("currentPageIndex"))},generateLocalItem:function(){var e=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").clone();this.localItem=FSWidgetModel.gi().widgetState.get("currentItem").clone(),this.localItem.set({pages:e,forms:[]}),this.isSinglePageView&&this.addBlankPages()},addBlankPages:function(){var e,t=this.localItem.get("pages"),i=0;for(t.at(t.length-1).get("type")===PageType.EMPTY_PAGE&&t.pop(),e=t.length;i<e;i++)this.localItem.addBlankPage(this.isArabicStyle,this.isArabicStyle?2*i:2*i+1);this.localItem.set("noOfPages",this.localItem.get("pages").length)},calculatePageIndexForLocal:function(e){return this.isSinglePageView?this.isArabicStyle?2*e+1:2*e:e},calculatePageIndexForWidget:function(e){return this.isSinglePageView?this.isArabicStyle?Math.round(e/2-1):Math.round(e/2):e},pageChanged:function(){this.docPageIndex=this.calculatePageIndexForLocal(FSWidgetModel.gi().widgetState.get("currentPageIndex")),this.pageNavigation1.model.set({currentPage:this.docPageIndex}),this.pageNavigation2.model.set({currentPage:this.docPageIndex}),this.docView.model.set({lastPageIndex:this.docView.model.get("currentPageIndex"),currentPageIndex:this.docPageIndex})},docPageChanged:function(e){var t;this.docPageIndex=e%2==0?Math.max(e-1,0):e,t=this.calculatePageIndexForWidget(this.docPageIndex),Backbone.Mediator.pub(WidgetEvent.PAGE_CHANGED,t)},pageTurnStart:function(e){FSWidgetModel.gi().widgetState.get("isBuyCurtainDisplayed")||(this.isSinglePageView?this.isArabicStyle?e.nextPageIndex===this.totalItemPages-1?(this.pageNavigation1.hideNext(),this.pageNavigation2.hideNext(),this.totalItemPages>4&&(this.pageNavigation1.showPrevious(),this.pageNavigation2.showPrevious())):2===e.nextPageIndex&&(this.pageNavigation1.hidePrevious(),this.pageNavigation2.hidePrevious(),this.totalItemPages>2&&e.previousPageIndex<this.totalItemPages-1&&(this.pageNavigation1.showNext(),this.pageNavigation2.showNext())):e.nextPageIndex===this.totalItemPages-3?(this.pageNavigation1.hideNext(),this.pageNavigation2.hideNext(),this.totalItemPages>2&&e.nextPageIndex>1&&(this.pageNavigation1.showPrevious(),this.pageNavigation2.showPrevious())):0===e.nextPageIndex&&(this.pageNavigation1.hidePrevious(),this.pageNavigation2.hidePrevious(),this.totalItemPages>4&&(this.pageNavigation1.showNext(),this.pageNavigation2.showNext())):e.nextPageIndex===this.totalItemPages-1?(this.pageNavigation1.hideNext(),this.pageNavigation2.hideNext(),this.totalItemPages>2&&(this.pageNavigation1.showPrevious(),this.pageNavigation2.showPrevious())):0===e.nextPageIndex&&(this.pageNavigation1.hidePrevious(),this.pageNavigation2.hidePrevious(),this.totalItemPages>2&&(this.pageNavigation1.showNext(),this.pageNavigation2.showNext())))},pageTurnEnd:function(e){FSWidgetModel.gi().widgetState.get("isBuyCurtainDisplayed")||(this.isSinglePageView&&this.isArabicStyle&&e.currentPageIndex>2||this.isSinglePageView&&!this.isArabicStyle&&e.currentPageIndex>0||!this.isSinglePageView&&e.currentPageIndex>0?(this.pageNavigation1.showPrevious(),this.pageNavigation2.showPrevious()):(this.pageNavigation1.hidePrevious(),this.pageNavigation2.hidePrevious()),this.isSinglePageView&&!this.isArabicStyle&&e.currentPageIndex<this.totalItemPages-3||this.isSinglePageView&&this.isArabicStyle&&e.currentPageIndex<this.totalItemPages-1||!this.isSinglePageView&&e.currentPageIndex<this.totalItemPages-1?(this.pageNavigation1.showNext(),this.pageNavigation2.showNext()):(this.pageNavigation1.hideNext(),this.pageNavigation2.hideNext()),Backbone.Mediator.pub(WidgetEvent.PAGE_TURN_END,{currentPageIndex:this.calculatePageIndexForWidget(e.currentPageIndex)}))},pageTurnCanceled:function(e){var t=this.docPageIndex;FSWidgetModel.gi().widgetState.get("isBuyCurtainDisplayed")||(this.isSinglePageView?this.isArabicStyle?(t>1&&(this.pageNavigation1.showPrevious(),this.pageNavigation2.showPrevious()),t<this.totalItemPages-1&&(this.pageNavigation1.showNext(),this.pageNavigation2.showNext())):(t>0&&(this.pageNavigation1.showPrevious(),this.pageNavigation2.showPrevious()),t<this.totalItemPages-3&&(this.pageNavigation1.showNext(),this.pageNavigation2.showNext())):1===t&&2===e.page&&1===e.next?(this.pageNavigation1.showPrevious(),this.pageNavigation2.showPrevious()):t!==this.totalItemPages-3&&0!==t||e.page!==this.totalItemPages-1||e.next!==this.totalItemPages||(this.pageNavigation1.showNext(),this.pageNavigation2.showNext()))},sendClickOrTapEvent:function(){Backbone.Mediator.pub(WidgetEvent.WIDGET_CLICK_OR_TAP)},positionPageNav:function(e){"number"==typeof this.docView.bookScale&&this.docView.bookScale>1||(this.docViewHeight=e.height,this.pageNavigation1.model.set({flipViewLeft:e.left,navDistance:e.width,maxHeight:e.height}),this.pageNavigation2.model.set({flipViewLeft:e.left,navDistance:e.width,maxHeight:e.height}),this.docView.flipbook.css("navButtonWidth",this.pageNavigation1.getButtonsTotalWidth()/2),this.docView.flipbook.css("navButtonWidth",this.pageNavigation2.getButtonsTotalWidth()/2))},widgetSettingsChanged:function(e){"arabicStyle"in e.changed&&(this.isArabicStyle=e.changed.arabicStyle),"singlePageView"in e.changed&&(this.isSinglePageView=e.changed.singlePageView),this.docView.model.set(e.changed)},remove:function(){this.pageNavigation1&&(this.pageNavigation1.off(),this.pageNavigation1.remove(),this.pageNavigation1=null),this.pageNavigation2&&(this.pageNavigation2.off(),this.pageNavigation2.remove(),this.pageNavigation2=null),this.itemNavigation&&(this.itemNavigation.off(),this.itemNavigation.remove(),this.itemNavigation=null),this.docView&&(this.docView.off(),this.docView.remove(),this.docView=null),this.$el.off(),Backbone.Mediator.unsubscribe(WidgetEvent.RESIZE,this.resize,this),Backbone.Mediator.unsubscribe(WidgetEvent.RENDER_LAYOUT,this.resize,this),Backbone.Mediator.unsubscribe(WidgetEvent.PAGE_TURN_START,this.pageTurnStart,this),Backbone.Mediator.unsubscribe(WidgetEvent.PAGE_TURN_CANCELED,this.pageTurnCanceled,this),Backbone.Mediator.unsubscribe(WidgetEvent.FULLSCREEN_CHANGED,this.handleFullScreenChanged,this),Backbone.View.prototype.remove.apply(this,arguments)},handleTouchStart:function(e){var t=e.originalEvent.touches;this.isMultiTouch&&this.handleTouchEnd(e),this.isInFullScreen=FSUtils.isInFullScreen(),this.deltaX=0,this.isMultiTouch=!1,window.touchObj={touch1:{},touch2:{}},this.isInFullScreen||this.isPlayerSkin?t&&2===t.length?(e.preventDefault(),e.stopPropagation(),window.touchObj.startZoom=this.docView.currentZoom,this.isMultiTouch=!0,this.docView.model.set("isMultiTouch",!0),window.touchObj.touch1={startX:t[0].pageX,startY:t[0].pageY,currentX:0,currentY:0},window.touchObj.touch2={startX:t[1].pageX,startY:t[1].pageY,currentX:0,currentY:0},window.touchObj.initialDeltaX=Math.abs(window.touchObj.touch2.startX-window.touchObj.touch1.startX),window.touchObj.initialDeltaY=Math.abs(window.touchObj.touch2.startY-window.touchObj.touch1.startY)):FSWidgetModel.gi().get("currentZoom")>0?(e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.docView.mouseDownDocView(e)):this.touchStartPosX=this.currentTouchPosX=t[0].pageX:t&&1===t.length&&(this.touchStartPosX=this.currentTouchPosX=t[0].pageX),this.$el.on("touchmove",$.proxy(this.handleTouchMove,this))},handleTouchMove:function(e){var t=this.isIOS?e.originalEvent.touches:e.originalEvent.changedTouches;1===t.length&&(this.currentTouchPosX=t[0].pageX,this.deltaX=this.currentTouchPosX-this.touchStartPosX),(this.isInFullScreen||this.isPlayerSkin)&&(this.isMultiTouch?t&&2===t.length&&(e.preventDefault(),e.stopPropagation(),window.touchObj.touch1.currentX=t[0].pageX,window.touchObj.touch1.currentY=t[0].pageY,window.touchObj.touch2.currentX=t[1].pageX,window.touchObj.touch2.currentY=t[1].pageY,window.requestAnim(this.doPinchZoom)):FSWidgetModel.gi().get("currentZoom")>0&&(e.pageX=t[0].pageX,e.pageY=t[0].pageY,this.docView.mouseMoveDocView(e)))},doPinchZoom:function(){var e,t,i,o,n,s,a=FSWidgetModel.gi().get("maxZoomValue");e=Math.abs(window.touchObj.touch2.currentX-window.touchObj.touch1.currentX),t=Math.abs(window.touchObj.touch2.currentY-window.touchObj.touch1.currentY),n=e-window.touchObj.initialDeltaX,s=t-window.touchObj.initialDeltaY,i=Math.abs(n)>Math.abs(s)?n/$(window).width():s/$(window).height(),i*=FlipView.ZOOM_FACTOR,o=window.touchObj.startZoom+i,o=i<0&&o<=.05?0:o,o=Math.min(a,o),Backbone.Mediator.pub(WidgetEvent.CHANGE_ZOOM,{value:o})},handleTouchEnd:function(e){var t,i,o,n=(new Date).getTime(),s=n-this.lastTap,a=this;clearTimeout(this.timeout),e.originalEvent&&e.originalEvent.changedTouches&&(t=e.originalEvent.changedTouches,0===FSWidgetModel.gi().get("currentZoom")&&1===t.length&&!this.isMultiTouch&&Math.abs(this.deltaX)>FlipView.SWIPE_THRESHOLD&&(e.preventDefault(),e.stopPropagation(),this.currentTouchPosX<this.touchStartPosX?Backbone.Mediator.pub(WidgetEvent.NEXT_PAGE):Backbone.Mediator.pub(WidgetEvent.PREV_PAGE)),this.isMultiTouch||(i=t[0].clientX,o=t[0].clientY,s<DocumentView.DOUBLE_TAP_TIMEOUT&&s>0?(e.preventDefault(),i<this.firstTouchPos.x+DocumentView.DOUBLE_TAP_RADIUS&&i>this.firstTouchPos.x-DocumentView.DOUBLE_TAP_RADIUS&&o<this.firstTouchPos.y+DocumentView.DOUBLE_TAP_RADIUS&&o>this.firstTouchPos.y-DocumentView.DOUBLE_TAP_RADIUS&&(this.docView.enterZoom(e),this.lastTap=0,clearTimeout(this.timeout),this.firstTouchPos=null)):(this.timeout=setTimeout((function(){clearTimeout(a.timeout)}),DocumentView.DOUBLE_TAP_TIMEOUT),this.lastTap=n,this.firstTouchPos={x:i,y:o}))),this.isMultiTouch||FSWidgetModel.gi().get("currentZoom")>0?(this.isMultiTouch?(Backbone.Mediator.pub(WidgetEvent.ZOOM_END,{value:FSWidgetModel.gi().get("currentZoom")}),this.isMultiTouch=!1,this.docView.model.set("isMultiTouch",!0),e.preventDefault(),e.stopPropagation()):this.docView.mouseUpDocView(),window.touch1={},window.touch2={}):this.docView.mouseUpDocView(),this.deltaX=0,this.$el.off("touchmove")},handleBuyCurtain:function(){var e=FSWidgetModel.gi().widgetState.get("isBuyCurtainDisplayed");this.pageNavigation1.model.set("isBuyCurtainDisplayed",e),this.pageNavigation2.model.set("isBuyCurtainDisplayed",e)}}),FlipView.SMALL_MAX_WIDTH=700,FlipView.SMALL_MAX_HEIGHT=700,FlipView.SWIPE_THRESHOLD=75,FlipView.ZOOM_FACTOR=5,FlipView._instance=null,FlipView.gi=function(){return FlipView._instance||(FlipView._instance=new FlipView),FlipView._instance},Backbone.Mediator.sub(WidgetEvent.CONFIG_DONE,(function(){FSWidgetModel.gi().get("shelfData")&&FSWidgetModel.gi().get("shelfData").get("shelfOpened")||(FSWidgetModel.gi().widgetState.get("currentItem").get("hasCustomContent")?window.CustomContentView?FlipView.gi():Backbone.Mediator.sub(WidgetEvent.CUSTOM_VIEW_LOADED,i,t):FlipView.gi())}),this),Backbone.Mediator.sub(WidgetEvent.DESTROY,(function(){FlipView._instance&&(FlipView.gi().remove(),FlipView._instance=null)}),this)}(window);var MenuTemplates={shareButton:'<span class="btn"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 -2 18 20"><path d="M6 8.617c0 .058-.013.113-.017.171l6.091 3.045A2.97 2.97 0 0 1 14 11.115a3 3 0 1 1-3 3c0-.06.014-.113.017-.17L4.926 10.9A2.98 2.98 0 0 1 3 11.615a3 3 0 0 1 0-6 2.98 2.98 0 0 1 1.926.718l6.09-3.045C11.015 3.23 11 3.175 11 3.115a3 3 0 1 1 3 3.002 2.967 2.967 0 0 1-1.926-.719l-6.09 3.046c.002.059.016.113.016.173z"/></svg><label><%- label %></label></span>',downloadButton:'<a class="btn" href="<%- link %>" target="<%- target %>" rel="nofollow noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="20" viewBox="0 0 19 20"><path d="M5 6.5a1 1 0 0 1 1.4 0l1.4 1.3V2A1 1 0 1 1 10 2v6l.5-.6 1-1a1 1 0 0 1 1.6 0c.4.3.5.7.4 1a1 1 0 0 1 0 .4H13V8l-1.7 1.6-1.7 1.7a1 1 0 0 1-.8.4c-.3 0-.6 0-.8-.4L6.5 9.6 5 8a1 1 0 0 1-.2 0v-.2a1.2 1.2 0 0 1-.2-.3 1 1 0 0 1 .3-1zm12.5 10.8c0 1.5-1.5 2.7-3.4 2.7H4c-2 0-3.4-1.2-3.4-2.7V10C.4 9 1.4 8 3 7.6c0 .6.3 1.2.7 1.7l.5.4h-.4c-.8 0-1.2.4-1.2.5v7.3c0 .2.4.5 1.2.5H14c1 0 1.3-.3 1.3-.5V10s-.4-.4-1.2-.4H14l.4-.4a2.7 2.7 0 0 0 .8-1.7c1.5.3 2.5 1.4 2.5 2.6v7.3z"/></svg><label><%- label %></label></a>',printButton:'<a class="btn" href="<%- link %>" target="<%- target %>" rel="nofollow noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" viewBox="0 0 19 20"><path fill-rule="nonzero" d="M17.813 4.75H1.188C.532 4.75 0 5.283 0 5.938v7.125c0 .656.532 1.187 1.188 1.187h2.375v3.563c0 .657.531 1.188 1.187 1.188h9.5c.656 0 1.187-.531 1.187-1.188V14.25h2.376c.656 0 1.187-.53 1.187-1.187V5.938c0-.655-.531-1.188-1.187-1.188zM14.25 17.813h-9.5v-7.125h9.5v7.125zm2.375-9.5a1.187 1.187 0 1 1-.001-2.374 1.187 1.187 0 0 1 0 2.374zM4.75 1.188v2.375H3.563V1.188C3.563.532 4.094 0 4.75 0h9.5c.656 0 1.188.532 1.187 1.188v2.375H14.25V1.188h-9.5z"/></svg><label><%- label %></label></a>',searchButton:'<span class="btn"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="21" viewBox="0 -2 20 21"><path d="M17.2 13.2c3-3 3-8 0-11s-8-3-11 0c-2.5 2.6-3 6.4-1 9.4v.3l-4 4c-1 .7-1 1.8-.3 2.5.7.8 1.8.6 2.5-.2l4-4H8a7.6 7.6 0 0 0 9.2-1zm-9.5-1.5a5.7 5.7 0 0 1 0-8 5.7 5.7 0 0 1 8 0 5.7 5.7 0 0 1 0 8 5.7 5.7 0 0 1-8 0z"/></svg><label><%- label %></label></svg>',zoomButton:'<span class="btn"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="23" viewBox="0 0 17 17"><path d="M6.7 12.8s-.2-.2-.4 0l-3.5 3.5c-.7.7-1.7.8-2.3.2l-.1-.1c-.7-.6-.5-1.6.2-2.3l3.5-3.5c.1-.1 0-.3 0-.3-1.6-2.6-1.3-6 1-8.3 2.7-2.7 7.1-2.7 9.8 0s2.7 7.1 0 9.8c-2.3 2.3-5.7 2.6-8.2 1zm6.9-2.3c2-2 2-5.2 0-7.2s-5.2-2-7.2 0-2 5.2 0 7.2 5.2 2 7.2 0zm-.5-4.4v1.5h-2.2v2.3H9.2V7.6H7V6.1h2.2V3.9h1.7v2.2h2.2z" /></svg><label><%- label %></label></span>',buttonX:'<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 26 26"><path d="M15.3 13L25.5 2.8A1.6 1.6 0 1 0 23.2.5L13 10.7 2.8.5A1.6 1.6 0 1 0 .5 2.8L10.7 13 .5 23.2a1.6 1.6 0 1 0 2.3 2.3L13 15.3l10.2 10.2a1.6 1.6 0 0 0 2.3 0 1.6 1.6 0 0 0 0-2.3L15.3 13z"/> </svg>',menuOptionsContent:'<div class="content"></div><div class="arrow"><div></div></div>',menuOptionElement:'<a href="<%- link %>" rel="nofollow noopener noreferrer" target="<%- target %>"></a>',menuOptionLink:'<input type="text" id="share-link-input" value="<%- link %>" readonly /><span id="share-link-confirmation"><%- confirmMessage %></span>',tocButton:'<span class="btn"><svg xmlns="http://www.w3.org/2000/svg" width="23" height="18" viewBox="0 0 23 18"><defs><filter id="a" width="131.6%" height="142.9%" x="-15.8%" y="-21.4%" filterUnits="objectBoundingBox"><feOffset in="SourceAlpha" result="shadowOffsetOuter1"/><feGaussianBlur in="shadowOffsetOuter1" result="shadowBlurOuter1" stdDeviation="1"/><feComposite in="shadowBlurOuter1" in2="SourceAlpha" operator="out" result="shadowBlurOuter1"/><feColorMatrix in="shadowBlurOuter1" result="shadowMatrixOuter1" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.298969656 0"/><feMerge><feMergeNode in="shadowMatrixOuter1"/><feMergeNode in="SourceGraphic"/></feMerge></filter></defs><path d="M4.176 5H.963a.912.912 0 0 0-.682.292A.983.983 0 0 0 0 6v2c0 .278.094.514.281.708A.913.913 0 0 0 .963 9h3.213a.913.913 0 0 0 .682-.292A.982.982 0 0 0 5.14 8V6a.983.983 0 0 0-.28-.708A.913.913 0 0 0 4.175 5zm0-5H.963a.912.912 0 0 0-.682.292A.983.983 0 0 0 0 1v2c0 .278.094.514.281.708A.913.913 0 0 0 .963 4h3.213a.913.913 0 0 0 .682-.292A.983.983 0 0 0 5.14 3V1a.984.984 0 0 0-.28-.708A.913.913 0 0 0 4.175 0zm0 10H.963a.912.912 0 0 0-.682.292A.983.983 0 0 0 0 11v2c0 .278.094.514.281.708A.912.912 0 0 0 .963 14h3.213a.913.913 0 0 0 .682-.292A.982.982 0 0 0 5.14 13v-2a.983.983 0 0 0-.28-.708.913.913 0 0 0-.683-.292zM17.6 5H7.962a.912.912 0 0 0-.682.292A.983.983 0 0 0 7 6v2c0 .278.094.514.281.708A.912.912 0 0 0 7.963 9H17.6a.912.912 0 0 0 .682-.292.982.982 0 0 0 .28-.708V6a.982.982 0 0 0-.28-.708.912.912 0 0 0-.683-.292zm0 5H7.962a.912.912 0 0 0-.682.292A.983.983 0 0 0 7 11v2c0 .278.094.514.281.709a.912.912 0 0 0 .682.291H17.6a.912.912 0 0 0 .682-.291.983.983 0 0 0 .28-.709v-2a.982.982 0 0 0-.28-.708.913.913 0 0 0-.683-.292zm.682-9.708A.912.912 0 0 0 17.599 0H7.963a.912.912 0 0 0-.682.292A.983.983 0 0 0 7 1v2c0 .278.094.514.281.708A.913.913 0 0 0 7.963 4H17.6a.913.913 0 0 0 .682-.292.982.982 0 0 0 .28-.708V1a.982.982 0 0 0-.28-.708z" filter="url(#a)" transform="translate(2 2)"/></svg><label><%- label %></label></span>',tableOfContent:{content:'<div class="content"></div>',header:'<span class="name">Table of contents</span><span class="close"/>',row:'<div class="row-header"><span title="<%- title %>" class="title"><%- title %></span></div><div class="subnodes"></div>',arrow:'<svg width="6" height="10" viewBox="0 0 6 10" xmlns="http://www.w3.org/2000/svg"><path d="M1.11 0L0 1.097 3.646 4.7 0 8.303 1.11 9.4l4.756-4.7z" fill-rule="nonzero"/></svg>'},shareIcons:{facebook:'<svg xmlns="http://www.w3.org/2000/svg" width="9" height="19" viewBox="0 0 9 19"><path d="M6.7 3.6H9V0H6.3c-3.3 0-4 2-4 4.2V6H0v3.5h2.2V19h3.4V9.5h2.8L9 6H5.5V5c0-.8.5-1.4 1-1.4z"/></svg>',twitter:'<svg xmlns="http://www.w3.org/2000/svg" width="19" height="16" viewBox="0 0 19 16"><path d="M18.5 1.8a7.4 7.4 0 0 1-2.2.6 4 4 0 0 0 1.6-2 7.5 7.5 0 0 1-2.5.8A3.7 3.7 0 0 0 12.8 0C10.8 0 9 1.7 9 4v.8C6 4.6 3.3 3 1.4.8a4 4 0 0 0-.5 2 4 4 0 0 0 1.7 3 3.7 3.7 0 0 1-1.8-.4c0 2 1.3 3.5 3 4a3.7 3.7 0 0 1-1 0h-.6c.6 1.5 2 2.6 3.6 2.6A7.5 7.5 0 0 1 0 13.6a10.5 10.5 0 0 0 5.8 1.8c7 0 10.8-6 10.8-11v-.6a7.7 7.7 0 0 0 2-2z"/></svg>',instagram:'<svg xmlns="http://www.w3.org/2000/svg" width="21" height="20" viewBox="0 0 21 20"><path d="M15.6 3.2c-.4 0-.7 0-1 .3-.2.3-.3.6-.3 1 0 .2 0 .5.3.8a1.4 1.4 0 0 0 2 0c0-.3.3-.6.3-1 0-.2-.3-.5-.5-.8a1.4 1.4 0 0 0-1-.3zM10 4.6c-2.8 0-5 2.2-5 5 0 2.7 2.2 5 5 5s5.3-2.3 5.3-5c0-2.8-2.3-5-5.2-5zm0 8.2c-1.8 0-3.3-1.5-3.3-3.3 0-1.7 1.5-3.2 3.4-3.2 2 0 3.5 1.5 3.5 3.2 0 1.8-1.5 3.3-3.4 3.3zM14.7 0h-9C2.6 0 0 2.4 0 5.3v8.5c0 3 2.5 5.3 5.6 5.3h9c3 0 5.6-2.3 5.6-5.2V5.3c0-3-2.5-5.3-5.6-5.3zm0 17.4h-9c-2 0-3.8-1.6-3.8-3.6V5.3c0-2 1.7-3.6 3.8-3.6h9c2 0 3.8 1.6 3.8 3.6v8.5c0 2-1.7 3.6-3.8 3.6z"/></svg>',googleplus:'<svg xmlns="http://www.w3.org/2000/svg" width="27" height="16" viewBox="0 0 27 16"><path d="M26.7 9.15h-2.617v2.565H21.9V9.15h-2.617V7.014H21.9V4.45h2.182v2.564H26.7V9.15zM8.272 15.94C3.682 15.94 0 12.442 0 7.97 0 3.498 3.682 0 8.272 0c2.227 0 4.182.62 5.59 1.948l-2.408 2.347C10.68 3.498 9.544 3.1 8.272 3.1c-2.727 0-5.09 2.213-5.09 4.87s2.363 4.87 5.09 4.87c2.273 0 4-1.416 4.5-3.542h-4.59v-3.1h8c.09.532.135 1.196.135 1.772a9.57 9.57 0 0 1-.136 1.638c-.636 4.118-3.817 6.332-7.908 6.332z"/></svg>',pinterest:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 0 16 19"><path d="M9 14.4c-1.2 0-2.3-.7-2.7-1.5l-.8 3c-.2 1-.7 1.8-1 2.5-.7.7-1.3.2-1.4-.5 0-.8 0-1.7.3-2.6l1.4-6.2s-.4-.7-.4-1.8c0-1.7 1-3 2.2-3 1 0 1.5.8 1.5 1.7 0 1.2-.6 2.8-1 4.2-.3 1.2.6 2.2 1.8 2.2 2 0 3.5-2.8 3.5-6 0-2.6-1.6-4.4-4.6-4.4-3.4 0-5.5 2.5-5.5 5.4 0 1 .3 1.7.7 2.3v.6l-.2 1c0 .2-.3.3-.5.2C.7 10.8 0 9 0 7c0-3 2.7-7 8-7 4.2 0 7 3.2 7 6.5 0 4.5-2.4 8-6 8z"/></svg>',email:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="19" viewBox="0 0 24 19"><path d="M23.8 17.3a1 1 0 0 1-.2.4c-.5.8-1.2 1.2-2 1.2H2.4c-.7 0-1.4-.5-2-1a1 1 0 0 1-.2-.8 3 3 0 0 1-.2-1V2.6C0 1.2 1 0 2.4 0h19.2c.6 0 1.2.3 1.6.7a.7.7 0 0 1 .2.2c.4.4.6 1 .6 1.6v13.6c0 .4 0 .8-.2 1zm-2-.2L15 10l-2.4 2.5-.6.2a.7.7 0 0 1-.5-.2L9 10l-6.7 7h19.3a.7.7 0 0 0 .2 0zm.6-1.7V3l-6.2 6 6.2 6.3zm-20.8 0L7.8 9 1.6 3v12.3zM3 1.8l9 8.8 9.2-8.8H3z"/></svg>'},searchInput:'<input type="search" /><div class="results-nr" /><div class="clear-results <%- hideClearButton %>"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"><path fill="#FFF" fill-rule="evenodd" d="M.31.286a1 1 0 011.413 0L10 8.563 18.277.286a1 1 0 011.414 0l.023.023a1 1 0 010 1.414L11.437 10l8.277 8.277a1 1 0 01.083 1.32l-.083.094-.023.023a1 1 0 01-1.414 0L10 11.437l-8.277 8.277a1 1 0 01-1.414 0l-.023-.023a1 1 0 010-1.414L8.563 10 .286 1.723A1 1 0 01.203.403L.286.31z"/></svg></div>',searchResults:'<div class="results-nr"><%- resultCountText %></div><div class="search-result-list"></div>',searchResult:'<div class="title"><%- title %></div><div class="html"><%= html %></div>',zoom:'<div class="content"><span class="zoom-min zoom-action" /><span class="zoom-slider"><span class="zoom-btn zoom-slider-btn"></span></span><span class="zoom-plus zoom-action" /></div><div class="arrow"><div></div></div>',zoomPlayer:'<div class="content"><span class="zoom-min zoom-action" /><span class="zoom-slider"><span class="zoom-slider-progress"></span><span class="zoom-btn zoom-slider-btn"></span></span><span class="zoom-plus zoom-action" /></div>',enterFullscreenPlayer:'<span><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="#FFF" fill-rule="evenodd" d="M19 12a1 1 0 011 1v6a1 1 0 01-.883.993L19 20h-6a1 1 0 010-2h5v-5a1 1 0 011-1zM1 12a1 1 0 011 1v5h5a1 1 0 010 2H1a1 1 0 01-1-1v-6a1 1 0 011-1zM7 0a1 1 0 110 2l-5-.001V7a1 1 0 11-2 0V1a1 1 0 011-1h6zm12 0a1 1 0 011 1v6a1 1 0 01-2 0V2h-5a1 1 0 010-2h6z" /></svg><label><%- label %></label></span',leaveFullscreenPlayer:'<span><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"> <path fill="#FFF" fill-rule="evenodd" d="M19 12c.552 0 1 .448 1 1s-.448 1-1 1h-5v5c0 .552-.448 1-1 1s-1-.448-1-1v-6c0-.552.448-1 1-1h6zM7 12c.552 0 1 .448 1 1v6c0 .552-.448 1-1 1s-1-.448-1-1v-5H1c-.552 0-1-.448-1-1s.448-1 1-1h6zM7 0c.552 0 1 .448 1 1v6c0 .513-.386.936-.883.993L7 8H1c-.552 0-1-.448-1-1s.448-1 1-1h5V1c0-.552.448-1 1-1zm6 0c.552 0 1 .448 1 1v5h5c.552 0 1 .448 1 1s-.448 1-1 1h-6c-.552 0-1-.448-1-1V1c0-.552.448-1 1-1z" /></svg><label><%- label %></label></span>',downloadBtnPlayer:'<a class="btn" href="<%- link %>" target="<%- target %>" rel="nofollow noopener noreferrer"><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M3 5a1 1 0 110 2H2l-.001 11h16L18 7h-1a1 1 0 010-2h2a1 1 0 011 1v13a1 1 0 01-1 1H1a1 1 0 01-1-1V6a1 1 0 011-1h2zm7-5a1 1 0 011 1v12.656l2.95-2.949a1 1 0 011.32-.083l.094.083a1 1 0 010 1.414l-4.243 4.243a.998.998 0 01-.302.207 1 1 0 01-1.676-.056 1.035 1.035 0 01-.193-.151l-4.243-4.243a1 1 0 111.414-1.414L9 13.586V1a1 1 0 011-1z" fill="#FFF"/></g></svg><label><%- label %></label></a>',printBtnPlayer:'<a class="btn" href="<%- link %>" target="<%- target %>" rel="nofollow noopener noreferrer"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20"><path fill="#FFF" d="M16 0c.552 0 1 .448 1 1v3h2c.552 0 1 .448 1 1v9c0 .552-.448 1-1 1h-2v3c0 1.054-.816 1.918-1.85 1.995L15 20H5c-1.105 0-2-.895-2-2v-3H1c-.552 0-1-.448-1-1V5c0-.552.448-1 1-1h2V1c0-.552.448-1 1-1h12zm-1 11H5v7h10v-7zm3-5H2v7h1v-2c0-.1.007-.2.022-.296l.002-.014.01-.058c.024-.129.06-.253.107-.372l.015-.036c.034-.08.072-.156.115-.23l.02-.034.049-.076.034-.05.05-.066.037-.046.057-.065.037-.04c.024-.024.047-.048.072-.071l.027-.025.072-.063.048-.038.066-.05.047-.032.068-.044.057-.033c.03-.018.06-.034.092-.05L4.13 9.2c.037-.018.075-.035.114-.051l.023-.01.079-.029.072-.023.052-.015.087-.022.07-.014.074-.013C4.8 9.008 4.9 9 5 9h10c.103 0 .203.008.302.023l.065.01.086.018.033.008.092.026.027.008.014.005c.039.012.076.026.114.04l.043.018.099.045.024.012c.033.017.066.034.098.053l.043.025.076.049.05.034.066.05.046.037.065.057.04.037c.024.024.048.047.071.072l.025.027.063.072.038.048.05.066.032.047.044.068.033.057c.06.106.111.217.152.334.055.16.09.33.104.505L17 11v2h1V6zm-3-4H5v2h10V2z"/></svg><label><%- label %></label></a>',searchBtnPlayer:'<div class="action-button-player"><span><svg width="21" height="21" xmlns="http://www.w3.org/2000/svg"><path d="M8 0a8 8 0 016.32 12.905l6.337 6.338a1 1 0 11-1.414 1.414l-6.337-6.337A8 8 0 118 0zm0 2a6 6 0 100 12A6 6 0 008 2z" fill="#FFF" fill-rule="nonzero"/></svg><label><%- label %></label></span></div>',shareBtnPlayer:'<div class="action-button-player"><span><svg width="17" height="20" xmlns="http://www.w3.org/2000/svg"><path d="M14 0a3 3 0 11-1.724 5.455L5.877 9.148a3 3 0 01-.065 1.9l6.29 3.63a3 3 0 11-1.038 1.71l-6.564-3.79a3 3 0 11.192-5.077l6.42-3.705A3.002 3.002 0 0114 0z" fill="#FFF" fill-rule="evenodd"/></svg><label><%- label %></label></span></div>',tocBtnPlayer:'<span><svg width="20" height="20" xmlns="http://www.w3.org/2000/svg"><path d="M1 14a1 1 0 011 1v4a1 1 0 01-2 0v-4a1 1 0 011-1zm18 0a1 1 0 011 1v4a1 1 0 01-1 1H5a1 1 0 01-1-1v-4a1 1 0 011-1h14zm-1 2H6v2h12v-2zM1 7a1 1 0 011 1v4a1 1 0 01-2 0V8a1 1 0 011-1zm18 0a1 1 0 011 1v4a1 1 0 01-1 1H5a1 1 0 01-1-1V8a1 1 0 011-1h14zm-1 2H6v2h12V9zM1 0a1 1 0 011 1v4a1 1 0 11-2 0V1a1 1 0 011-1zm18 0a1 1 0 011 1v4a1 1 0 01-1 1H5a1 1 0 01-1-1V1a1 1 0 011-1h14zm-1 1.999H6V4h12V1.999z" fill="#FFF" fill-rule="evenodd"/></svg><label><%- label %></label></span>',pageNumber:"<span><%- currentPage %>  / <%- totalPages %></span>"},ZoomBar=Backbone.View.extend({events:{"mousedown .zoom-slider-btn":"onZoomDragStart","mousedown .zoom-slider":"onSliderClick","click .zoom-min":"handleClickMinus","click .zoom-plus":"handleClickPlus"},template:_.template(MenuTemplates.zoomPlayer),className:"zoomBar",initialize:function(){this.isDragging=!1,this.zoomButtonTolerance=7,this.zoomSliderTolerance=0,this.zoomStep=10,this.isMobile=FSUtils.isMobileDevice(),this.zoomValues=FSUtils.generateZoomValues(0,this.model.get("maxZoomValue"),ZoomBar.CONTROLLED_ZOOM_AMOUNT),0===this.model.get("maxZoomValue")&&this.model.set("notNeeded",!0),Backbone.Mediator.sub(WidgetEvent.ZOOM_CHANGED,this.handleZoomChanged,this),Backbone.Mediator.sub(WidgetEvent.MAX_ZOOM_CHANGED,this.updateMaxZoom,this),Backbone.Mediator.sub(WidgetEvent.ENTER_FULLSCREEN,this.resetZoom,this),this.listenTo(FSWidgetModel.gi().widgetState,"change:displayState",this.handleDisplayModeChange),this.listenTo(FSWidgetModel.gi().widgetState,"change:displayType",this.handleDisplayModeChange),this.listenTo(this.model,"change:zoomValue",this.handleModelZoomChanged),this.listenTo(this.model,"change:maxZoomValue",this.handleModelZoomChanged)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.$el.on("mousedown mouseup",(function(e){return!e.isDefaultPrevented()&&(Backbone.Mediator.pub(e.type,e),!0)})),this.zoomSliderBar=this.$el.find(".zoom-slider"),this.zoomSliderBtn=this.$el.find(".zoom-slider-btn"),this.zoomSliderProgress=this.$el.find(".zoom-slider-progress"),(this.model.get("notNeeded")||this.isMobile)&&this.$el.hide(),this},onSliderClick:function(e){return 1!==e.which||(this.positionZoomBtn(e),this.onZoomDragStart(e)),!0},handleClickMinus:function(e){if(1!==e.which)return!0;Backbone.Mediator.pub(WidgetEvent.CHANGE_ZOOM,{value:this.model.get("zoomValue")-FSWidgetModel.gi().get("maxZoomValue")/this.zoomStep})},handleClickPlus:function(e){if(1!==e.which)return!0;Backbone.Mediator.pub(WidgetEvent.CHANGE_ZOOM,{value:this.model.get("zoomValue")+FSWidgetModel.gi().get("maxZoomValue")/this.zoomStep})},onZoomDragStart:function(e){return 1!==e.which||(this.isDragging=!0,Backbone.Mediator.sub("mousemove",this.onZoomButtonDrag,this),Backbone.Mediator.sub("dragstop",this.onZoomDragStop,this),Backbone.Mediator.sub("mouseup",this.onZoomDragStop,this),Backbone.Mediator.pub(WidgetEvent.ZOOM_START)),!0},onZoomDragStop:function(){var e=this.getZoomValue();this.isDragging=!1,this.zoomSliderBtn.blur(),Backbone.Mediator.pub(WidgetEvent.CHANGE_ZOOM,{value:e}),Backbone.Mediator.pub(WidgetEvent.ZOOM_END),Backbone.Mediator.unsubscribe("mousemove",this.onZoomButtonDrag,this),Backbone.Mediator.unsubscribe("dragstop",this.onZoomDragStop,this),Backbone.Mediator.unsubscribe("mouseup",this.onZoomDragStop,this)},onZoomButtonDrag:function(e){this.isDragging?this.positionZoomBtn(e):this.onZoomDragStop()},positionZoomBtn:function(e){var t=this.zoomSliderBar.offset().left+this.zoomSliderTolerance,i=e.pageX-this.zoomButtonTolerance,o=Math.floor(Math.max(0,Math.min(i-t,this.getSliderWidth())))/this.getSliderWidth(),n=this.model.get("defaultZoomValue")+this.model.get("maxZoomValue")*o,s=isNaN(n)?FSWidgetModel.gi().widgetState.get("maxZoomVal"):FSUtils.getClosestZoomValue(this.zoomValues,n);FSWidgetModel.gi().get("currentZoom")!==s&&Backbone.Mediator.pub(WidgetEvent.CHANGE_ZOOM,{value:s})},setSliderButtonPosition:function(e){this.zoomSliderBtn.css("left",e+this.zoomSliderTolerance+"px"),this.zoomSliderProgress.css("width",e+this.zoomSliderTolerance+"px")},getSliderButtonPosition:function(){return parseInt(this.zoomSliderBtn.css("left"),10)-this.zoomSliderTolerance},getSliderWidth:function(){return this.model.get("notNeeded")?ZoomBar.DEFAULT_SLIDER_WIDTH:this.zoomSliderBar.width()-2*this.zoomButtonTolerance},getZoomValue:function(){var e=this.getSliderButtonPosition()/this.getSliderWidth(),t=this.model.get("defaultZoomValue")+this.model.get("maxZoomValue")*e;return t=isNaN(t)?FSWidgetModel.gi().widgetState.get("maxZoomVal"):t},resetZoom:function(){this.model.set("zoomValue",this.model.get("defaultZoomValue"))},handleDisplayModeChange:function(){FSWidgetModel.gi().widgetState.get("displayState")!==DisplayState.NORMAL&&FSWidgetModel.gi().widgetState.get("displayType")!==DisplayType.SMALL||this.resetZoom()},handleZoomChanged:function(e){var t=Math.min(e.value,this.model.get("maxZoomValue")),i=Math.max(t,this.model.get("defaultZoomValue"));this.model.set("zoomValue",i)},handleModelZoomChanged:function(){var e=this.model.get("zoomValue")/this.model.get("maxZoomValue"),t=this.getSliderWidth()*e;this.setSliderButtonPosition(t)},updateMaxZoom:function(){var e=FSWidgetModel.gi().get("maxZoomValue");this.model.set("maxZoomValue",e),this.model.set("notNeeded",0===e),this.zoomValues=FSUtils.generateZoomValues(0,e,ZoomBar.CONTROLLED_ZOOM_AMOUNT)},remove:function(){this.$el.off(),this.off(),Backbone.Mediator.unsubscribe("mousemove",this.onZoomButtonDrag,this),Backbone.Mediator.unsubscribe("dragstop",this.onZoomDragStop,this),Backbone.Mediator.unsubscribe("mouseup",this.onZoomDragStop,this),Backbone.Mediator.unsubscribe(WidgetEvent.ZOOM_CHANGED,this.handleZoomChanged,this),Backbone.Mediator.unsubscribe(WidgetEvent.MAX_ZOOM_CHANGED,this.updateMaxZoom,this),Backbone.View.prototype.remove.apply(this,arguments)}});ZoomBar.DEFAULT_SLIDER_WIDTH=90,ZoomBar.CONTROLLED_ZOOM_AMOUNT=24;var PageNumber=Backbone.View.extend({events:{},template:_.template(MenuTemplates.pageNumber),className:"pageNumber",render:function(){return this.$el.html(this.template(this.model.attributes)),this},initialize:function(){this.isMobile=FSUtils.isMobileDevice(),this.isArabicStyle=FSWidgetModel.gi().widgetSettings.get("arabicStyle"),this.isSinglePageView=FSWidgetModel.gi().widgetSettings.get("singlePageView"),this.listenTo(FSWidgetModel.gi().widgetState,"change:currentPageIndex",this.handlePageChange),this.isMobile&&this.listenTo(FSWidgetModel.gi().widgetState,"change:rightPageIndex",this.handlePageChange)},handlePageChange:function(e){var t=e.get("currentItem").attributes.pages.length,i=e.attributes.leftPageIndex<0?0:e.attributes.leftPageIndex,o=this.isArabicStyle?t-i:i+1,n=this.isArabicStyle?o-1:o+1,s=[o];this.isMobile&&FSUtils.isPortrait()||this.isSinglePageView||o<t&&o>1&&s.push(n),this.$el.html(this.template({totalPages:t,currentPage:s.join("-")}))}}),ZoomModel=Backbone.Model.extend({defaults:{defaultZoomValue:0,zoomValue:0,maxZoomValue:1,notNeeded:!1}}),DropDownOptionModel=Backbone.Model.extend({defaults:{target:"self",type:"default"}}),ShareOptionModel=DropDownOptionModel.extend({defaults:{type:"link",link:"",label:"",target:"_blank"},initialize:function(){this.setLink()},setLink:function(){var e,t,i=FlipSnackEmbed.urls.customDomain?ShareOptions.WHITE_LABEL:ShareOptions.FLIPSNACK;if(FlipSnackEmbed.isEditor)this.set("link","#");else switch(this.get("link")||this.set("link",URLPaths.DIRECT_LINK,{silent:!0}),e=this.get("link"),this.get("type")){case"facebook":this.set("link",ShareOptions.FACEBOOK_SHARE_BASE_URL+"?u="+encodeURIComponent(e)+"&t="+encodeURIComponent(FSWidgetModel.gi().flipCollection.get("title")));break;case"twitter":this.set("link",ShareOptions.TWITTER_SHARE_BASE_URL+"?status="+encodeURIComponent(i.TWITTER_MESSAGE)+" "+encodeURIComponent(e));break;case"pinterest":t=ShareOptions.PINTEREST_SHARE_BASE_URL+"?url="+encodeURIComponent(e)+"&description="+encodeURIComponent(i.PINTEREST_MESSAGE+FSWidgetModel.gi().flipCollection.get("title"))+"&media="+FSWidgetModel.gi().getFirstPageThumb(),this.set("link",t);break;case"email":this.set("link",ShareOptions.EMAIL_SHARE_BASE_URL+"?subject="+encodeURIComponent(i.EMAIL_SUBJECT)+"&body="+encodeURIComponent(i.EMAIL_BODY)+"%0A%0A"+encodeURIComponent(e));break;default:this.set("link",e)}}}),ZoomView=Backbone.View.extend({events:{"mousedown .zoom-slider-btn":"onZoomDragStart","mousedown .zoom-slider":"onSliderClick","click .zoom-min":"handleClickMinus","click .zoom-plus":"handleClickPlus"},template:_.template(MenuTemplates.zoom),className:"drop-down-options zoomView",initialize:function(){this.isDragging=!1,this.zoomButtonTolerance=4,this.zoomSliderTolerance=0,this.zoomStep=10,this.zoomValues=FSUtils.generateZoomValues(0,this.model.get("maxZoomValue"),ZoomView.CONTROLLED_ZOOM_AMOUNT),0===this.model.get("maxZoomValue")&&this.model.set("notNeeded",!0),Backbone.Mediator.sub(WidgetEvent.OPEN_ZOOM_OPTIONS,ZoomButton.prototype.showOptionsPanel,this),Backbone.Mediator.sub(WidgetEvent.ZOOM_CHANGED,this.handleZoomChanged,this),Backbone.Mediator.sub(WidgetEvent.MAX_ZOOM_CHANGED,this.updateMaxZoom,this),Backbone.Mediator.sub(WidgetEvent.ENTER_FULLSCREEN,this.resetZoom,this),this.listenTo(FSWidgetModel.gi().widgetState,"change:displayState",this.handleDisplayModeChange),this.listenTo(FSWidgetModel.gi().widgetState,"change:displayType",this.handleDisplayModeChange),this.listenTo(this.model,"change:zoomValue",this.handleModelZoomChanged),this.listenTo(this.model,"change:maxZoomValue",this.handleModelZoomChanged)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.$el.on("mousedown mouseup",(function(e){return!e.isDefaultPrevented()&&(Backbone.Mediator.pub(e.type,e),!0)})),this.zoomSliderBar=this.$el.find(".zoom-slider"),this.zoomSliderBtn=this.$el.find(".zoom-slider-btn"),this.model.get("notNeeded")&&this.$el.hide(),this},onSliderClick:function(e){return 1!==e.which||(this.positionZoomBtn(e),this.onZoomDragStart(e)),!0},handleClickMinus:function(e){if(1!==e.which)return!0;Backbone.Mediator.pub(WidgetEvent.CHANGE_ZOOM,{value:this.model.get("zoomValue")-FSWidgetModel.gi().get("maxZoomValue")/this.zoomStep})},handleClickPlus:function(e){if(1!==e.which)return!0;Backbone.Mediator.pub(WidgetEvent.CHANGE_ZOOM,{value:this.model.get("zoomValue")+FSWidgetModel.gi().get("maxZoomValue")/this.zoomStep})},onZoomDragStart:function(e){return 1!==e.which||(this.isDragging=!0,Backbone.Mediator.sub("mousemove",this.onZoomButtonDrag,this),Backbone.Mediator.sub("dragstop",this.onZoomDragStop,this),Backbone.Mediator.sub("mouseup",this.onZoomDragStop,this),Backbone.Mediator.pub(WidgetEvent.ZOOM_START)),!0},onZoomDragStop:function(){var e=this.getZoomValue();this.isDragging=!1,this.zoomSliderBtn.blur(),Backbone.Mediator.pub(WidgetEvent.CHANGE_ZOOM,{value:e}),Backbone.Mediator.pub(WidgetEvent.ZOOM_END),Backbone.Mediator.unsubscribe("mousemove",this.onZoomButtonDrag,this),Backbone.Mediator.unsubscribe("dragstop",this.onZoomDragStop,this),Backbone.Mediator.unsubscribe("mouseup",this.onZoomDragStop,this)},onZoomButtonDrag:function(e){this.isDragging?this.positionZoomBtn(e):this.onZoomDragStop()},positionZoomBtn:function(e){var t=this.zoomSliderBar.offset().left+this.zoomSliderTolerance,i=e.pageX-this.zoomButtonTolerance,o=Math.floor(Math.max(0,Math.min(i-t,this.getSliderWidth())))/this.getSliderWidth(),n=this.model.get("defaultZoomValue")+this.model.get("maxZoomValue")*o,s=isNaN(n)?FSWidgetModel.gi().widgetState.get("maxZoomVal"):FSUtils.getClosestZoomValue(this.zoomValues,n);FSWidgetModel.gi().get("currentZoom")!==s&&Backbone.Mediator.pub(WidgetEvent.CHANGE_ZOOM,{value:s})},setSliderButtonPosition:function(e){this.zoomSliderBtn.css("left",e+this.zoomSliderTolerance+"px")},getSliderButtonPosition:function(){return parseInt(this.zoomSliderBtn.css("left"),10)-this.zoomSliderTolerance},getSliderWidth:function(){return this.model.get("notNeeded")?ZoomView.DEFAULT_SLIDER_WIDTH:this.zoomSliderBar.width()-2*this.zoomButtonTolerance},getZoomValue:function(){var e=this.getSliderButtonPosition()/this.getSliderWidth(),t=this.model.get("defaultZoomValue")+this.model.get("maxZoomValue")*e;return t=isNaN(t)?FSWidgetModel.gi().widgetState.get("maxZoomVal"):t},resetZoom:function(){this.model.set("zoomValue",this.model.get("defaultZoomValue"))},handleDisplayModeChange:function(){FSWidgetModel.gi().widgetState.get("displayState")!==DisplayState.NORMAL&&FSWidgetModel.gi().widgetState.get("displayType")!==DisplayType.SMALL||this.resetZoom()},handleZoomChanged:function(e){var t=Math.min(e.value,this.model.get("maxZoomValue")),i=Math.max(t,this.model.get("defaultZoomValue"));this.model.set("zoomValue",i)},handleModelZoomChanged:function(){var e=this.model.get("zoomValue")/this.model.get("maxZoomValue"),t=this.getSliderWidth()*e;this.setSliderButtonPosition(t)},updateMaxZoom:function(){var e=FSWidgetModel.gi().get("maxZoomValue");this.model.set("maxZoomValue",e),this.model.set("notNeeded",0===e),this.zoomValues=FSUtils.generateZoomValues(0,e,ZoomView.CONTROLLED_ZOOM_AMOUNT)},onPanelClick:function(e){e.stopImmediatePropagation()},closePanel:function(e){MenuOptionsPanel.prototype.closePanel.apply(this,arguments),Backbone.Mediator.pub(WidgetEvent.CLOSE_ZOOM_OPTIONS)},remove:function(){MenuOptionsPanel.prototype.closePanel.apply(this,arguments),this.$el.off(),this.off(),Backbone.Mediator.unsubscribe("mousemove",this.onZoomButtonDrag,this),Backbone.Mediator.unsubscribe("dragstop",this.onZoomDragStop,this),Backbone.Mediator.unsubscribe("mouseup",this.onZoomDragStop,this),Backbone.Mediator.unsubscribe(WidgetEvent.ZOOM_CHANGED,this.handleZoomChanged,this),Backbone.Mediator.unsubscribe(WidgetEvent.MAX_ZOOM_CHANGED,this.updateMaxZoom,this),Backbone.Mediator.unsubscribe(WidgetEvent.OPEN_ZOOM_OPTIONS,ZoomButton.prototype.showOptionsPanel,this),Backbone.View.prototype.remove.apply(this,arguments)}});ZoomView.DEFAULT_SLIDER_WIDTH=70,ZoomView.CONTROLLED_ZOOM_AMOUNT=24;var ClearSearch=Backbone.View.extend({events:{click:"onClick"},template:_.template(MenuTemplates.buttonX),className:"clear-search",render:function(){return this.$el.html(this.template(this.model.attributes)),this},onClick:function(){Backbone.Mediator.pub(WidgetEvent.CLEAR_SEARCH)}}),SearchInputView=Backbone.View.extend({events:{"keydown input":"onKeyDown","focus input":"onFocus","blur input":"onBlur","click .clear-results":"clearSearch",search:"clearSearch"},template:_.template(MenuTemplates.searchInput),className:"search-input",initialize:function(){Backbone.Mediator.sub(WidgetEvent.CHANGE_LANGUAGE,this.setTextDirection,this),this.isPlayerSkin=FSWidgetModel.gi().widgetSettings.get("skinType")===WidgetSkinType.PLAYER},render:function(){return this.$el.html(this.template({hideClearButton:this.isPlayerSkin?"":"hide-clear-button"})),this.$input=this.$el.find("input"),this.setTextDirection(),this},onKeyDown:function(e){13===e.which?this.setSearchText():8===e.which&&this.$input.val().trim().length<=1&&Backbone.Mediator.pub(WidgetEvent.CLEAR_SEARCH),Backbone.Mediator.pub(WidgetEvent.STOP_AUTOHIDE),e.stopPropagation()},onFocus:function(){Backbone.Mediator.pub(WidgetEvent.STOP_AUTOHIDE)},onBlur:function(){Backbone.Mediator.pub(WidgetEvent.START_AUTOHIDE)},clearSearch:function(){this.$input.val().trim().length<1&&(this.$input.val("").focus(),this.$el.find(".results-nr").text(""),this.model.set("searchText",""),Backbone.Mediator.pub(WidgetEvent.CLEAR_SEARCH))},setSearchText:function(){var e=this.$input.val().trim();""!==e&&e.length>=3&&this.model.set("searchText",e)},setTextDirection:function(){FSWidgetModel.gi().get("textDirection")===TextDirection.RIGHT_TO_LEFT?this.$input.addClass("reverse-text"):this.$input.removeClass("reverse-text")},remove:function(){Backbone.Mediator.unsubscribe(WidgetEvent.CHANGE_LANGUAGE,this.setTextDirection,this),Backbone.View.prototype.remove.apply(this,arguments)}}),MenuOptionsPanel=Backbone.View.extend({template:_.template(MenuTemplates.menuOptionsContent),className:"drop-down-options",showOptionsPanel:function(e){var t=this;null!==MenuOptionsPanel.OPEN_DROPDOWN&&MenuOptionsPanel.OPEN_DROPDOWN.closePanel(),t&&t.model.get("tocData")&&!t.model.get("visible")&&t.model.set("visible",!0),MenuOptionsPanel.OPEN_DROPDOWN=this,setTimeout((function(){$(document).bind("click",t.closePanel)}),100)},closePanel:function(e){MenuOptionsPanel.OPEN_DROPDOWN&&MenuOptionsPanel.OPEN_DROPDOWN.model.get("tocData")&&MenuOptionsPanel.OPEN_DROPDOWN.model.get("visible")&&(MenuOptionsPanel.OPEN_DROPDOWN.model.set("visible",!1),Backbone.Mediator.pub(WidgetEvent.CLOSE_TOC)),MenuOptionsPanel.OPEN_DROPDOWN=null,$(document).unbind("click",this.closePanel),$("#flipView").unbind("click",this.closePanel)},remove:function(){$(document).unbind("click",self.closePanel),Backbone.View.prototype.remove.apply(this,arguments)}});MenuOptionsPanel.OPEN_DROPDOWN=null;var ShareOptions=MenuOptionsPanel.extend({id:"share-options",events:{click:"onPanelClick"},initialize:function(){Backbone.Mediator.sub(WidgetEvent.OPEN_SHARE_OPTIONS,this.showOptionsPanel,this),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:shareFaceBook",this.showHideOption),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:shareTwitter",this.showHideOption),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:sharePinterest",this.showHideOption),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:shareEmail",this.showHideOption),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:shareLink",this.showHideOption)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.model.get("shareFaceBook")&&this.initOptions("facebook",MenuTemplates.shareIcons.facebook),this.model.get("shareTwitter")&&this.initOptions("twitter",MenuTemplates.shareIcons.twitter),this.model.get("sharePinterest")&&this.initOptions("pinterest",MenuTemplates.shareIcons.pinterest),this.model.get("shareEmail")&&this.initOptions("email",MenuTemplates.shareIcons.email),this.model.get("shareLink")&&this.initOptions("link",null),this},initOptions:function(e,t){var i=FSUtils.getDirectlink();this.dropDownView="link"===e?new ShareLinkView({model:new Backbone.Model({link:i,confirmMessage:"Copied"})}):new DropDownOptionView({model:new ShareOptionModel({type:e,icon:t||i,link:i,parent:this,action:"share"})}),this.$el.find(".content").append(this.dropDownView.render().el)},showHideOption:function(e){var t;for(t in e.changed)e.changed.hasOwnProperty(t)&&this.model.set(t,e.changed[t]);this.$el.find(".content").empty(),this.render()},onPanelClick:function(e){e.stopImmediatePropagation()},closePanel:function(){MenuOptionsPanel.prototype.closePanel.apply(this,arguments),Backbone.Mediator.pub(WidgetEvent.CLOSE_SHARE_OPTIONS)},remove:function(){MenuOptionsPanel.prototype.closePanel.apply(this,arguments),this.dropDownView&&(this.dropDownView.remove(),this.dropDownView=null),Backbone.Mediator.unsubscribe(WidgetEvent.OPEN_SHARE_OPTIONS,this.showOptionsPanel,this),Backbone.View.prototype.remove.apply(this,arguments)}});ShareOptions.FACEBOOK_SHARE_BASE_URL="http://www.facebook.com/sharer.php",ShareOptions.TWITTER_SHARE_BASE_URL="http://twitter.com/intent/tweet",ShareOptions.PINTEREST_SHARE_BASE_URL="//www.pinterest.com/pin/create/button/",ShareOptions.EMAIL_SHARE_BASE_URL="mailto:",ShareOptions.FLIPSNACK={TWITTER_MESSAGE:"Check out this flipbook!",PINTEREST_MESSAGE:"Flipsnack | ",EMAIL_SUBJECT:"I found this awesome publication on www.flipsnack.com",EMAIL_BODY:"Take a look: "},ShareOptions.WHITE_LABEL={TWITTER_MESSAGE:"Check out this digital edition!",PINTEREST_MESSAGE:"Digital Edition | ",EMAIL_SUBJECT:"Check out this awesome publication I found",EMAIL_BODY:"Take a look: "};var TableOfContent=Backbone.View.extend({id:"table-of-contents",template:_.template(MenuTemplates.tableOfContent.content),events:{click:"onPanelClick"},initialize:function(){this.listenTo(this.model,"change:visible",this.toggleOpen),this.listenTo(FSWidgetModel.gi(),"change:height",this.setHeight),Backbone.Mediator.sub(WidgetEvent.OPEN_TOC,this.toggleOpen,this),Backbone.Mediator.sub(WidgetEvent.CLOSE_TOC,this.toggleOpen,this),this.tocHeader=new TocHeader({model:new Backbone.Model}),this.tocBody=new TocBody({model:new Backbone.Model({data:this.model.get("tocData")})})},render:function(){this.$el.html(this.template(this.model.attributes));var e=FSUtils.isPlayerSkin()?FSWidgetModel.gi().get("height")-LayoutManager.FLIPVIEW_BOTTOM_MARGIN-30:FSWidgetModel.gi().get("height");return this.$el.find(".content").css("height",e).append(this.tocHeader.render().el),this.model.get("tocData")&&this.model.get("tocData").length&&this.$el.find(".content").append(this.tocBody.render().el),this.toggleOpen(),this},onPanelClick:function(e){e.stopImmediatePropagation()},toggleOpen:function(e){e&&!this.$el.hasClass("open")?this.$el.addClass("open"):!e&&this.$el.hasClass("open")&&this.$el.removeClass("open")},setHeight:function(){var e=FSUtils.isPlayerSkin()?FSWidgetModel.gi().get("height")-LayoutManager.FLIPVIEW_BOTTOM_MARGIN-30:FSWidgetModel.gi().get("height");this.$el.find(".content").css("height",e)},remove:function(){MenuOptionsPanel.prototype.closePanel.apply(this,arguments),this.tocHeader&&(this.tocHeader.remove(),this.tocHeader=null),this.tocBody&&(this.tocBody.remove(),this.tocBody=null),Backbone.Mediator.unsubscribe(WidgetEvent.OPEN_TOC,this.showOptionsPanel,this),Backbone.View.prototype.remove.apply(this,arguments)}}),TocHeader=Backbone.View.extend({className:"toc-header",template:_.template(MenuTemplates.tableOfContent.header),initialize:function(){this.closeTOC=new CloseTOC({model:new Backbone.Model})},render:function(){return this.$el.html(this.template(this.model.attributes)),this.$el.find(".close").append(this.closeTOC.render().el),this},remove:function(){Backbone.View.prototype.remove.apply(this,arguments)}}),TocRow=Backbone.View.extend({events:{click:"onRowClick"},template:_.template(MenuTemplates.tableOfContent.row),className:"toc-row",initialize:function(){var e=this;this.pages=FSWidgetModel.gi().get("collectionData").tocPageLinks,this.pageCorespondent=this.model.get("originalHash")+"_"+this.model.get("page"),this.listenTo(this.model,"change:opened",this.toggleOpened),this.listenTo(this.model,"change:visible",this.showHide),this.listenTo(this.model,"change:selected",this.selectTableRow),Backbone.Mediator.sub(WidgetEvent.DESELECT_TABLE_ROW,this.deselectTableRow,this),this.arrow=new TocArrow({model:new Backbone.Model({opened:this.model.get("opened"),row:this,empty:0===this.model.get("sub").length})}),this.subnodes=this.model.get("sub").map((function(t){return new TocRow({model:new Backbone.Model({title:t.title||"Default title",level:parseInt(e.model.get("level"),10)+1,page:t.pageNumber,originalHash:t.originalHash,sub:t.sub,opened:!1,visible:!1,selected:!1})})}))},onRowClick:function(e){e.stopPropagation(),FSWidgetModel.gi().widgetState.get("currentPageIndex")===this.model.get("page")||isNaN(this.pages[this.pageCorespondent])||Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,this.pages[this.pageCorespondent]),Backbone.Mediator.pub(WidgetEvent.DESELECT_TABLE_ROW),this.model.set("selected",!0)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.subnodes.length&&this.$el.find(".title").before(this.arrow.render().el),this.$el.find(".row-header").css("padding-left",20*(this.model.get("level")-1)+"px"),this.showHide(),this.createSubnodes(this.$el.find(".subnodes")),this.toggleOpened(),this},toggleOpened:function(){this.subnodes&&this.subnodes.length&&(this.model.get("opened")&&!this.$el.hasClass("opened")?(this.$el.addClass("opened"),this.$el.children(".row-header").addClass("opened"),this.subnodes.forEach((function(e){e.model.set("visible",!0)})),this.arrow.model.set("opened",!0)):!this.model.get("opened")&&this.$el.hasClass("opened")&&(this.$el.removeClass("opened"),this.$el.children(".row-header").removeClass("opened"),this.subnodes.forEach((function(e){e.model.set("visible",!1),e.model.set("opened",!1)})),this.arrow.model.set("opened",!1)))},createSubnodes:function(e){this.subnodes&&this.subnodes.length&&this.subnodes.forEach((function(t){e.append(t.render().el)}))},showHide:function(){this.model.get("visible")?this.$el.css("display","flex"):this.$el.css("display","none")},selectTableRow:function(){this.model.get("selected")&&!this.$el.hasClass("selected")?(this.$el.addClass("selected"),this.$el.children(".row-header").addClass("selected")):!this.model.get("selected")&&this.$el.hasClass("selected")&&(this.$el.removeClass("selected"),this.$el.children(".row-header").removeClass("selected"))},deselectTableRow:function(){this.model.set("selected",!1)},remove:function(){Backbone.Mediator.unsubscribe(WidgetEvent.DESELECT_TABLE_ROW,this.deselectTableRow,this),this.off(),this.stopListening(),this.subnodes&&this.subnodes.length&&this.subnodes.forEach((function(e){e.remove()})),this.arrow&&this.arrow.remove(),Backbone.View.prototype.remove.apply(this,arguments)}}),TocBody=Backbone.View.extend({className:"toc-body",initialize:function(){var e=this.model.get("data");e&&(this.rows=e.map((function(e){return new TocRow({model:new Backbone.Model({title:e.title,level:e.level,page:e.pageNumber,originalHash:e.originalHash,sub:e.sub,opened:!1,visible:!0,selected:!0})})})))},render:function(){var e=this;return this.rows.forEach((function(t){e.$el.append(t.render().el)})),this.$el.jScrollPane({mouseWheelSpeed:40,hideFocus:!0,autoReinitialise:!0,animateScroll:!0,contentWidth:"0px"}),this},remove:function(){this.rows&&this.rows.length&&this.rows.forEach((function(e){e.remove()})),Backbone.View.prototype.remove.apply(this,arguments)}}),TocArrow=Backbone.View.extend({className:"toc-arrow",events:{click:"onTocArrowClick"},template:_.template(MenuTemplates.tableOfContent.arrow),onTocArrowClick:function(e){e.stopPropagation(),this.model.get("row").model.set("opened",!this.model.get("opened"))},render:function(){return this.$el.html(this.template(this.model.attributes)),this.model.get("empty")&&this.$el.empty(),this},remove:function(){this.off(),this.stopListening(),Backbone.View.prototype.remove.apply(this,arguments)}}),CloseTOC=Backbone.View.extend({events:{click:"onClick"},template:_.template(MenuTemplates.buttonX),className:"clear-toc",render:function(){return this.$el.html(this.template(this.model.attributes)),this},onClick:function(){Backbone.Mediator.pub(WidgetEvent.CLOSE_TOC)}}),SearchResultView=Backbone.View.extend({events:{click:"jumpToPage"},template:_.template(MenuTemplates.searchResult),className:"search-result",initialize:function(){this.setTitle()},render:function(){return this.$el.html(this.template(this.model.attributes)),this},setTitle:function(){this.model.set("title",FSWidgetModel.gi().get("labels").l_pageSearch.replace("#",this.model.get("pageIndex")+1))},jumpToPage:function(){FSWidgetModel.gi().widgetState.get("currentPageIndex")!==this.model.get("pageIndex")&&Backbone.Mediator.pub(WidgetEvent.CHANGE_PAGE,this.model.get("pageIndex"))}}),SearchResults=Backbone.View.extend({template:_.template(MenuTemplates.searchResults),className:"search-results hidden",initialize:function(){this.beforeFoundChars=30,this.afterFoundChars=100,this.searchtext="",this.textResults=[],this.elementTextResults=[],this.foundData=[],this.searchResultsViews=[],this.isPlayerSkin=FSWidgetModel.gi().widgetSettings.get("skinType")===WidgetSkinType.PLAYER,this.setResultCountText()},render:function(){return this.$el.html(this.template(this.model.attributes)),this},setResultCountText:function(){if(this.isPlayerSkin){var e=this.$el.parent().find(".search-input .results-nr");this.model.set("resultCountText",""),e.text(FSWidgetModel.gi().get("labels").l_playerResults.replace("#",this.foundData.length))}else this.model.set("resultCountText",FSWidgetModel.gi().get("labels").l_resultsFound.replace("#",this.foundData.length))},showResults:function(e){""!==e&&(this.searchtext=e,this.setResults(),this.populateSearchList())},populateSearchList:function(){var e=this;this.setResultCountText(),this.render(),this.clearSearchResultViews(),this.foundData.length&&($.each(this.foundData,(function(t,i){var o=new SearchResultView({model:new Backbone.Model(i)});e.searchResultsViews.push(o),e.$el.find(".search-result-list").append(o.render().el)})),e.$el.find(".search-result-list").jScrollPane({mouseWheelSpeed:40,hideFocus:!0,autoReinitialise:!0,animateScroll:!0}))},clearSearchResultViews:function(){for(;this.searchResultsViews.length;)this.searchResultsViews.pop().remove(),null},getTextResults:function(e){FSWidgetModel.gi().widgetState.get("currentItem").get("pages");var t=new RegExp(this.searchtext,"gi"),i=[];return $.each(window.textJs,(function(e,o){for(var n=[],s=t.exec(o);null!=s;)n.push(s.index),s=t.exec(o);n.length&&i.push({type:"textJs",pdfidx:parseInt(e,10),modelIndex:parseInt(e,10),positions:n})})),i},getElementTextResults:function(){var e=FSWidgetModel.gi().widgetState.get("currentItem").get("pages"),t=new RegExp(this.searchtext,"gi"),i=[];return $.each(e.models,(function(e,o){o.get("customElements")&&$.each(o.get("customElements"),(function(o,n){var s,a=[],l="",h=!1;if(n.type===ElementType.TEXT&&void 0!==n.text&&""!==n.text.toString().trim()||n.type===ElementType.TEXT_BOX&&n.nodes&&n.nodes.length>0){for(n.type===ElementType.TEXT?l=n.text:($.each(n.nodes,(function(e,t){l+=t.text.toString()})),h=!0),s=t.exec(l);null!=s;)a.push(s.index),s=t.exec(l);a.length&&i.push({type:"customElement",elementIndex:o,modelIndex:e,positions:a,textBox:h})}}))})),i},setResults:function(){window.textJs&&(this.foundData=[],this.textResults=this.getTextResults(),this.elementTextResults=this.getElementTextResults(),this.formatFoundData())},formatFoundData:function(){var e=this,t=this.textResults.concat(this.elementTextResults),i=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").models;t.length&&$.each(t,(function(t,o){var n="";"textJs"===o.type?n=window.textJs[o.pdfidx]:o.textBox?(n="",$.each(i[o.modelIndex].get("customElements")[o.elementIndex].nodes,(function(e,t){n+=t.text.toString()}))):n=i[o.modelIndex].get("customElements")[o.elementIndex].text,$.each(o.positions,(function(t,i){var s=i<e.beforeFoundChars?"":n.substr(i-e.beforeFoundChars,e.beforeFoundChars),a=i+e.searchtext.length,l=a+e.afterFoundChars>n.length?n.length-i:e.afterFoundChars,h=n.substr(a,l),d="<b>"+n.substr(i,e.searchtext.length)+"</b>";e.foundData.push({type:o.type,pageIndex:o.modelIndex,html:s+d+h})}))})),e.foundData.sort(e.sortByPages)},sortByPages:function(e,t){return e.pageIndex>t.pageIndex?1:e.pageIndex<t.pageIndex?-1:0},remove:function(){this.clearSearchResultViews(),this.$el.empty(),Backbone.View.prototype.remove.apply(this,arguments)}}),SearchOptions=MenuOptionsPanel.extend({events:{click:"onPanelClick"},id:"search-options",initialize:function(){this.pdfItems=[],this.pdfTextsLoaded=[],this.onCurrentItemChanged(),this.searchInput=new SearchInputView({model:new Backbone.Model}),this.searchResults=new SearchResults({model:new Backbone.Model}),this.listenTo(FSWidgetModel.gi().widgetState,"change:currentItem",this.onCurrentItemChanged),this.listenTo(this.searchInput.model,"change:searchText",this.onSearchTextChanged),Backbone.Mediator.sub(WidgetEvent.OPEN_SEARCH_OPTIONS,this.showOptionsPanel,this),Backbone.Mediator.sub(WidgetEvent.CLEAR_SEARCH,this.hideSearchResults,this)},showOptionsPanel:function(){var e=this.searchInput.$el.find("input"),t=this.searchInput.model.get("searchText")||"";e.focus(),MenuOptionsPanel.prototype.showOptionsPanel.apply(this,arguments),""!==t&&(this.searchInput.model.set("searchText","",{silent:!0}),this.searchInput.model.set("searchText",t))},render:function(){return this.$el.html(this.template(this.model.attributes)),this.$el.find(".content").append(this.searchInput.render().el).append(this.searchResults.render().el),this},onCurrentItemChanged:function(){var e,t=FSWidgetModel.gi().widgetState.get("currentItem"),i=this;window.textJs=null,delete window.textJs,Backbone.Mediator.pub(WidgetEvent.CLEAR_SEARCH),FSWidgetModel.gi().widgetSettings.get("mergePdfs")?(this.setPdfItems(),this.pdfItems.length&&!FSWidgetModel.gi().widgetSettings.get("exportVideo")?this.loadAllTexts():this.setTextJs()):"pdf"!==t.get("extension")||t.get("notext")||"failed"===FSWidgetModel.gi().widgetState.get("currentItem").get("textLoadStatus")||FSWidgetModel.gi().widgetSettings.get("exportVideo")||(e=FlipSnackEmbed.urls.items+t.get("hash")+FlipSnackEmbed.urls.textJS,FSWidgetModel.gi().widgetState.get("currentItem").set("textLoadStatus","loading"),void 0===window["text_"+t.get("hash")]&&(window["text_"+t.get("hash")]=function(e){window.textJs=e}),FSUtils.loadScript(e,(function(){i.textJsLoaded()}),(function(){i.textJSFail()})))},setPdfItems:function(){var e=FSWidgetModel.gi().get("collectionData").collection,t=this,i=null;this.pdfItems=[],$.each(e,(function(e,o){"pdf"===o.extension&&(i=o.pageData,t.pdfItems.push(o),$.each(i,(function(e,i){"pdf"===i.extension&&i.originalHash&&!t.pdfItems.some((function(e){return e.source===i.originalHash}))&&t.pdfItems.push({source:i.originalHash})})),i=null)}))},setTextJs:function(){var e,t=FSWidgetModel.gi().widgetState.get("currentItem").get("pages"),i=[];for(e=0;e<this.pdfTextsLoaded.length;e++)i[this.pdfTextsLoaded[e].hash]=this.pdfTextsLoaded[e].textData;window.textJs={},$.each(t.models,(function(e,t){var o=i[t.get("originalHash")]||i[t.get("itemHash")]||null,n=t.get("pdfidx");o&&o[n]&&(t.get("type")===PageType.UPLOADED_PAGE||t.get("type")===PageType.MOVED_PAGE&&t.get("extension")&&"pdf"===t.get("extension"))&&(window.textJs[e]=$("<textarea />").html(o[n]).text())}))},loadAllTexts:function(){var e,t,i=this;this.pdfItems.length?(e=this.pdfItems.shift(),t=FlipSnackEmbed.urls.items+e.source+FlipSnackEmbed.urls.textJS,window["text_"+e.source]=function(t){i.pdfTextsLoaded.push({hash:e.source,textData:t})},FSUtils.loadScript(t,(function(){i.loadAllTexts()}),(function(){i.loadAllTexts()}))):this.pdfTextsLoaded.length&&(this.setTextJs(),Backbone.Mediator.pub(WidgetEvent.SEARCH_TEXTS_LOADED))},textJsLoaded:function(){FSWidgetModel.gi().widgetState.get("currentItem").set("textLoadStatus","success"),Backbone.Mediator.pub(WidgetEvent.SEARCH_TEXTS_LOADED)},textJSFail:function(e,t,i){delete window["text_"+FSWidgetModel.gi().widgetState.get("currentItem").get("hash")],FSWidgetModel.gi().widgetState.get("currentItem").set("textLoadStatus","failed")},closePanel:function(){MenuOptionsPanel.prototype.closePanel.apply(this,arguments),Backbone.Mediator.pub(WidgetEvent.CLOSE_SEARCH_OPTIONS)},onPanelClick:function(e){e.stopImmediatePropagation()},onSearchTextChanged:function(e){this.showSearchResults(),this.searchResults.showResults(e.get("searchText"))},showSearchResults:function(){this.searchResults.$el.removeClass("hidden")},hideSearchResults:function(){this.searchResults.$el.addClass("hidden")},remove:function(){this.searchInput.remove(),this.searchInput=null,this.searchResults.remove(),this.searchResults=null,Backbone.Mediator.unsubscribe(WidgetEvent.OPEN_SEARCH_OPTIONS,this.showOptionsPanel,this),Backbone.Mediator.unsubscribe(WidgetEvent.CLEAR_SEARCH,this.hideSearchResults,this),Backbone.Mediator.unsubscribe(WidgetEvent.RESIZE,this.closePanel,this),Backbone.View.prototype.remove.apply(this,arguments)}});SearchOptions.TEXT_JS_LOAD_LIMIT=5;var OptionsButtonView=Backbone.View.extend({className:"menu-btn",events:{click:"onClick"},initialize:function(){Backbone.Mediator.sub(WidgetEvent.CHANGE_LANGUAGE,this.setTextDirection,this),void 0!==this.initializeAppend&&this.initializeAppend()},render:function(){return this.$el.html(this.template(this.model.attributes)),this.$label=this.$el.find("label"),this.setTextDirection(),this},onClick:function(e){this.model.get("open")?this.model.get("optionsPanel").closePanel():this.openOptions(),e.stopImmediatePropagation()},openOptions:function(){this.model.set("open",!0),this.$el.addClass("open"),void 0!==this.openOptionsAppend&&this.openOptionsAppend()},closePanel:function(){this.model.set("open",!1),this.$el.removeClass("open")},setTextDirection:function(){FSWidgetModel.gi().get("textDirection")===TextDirection.RIGHT_TO_LEFT?this.$label.addClass("reverse-text"):this.$label.removeClass("reverse-text")},remove:function(){Backbone.Mediator.unsubscribe(WidgetEvent.CHANGE_LANGUAGE,this.setTextDirection,this),Backbone.View.prototype.remove.apply(this,arguments)}}),ShareButton=OptionsButtonView.extend({events:{click:"onClickShareButton"},template:_.template(MenuTemplates.shareButton),className:"menu-btn share-button",initializeAppend:function(){Backbone.Mediator.sub(WidgetEvent.CLOSE_SHARE_OPTIONS,this.closePanel,this)},openOptionsAppend:function(){Backbone.Mediator.pub(WidgetEvent.OPEN_SHARE_OPTIONS,this)},remove:function(){this.off(),this.stopListening(),Backbone.Mediator.unsubscribe(WidgetEvent.CLOSE_SHARE_OPTIONS,this.closePanel,this),Backbone.View.prototype.remove.apply(this,arguments)},onClickShareButton:function(e){"string"==typeof FSWidgetModel.gi().get("collectionData").trackingId&&FSWidgetModel.gi().get("collectionData").trackingId.length&&!FlipSnackEmbed.isEditor&&Tracker.gtag(FSWidgetModel.gi().get("collectionData").title,"Share"),OptionsButtonView.prototype.onClick.apply(this,arguments)}}),TocButton=OptionsButtonView.extend({events:{click:"onClickTOCButton"},template:_.template(MenuTemplates.tocButton),className:"menu-btn toc-button",initializeAppend:function(){Backbone.Mediator.sub(WidgetEvent.CLOSE_TOC,this.closePanel,this)},remove:function(){this.off(),this.stopListening(),Backbone.Mediator.unsubscribe(WidgetEvent.CLOSE_TOC,this.closePanel,this),Backbone.View.prototype.remove.apply(this,arguments)},onClickTOCButton:function(e){this.model.get("open")?(Backbone.Mediator.pub(WidgetEvent.CLOSE_TOC,!1),this.model.set("open",!1),this.$el.removeClass("open")):(Backbone.Mediator.pub(WidgetEvent.OPEN_TOC,!0),this.model.set("open",!0),this.$el.addClass("open"))}}),DownloadButton=OptionsButtonView.extend({template:_.template(MenuTemplates.downloadButton),className:"menu-btn download-button",onClick:function(){return FlipSnackEmbed.isEditor?(FSWidgetModel.gi().sendMessage(this.model),!1):(Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.DOWNLOAD_COLLECTION}),Tracker.gtag(FSWidgetModel.gi().get("collectionData").title,"Download PDF"),!0)}}),PrintButton=OptionsButtonView.extend({template:_.template(MenuTemplates.printButton),className:"menu-btn print-button",onClick:function(){return FlipSnackEmbed.isEditor?(FSWidgetModel.gi().sendMessage(this.model),!1):(Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.PRINT}),Tracker.gtag(FSWidgetModel.gi().get("collectionData").title,"Print PDF"),!0)}}),SearchButton=OptionsButtonView.extend({template:_.template(MenuTemplates.searchButton),className:"menu-btn search-button",initializeAppend:function(){this.setButtonState(),this.listenTo(FSWidgetModel.gi().widgetState,"change:currentItem",this.setButtonState),Backbone.Mediator.sub(WidgetEvent.CLOSE_SEARCH_OPTIONS,this.closePanel,this),Backbone.Mediator.sub(WidgetEvent.SEARCH_TEXTS_LOADED,this.setButtonState,this)},onChangeSearchState:function(e){"disabled"===e?this.disable():this.enable()},disable:function(){this.$el.addClass("disabled")},enable:function(){this.$el.removeClass("disabled")},openOptionsAppend:function(){Backbone.Mediator.pub(WidgetEvent.OPEN_SEARCH_OPTIONS,this)},setButtonState:function(){var e;this.disable(),FSWidgetModel.gi().widgetSettings.get("mergePdfs")?window.textJs&&this.enable():"pdf"!==(e=FSWidgetModel.gi().widgetState.get("currentItem")).get("extension")||e.get("notext")||"success"!==e.get("textLoadStatus")||this.enable()},remove:function(){this.off(),this.stopListening(),Backbone.Mediator.unsubscribe(WidgetEvent.CLOSE_SEARCH_OPTIONS,this.closePanel,this),Backbone.Mediator.unsubscribe(WidgetEvent.SEARCH_TEXTS_LOADED,this.setButtonState,this)}}),ZoomButton=OptionsButtonView.extend({events:{click:"onClickZoomButton"},template:_.template(MenuTemplates.zoomButton),className:"menu-btn zoom-button",initializeAppend:function(){Backbone.Mediator.sub(WidgetEvent.CLOSE_ZOOM_OPTIONS,this.closePanel,this),Backbone.Mediator.sub(WidgetEvent.MAX_ZOOM_CHANGED,this.updateMaxZoom,this)},openOptionsAppend:function(){Backbone.Mediator.pub(WidgetEvent.OPEN_ZOOM_OPTIONS,this)},showOptionsPanel:function(e){var t=this;null!==MenuOptionsPanel.OPEN_DROPDOWN&&MenuOptionsPanel.OPEN_DROPDOWN.closePanel(),MenuOptionsPanel.OPEN_DROPDOWN=this,setTimeout((function(){$("#flipView").bind("click",t.closePanel)}),100)},isClickOnSlider:function(e){return!!($(e).hasClass("zoom-slider-btn")||$(e).hasClass("content")||$(e).hasClass("zoom-slider")||$(e).hasClass("zoom-action"))},updateMaxZoom:function(){FSWidgetModel.gi().get("maxZoomValue")>0?this.$el.show():this.$el.hide()},onClickZoomButton:function(e){this.isClickOnSlider(e.target)||("string"==typeof FSWidgetModel.gi().get("collectionData").trackingId&&FSWidgetModel.gi().get("collectionData").trackingId.length&&!FlipSnackEmbed.isEditor&&Tracker.gtag(FSWidgetModel.gi().get("collectionData").title,"Zoom"),OptionsButtonView.prototype.onClick.apply(this,arguments))},remove:function(){this.off(),this.stopListening(),Backbone.Mediator.unsubscribe(WidgetEvent.CLOSE_ZOOM_OPTIONS,this.closePanel,this),Backbone.Mediator.unsubscribe(WidgetEvent.MAX_ZOOM_CHANGED,this.updateMaxZoom,this),$("#flipView").unbind("click",self.closePanel)}}),DropDownOptionView=Backbone.View.extend({events:{"click a":"onClick"},template:_.template(MenuTemplates.menuOptionElement),className:"option",render:function(){return this.$el.html(this.template(this.model.attributes)),this.$el.addClass(this.model.get("type")),this.model.attributes.icon&&this.$el.find("a").html(this.model.attributes.icon),this},onClick:function(){return!FlipSnackEmbed.isEditor||(FSWidgetModel.gi().sendMessage(this.model),!1)}}),ExitFullScreenButtonView=Backbone.View.extend({events:{click:"onClick"},template:_.template(MenuTemplates.buttonX),className:"menu-btn exit-full-screen-button",initialize:function(){this.listenTo(FSWidgetModel.gi().widgetState,"change:displayState",this.setButtonVisibility)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.setButtonVisibility(),this},onClick:function(){"string"==typeof FSWidgetModel.gi().get("collectionData").trackingId&&FSWidgetModel.gi().get("collectionData").trackingId.length&&!FlipSnackEmbed.isEditor&&Tracker.gtag(FSWidgetModel.gi().get("collectionData").title,"Close"),Backbone.Mediator.pub(WidgetEvent.EXIT_FULLSCREEN)},setButtonVisibility:function(){FSWidgetModel.gi().widgetState.get("displayState")!==DisplayState.NORMAL?this.$el.css("display","inline-block"):this.$el.hide()},remove:function(){Backbone.View.prototype.remove.apply(this,arguments)}}),PlayerOptionsButtonView=Backbone.View.extend({className:"player-option-btn",events:{click:"onClick"},initialize:function(){Backbone.Mediator.sub(WidgetEvent.CHANGE_LANGUAGE,this.setTextDirection,this),void 0!==this.initializeAppend&&this.initializeAppend()},render:function(){return this.$el.html(this.template(this.model.attributes)),this.$label=this.$el.find("label"),this.setTextDirection(),this},onClick:function(e){this.model.get("open")?this.model.get("optionsPanel").closePanel():this.openOptions(),e.stopImmediatePropagation()},openOptions:function(){this.model.set("open",!0),this.$el.addClass("open"),$("#bottomRight").addClass("hideLabels"),void 0!==this.openOptionsAppend&&this.openOptionsAppend()},closePanel:function(){this.model.set("open",!1),this.$el.removeClass("open"),$("#bottomRight").removeClass("hideLabels")},setTextDirection:function(){FSWidgetModel.gi().get("textDirection")===TextDirection.RIGHT_TO_LEFT?this.$label.addClass("reverse-text"):this.$label.removeClass("reverse-text")},remove:function(){Backbone.Mediator.unsubscribe(WidgetEvent.CHANGE_LANGUAGE,this.setTextDirection,this),Backbone.View.prototype.remove.apply(this,arguments)}}),PlayerFullScreenButton=PlayerOptionsButtonView.extend({events:{click:"onClickFullScreenButton"},template:_.template(MenuTemplates.enterFullscreenPlayer),templateExit:_.template(MenuTemplates.leaveFullscreenPlayer),className:"player-option-btn player-fullscreen-button",initialize:function(){this.listenTo(FSWidgetModel.gi().widgetState,"change:displayState",this.setButtonVisibility)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.setButtonVisibility(),this.$el.css("color","red"),this},onClickFullScreenButton:function(){"string"==typeof FSWidgetModel.gi().get("collectionData").trackingId&&FSWidgetModel.gi().get("collectionData").trackingId.length&&!FlipSnackEmbed.isEditor&&Tracker.gtag(FSWidgetModel.gi().get("collectionData").title,"Click to read"),Backbone.Mediator.pub(WidgetEvent.ENTER_FULLSCREEN)},setButtonVisibility:function(){FSWidgetModel.gi().widgetState.get("displayState")!==DisplayState.NORMAL?this.$el.html(this.templateExit({label:FSWidgetModel.gi().get("labels").l_exit_fs})):this.$el.html(this.template({label:FSWidgetModel.gi().get("labels").l_enter_fs}))},remove:function(){Backbone.View.prototype.remove.apply(this,arguments)}}),PlayerDownloadButton=PlayerOptionsButtonView.extend({template:_.template(MenuTemplates.downloadBtnPlayer),className:"player-option-btn player-download-button",onClick:function(){return FlipSnackEmbed.isEditor?(FSWidgetModel.gi().sendMessage(this.model),!1):(Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.DOWNLOAD_COLLECTION}),Tracker.gtag(FSWidgetModel.gi().get("collectionData").title,"Download PDF"),!0)}}),PlayerPrintButton=PlayerOptionsButtonView.extend({template:_.template(MenuTemplates.printBtnPlayer),className:"player-option-btn player-print-button",onClick:function(){return FlipSnackEmbed.isEditor?(FSWidgetModel.gi().sendMessage(this.model),!1):(Backbone.Mediator.pub(StatsEvents.REGISTER,{eid:Stats.TYPE.PRINT}),Tracker.gtag(FSWidgetModel.gi().get("collectionData").title,"Print PDF"),!0)}}),PlayerSearchButton=PlayerOptionsButtonView.extend({template:_.template(MenuTemplates.searchBtnPlayer),className:"player-option-btn player-search-button",initializeAppend:function(){this.setButtonState(),this.listenTo(FSWidgetModel.gi().widgetState,"change:currentItem",this.setButtonState),Backbone.Mediator.sub(WidgetEvent.CLOSE_SEARCH_OPTIONS,this.closePanel,this),Backbone.Mediator.sub(WidgetEvent.SEARCH_TEXTS_LOADED,this.setButtonState,this)},onChangeSearchState:function(e){"disabled"===e?this.disable():this.enable()},disable:function(){this.$el.addClass("disabled")},enable:function(){this.$el.removeClass("disabled")},openOptionsAppend:function(){Backbone.Mediator.pub(WidgetEvent.OPEN_SEARCH_OPTIONS,this)},setButtonState:function(){var e;this.disable(),FSWidgetModel.gi().widgetSettings.get("mergePdfs")?window.textJs&&this.enable():"pdf"!==(e=FSWidgetModel.gi().widgetState.get("currentItem")).get("extension")||e.get("notext")||"success"!==e.get("textLoadStatus")||this.enable()},remove:function(){this.off(),this.stopListening(),Backbone.Mediator.unsubscribe(WidgetEvent.CLOSE_SEARCH_OPTIONS,this.closePanel,this),Backbone.Mediator.unsubscribe(WidgetEvent.SEARCH_TEXTS_LOADED,this.setButtonState,this)}}),PlayerShareButton=PlayerOptionsButtonView.extend({template:_.template(MenuTemplates.shareBtnPlayer),className:"player-option-btn player-share-button",initializeAppend:function(){Backbone.Mediator.sub(WidgetEvent.CLOSE_SHARE_OPTIONS,this.closePanel,this)},openOptionsAppend:function(){Backbone.Mediator.pub(WidgetEvent.OPEN_SHARE_OPTIONS,this)},remove:function(){this.off(),this.stopListening(),Backbone.Mediator.unsubscribe(WidgetEvent.CLOSE_SHARE_OPTIONS,this.closePanel,this),Backbone.View.prototype.remove.apply(this,arguments)},onClick:function(){"string"==typeof FSWidgetModel.gi().get("collectionData").trackingId&&FSWidgetModel.gi().get("collectionData").trackingId.length&&!FlipSnackEmbed.isEditor&&Tracker.gtag(FSWidgetModel.gi().get("collectionData").title,"Share"),OptionsButtonView.prototype.onClick.apply(this,arguments)}}),PlayerTOCButton=PlayerOptionsButtonView.extend({events:{click:"onClickTOCButton"},template:_.template(MenuTemplates.tocBtnPlayer),className:"player-option-btn player-toc-button",initializeAppend:function(){Backbone.Mediator.sub(WidgetEvent.CLOSE_TOC,this.closePanel,this)},remove:function(){this.off(),this.stopListening(),Backbone.Mediator.unsubscribe(WidgetEvent.CLOSE_TOC,this.closePanel,this),Backbone.View.prototype.remove.apply(this,arguments)},onClickTOCButton:function(e){this.model.get("open")?(Backbone.Mediator.pub(WidgetEvent.CLOSE_TOC,!1),this.model.set("open",!1),this.$el.removeClass("open")):(Backbone.Mediator.pub(WidgetEvent.OPEN_TOC,!0),this.model.set("open",!0),this.$el.addClass("open"))}}),ShareLinkView=Backbone.View.extend({events:{click:"onClick"},template:_.template(MenuTemplates.menuOptionLink),className:"option link",initialize:function(){this.confirmationTimer=null},render:function(){return this.$el.html(this.template(this.model.attributes)),this.model.get("link").indexOf("your-account-name")>-1&&this.$el.css("cursor","default"),this},onClick:function(){return this.model.get("link").indexOf("your-account-name")>-1||(document.querySelector("#share-link-input").select(),document.execCommand("copy"),document.getSelection().removeAllRanges(),document.querySelector("#share-link-input").blur(),this.showCopyToClipboardConfirmation()),!1},showCopyToClipboardConfirmation:function(){clearTimeout(this.confirmationTimer),document.querySelector("#share-link-confirmation").style.opacity=1,this.confirmationTimer=setTimeout((function(){document.querySelector("#share-link-confirmation").style.opacity=0}),3e3)},remove:function(){Backbone.View.prototype.remove.apply(this,arguments)}});!function(e){window.MenuController=Backbone.View.extend({events:{mouseover:"handleMouseOver",mouseout:"handleMouseOut"},el:ComponentContainers.MENU,initialize:function(){this.inited=!1,this.zoom=null,this.exitFullscreenButton=null,this.shareButon=null,this.shareOptions=null,this.downloadButton=null,this.printButton=null,this.searchButton=null,this.searchOptions=null,this.zoomButton=null,this.watermarkBarContainer=null,this.widgetWatermarkBar=null,this.render(),this.listenTo(FSWidgetModel.gi().widgetState,"change:displayType",this.render),this.listenTo(FSWidgetModel.gi().widgetState,"change:displayState",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:enableDownload",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:enablePrint",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:sharePost",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:enableSearch",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:enableToc",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:showControls",this.render),this.listenTo(FSWidgetModel.gi(),"change:height",this.onChangeSize),this.listenTo(FSWidgetModel.gi(),"change:width",this.onChangeSize),this.listenTo(FSWidgetModel.gi(),"change:labels",this.render),Backbone.Mediator.sub(WidgetEvent.AUTOHIDE_CONTROLS,this.closeAll,this)},render:function(){var e=FSWidgetModel.gi().getShareOptions();return this.watermarkBarContainer=this.$el.parent().find("#fsw-watermark-bar"),FSWidgetModel.gi().get("shelfData")&&FSWidgetModel.gi().get("shelfData").get("shelfOpened")?this:((this.inited&&FlipSnackEmbed.isEditor||"labels"in FSWidgetModel.gi().changed)&&this.resetMenu(),FSWidgetModel.gi().get("collectionData").watermark?this.addWatermarkBar():this.watermarkBarContainer.remove(),this.inited||this.canInitMenu()?(this.inited=!0,FSWidgetModel.gi().widgetSettings.get("enableToc")&&this.addTOCButton(),this.shareButon||!e.sharePost||FSWidgetModel.gi().get("isDownload")||this.addShareButton(e),!this.downloadButton&&FSWidgetModel.gi().widgetSettings.get("enableDownload")&&FSWidgetModel.gi().get("collectionData").features[FEATURES.DOWNLOAD_PDF]&&this.addDownloadButton(),!this.printButton&&FSWidgetModel.gi().widgetSettings.get("enablePrint")&&FSWidgetModel.gi().get("collectionData").features[FEATURES.DOWNLOAD_PDF]&&this.addPrintButton(),!this.searchButton&&FSWidgetModel.gi().widgetSettings.get("enableSearch")&&this.addSearchButton(),this.zoomButton||FSUtils.isMobileDevice()||this.addZoomButton(),!this.exitFullscreenButton&&FSWidgetModel.gi().widgetSettings.get("showFullScreenButton")&&this.addExitFullScreenButton(),this.hideMenuOnMobile(),this.onChangeSize(),this):this)},resetMenu:function(){this.$el.empty(),this.zoom&&(this.zoom.remove(),this.zoom=null),this.exitFullscreenButton&&(this.exitFullscreenButton.remove(),this.exitFullscreenButton=null),this.shareButon&&(this.shareButon.remove(),this.shareButon=null),this.shareOptions&&(this.shareOptions.closePanel(),this.shareOptions.remove(),this.shareOptions=null),this.downloadButton&&(this.downloadButton.remove(),this.downloadButton=null),this.printButton&&(this.printButton.remove(),this.printButton=null),this.downloadOptions&&(this.downloadOptions.closePanel(),this.downloadOptions.remove(),this.downloadOptions=null),this.searchButton&&(this.searchButton.remove(),this.searchButton=null),this.zoomButton&&(this.zoomButton.remove(),this.zoomButton=null),this.searchOptions&&(this.searchOptions.closePanel(),this.searchOptions.remove(),this.searchOptions=null),this.tocButon&&(this.tocButon.remove(),this.tocButon=null)},onChangeSize:function(){FSWidgetModel.gi().canShowControls()?(this.inited||this.render(),this.$el.addClass("show-controls")):this.$el.removeClass("show-controls")},hideMenuOnMobile:function(){!0===FSWidgetModel.gi().get("isApp")&&this.$el.addClass("mobile-app")},addZoomButton:function(){this.zoom=new ZoomView({model:new ZoomModel({maxZoomValue:FSWidgetModel.gi().get("maxZoomValue")})}),this.zoomButton=new ZoomButton({model:new Backbone.Model({open:!1,optionsPanel:this.zoom,label:FSWidgetModel.gi().get("labels").l_zoom})}),this.$el.append(this.zoomButton.render().el),this.zoomButton.$el.append(this.zoom.render().el)},addTOCButton:function(){this.tocButon||(this.tocButon=new TocButton({model:new Backbone.Model({open:!1,label:FSWidgetModel.gi().get("labels").l_toc})}),this.$el.append(this.tocButon.render().el))},addShareButton:function(e){this.shareOptions=new ShareOptions({model:new Backbone.Model(e)}),this.shareButon=new ShareButton({model:new Backbone.Model({open:!1,optionsPanel:this.shareOptions,label:FSWidgetModel.gi().get("labels").l_share})}),this.$el.append(this.shareButon.render().el),this.shareButon.$el.append(this.shareOptions.render().el)},addDownloadButton:function(){var e=FSWidgetModel.gi().getCollectionDownloadLink();this.downloadButton=new DownloadButton({model:new Backbone.Model({action:"download",label:FSWidgetModel.gi().get("labels").l_download,link:e,target:"_blank"})}),this.$el.append(this.downloadButton.render().el)},addPrintButton:function(){var e=FSWidgetModel.gi().getCollectionDownloadLink(!0);this.printButton=new PrintButton({model:new Backbone.Model({action:"print",label:FSWidgetModel.gi().get("labels").l_print,link:e,target:"_blank"})}),this.$el.append(this.printButton.render().el)},addSearchButton:function(){this.searchOptions=new SearchOptions({model:new Backbone.Model}),this.searchButton=new SearchButton({model:new Backbone.Model({open:!1,optionsPanel:this.searchOptions,label:FSWidgetModel.gi().get("labels").l_search})}),this.$el.append(this.searchButton.render().el),this.searchButton.$el.append(this.searchOptions.render().el)},addExitFullScreenButton:function(){this.exitFullscreenButton=new ExitFullScreenButtonView({model:new Backbone.Model}),this.$el.append(this.exitFullscreenButton.render().el)},addWatermarkBar:function(){this.widgetWatermarkBar=new WidgetWatermarkBar({model:new Backbone.Model({flipsnackUrl:FlipSnackEmbed.urls.siteURL,logoSrc:FlipSnackEmbed.urls.baseUrl+"/site/images/flipsnack-logo.gz.svg"})}),this.watermarkBarContainer.append(this.widgetWatermarkBar.render().el)},canInitMenu:function(){return FSWidgetModel.gi().canShowControls()||FSWidgetModel.gi().widgetState.get("displayType")===DisplayType.LARGE},handleMouseOver:function(){Backbone.Mediator.pub(WidgetEvent.STOP_AUTOHIDE)},handleMouseOut:function(){Backbone.Mediator.pub(WidgetEvent.START_AUTOHIDE)},closeAll:function(){this.shareOptions&&this.shareOptions.closePanel(),this.downloadOptions&&this.downloadOptions.closePanel(),this.searchOptions&&this.searchOptions.closePanel(),this.zoomButton&&this.zoomButton.closePanel(),this.toc&&this.toc.closePanel()},remove:function(){Backbone.Mediator.unsubscribe(WidgetEvent.RESIZE,this.onResize,this),this.resetMenu(),this.searchOptions&&(this.searchOptions.remove(),this.searchOptions=null),this.shareOptions&&(this.shareOptions.remove(),this.shareOptions=null),this.downloadOptions&&(this.downloadOptions.remove(),this.downloadOptions=null),Backbone.View.prototype.remove.apply(this,arguments),Backbone.Mediator.unsubscribe(WidgetEvent.AUTOHIDE_CONTROLS,this.showControllers,this)}}),MenuController._instance=null,MenuController.gi=function(){return MenuController._instance||FSWidgetModel.gi().widgetSettings.get("skinType")===WidgetSkinType.PLAYER||(MenuController._instance=new MenuController),MenuController._instance},Backbone.Mediator.sub(WidgetEvent.CONFIG_DONE,(function(){FSWidgetModel.gi().widgetSettings.get("skinType")!==WidgetSkinType.PLAYER&&MenuController.gi()}),this),Backbone.Mediator.sub(WidgetEvent.DESTROY,(function(){MenuController._instance&&(MenuController.gi().remove(),MenuController._instance=null)}),this)}(),function(e){window.PlayerSkinController=Backbone.View.extend({events:{mouseover:"handleMouseOver",mouseout:"handleMouseOut"},el:ComponentContainers.BOTTOM_BAR,initialize:function(){this.inited=!1,this.shareButon=null,this.shareOptions=null,this.downloadButton=null,this.printButton=null,this.searchButton=null,this.searchOptions=null,this.zoomBar=null,this.pageNumber=null,this.fullscreenButton=null,this.seekBar=null,this.watermarkBarContainer=null,this.widgetWatermarkBar=null,this.render(),this.listenTo(FSWidgetModel.gi().widgetState,"change:displayType",this.render),this.listenTo(FSWidgetModel.gi().widgetState,"change:displayState",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:enableDownload",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:enablePrint",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:sharePost",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:enableSearch",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:enableToc",this.render),this.listenTo(FSWidgetModel.gi().widgetSettings,"change:showControls",this.render),this.listenTo(FSWidgetModel.gi(),"change:height",this.onChangeSize),this.listenTo(FSWidgetModel.gi(),"change:width",this.onChangeSize),this.listenTo(FSWidgetModel.gi(),"change:labels",this.render),Backbone.Mediator.sub(WidgetEvent.AUTOHIDE_CONTROLS,this.closeAll,this)},render:function(){var e=FSWidgetModel.gi().getShareOptions();return this.playerNavSlider=this.$el.find("#playerNavSlider"),this.bottomLeft=this.$el.find("#bottomLeft"),this.bottomRight=this.$el.find("#bottomRight"),this.watermarkBarContainer=this.$el.parent().find("#fsw-watermark-bar"),FSWidgetModel.gi().get("shelfData")&&FSWidgetModel.gi().get("shelfData").get("shelfOpened")?this:((this.inited&&FlipSnackEmbed.isEditor||"labels"in FSWidgetModel.gi().changed)&&this.resetMenu(),this.inited||this.canInitMenu()||FSWidgetModel.gi().widgetSettings.get("skinType")===WidgetSkinType.PLAYER?((!0===FSWidgetModel.gi().get("isApp")||FSUtils.isMobileDevice())&&this.playerNavSlider.addClass("mobile-slider"),this.inited=!0,this.seekBar||this.addSeekBar(),this.pageNumber||this.addPageNumber(),this.zoomBar||FSUtils.isMobileDevice()||this.addZoomBar(),FSWidgetModel.gi().widgetSettings.get("enableToc")&&this.addTOCButton(),this.shareButon||!e.sharePost||FSWidgetModel.gi().get("isDownload")||this.addShareButton(e),!this.downloadButton&&FSWidgetModel.gi().widgetSettings.get("enableDownload")&&FSWidgetModel.gi().get("collectionData").features[FEATURES.DOWNLOAD_PDF]&&this.addDownloadButton(),!this.printButton&&FSWidgetModel.gi().widgetSettings.get("enablePrint")&&FSWidgetModel.gi().get("collectionData").features[FEATURES.DOWNLOAD_PDF]&&this.addPrintButton(),!this.searchButton&&FSWidgetModel.gi().widgetSettings.get("enableSearch")&&this.addSearchButton(),this.fullscreenButton||this.addFullScreenButton(),FSWidgetModel.gi().get("collectionData").watermark?this.addWatermarkBar():this.watermarkBarContainer.remove(),this.onChangeSize(),this):this)},resetMenu:function(){this.bottomRight.empty(),this.pageNumber&&(this.pageNumber.remove(),this.pageNumber=null),this.zoomBar&&(this.zoomBar.remove(),this.zoomBar=null),this.fullscreenButton&&(this.fullscreenButton.remove(),this.fullscreenButton=null),this.shareButon&&(this.shareButon.remove(),this.shareButon=null),this.shareOptions&&(this.shareOptions.closePanel(),this.shareOptions.remove(),this.shareOptions=null),this.downloadButton&&(this.downloadButton.remove(),this.downloadButton=null),this.printButton&&(this.printButton.remove(),this.printButton=null),this.searchButton&&(this.searchButton.remove(),this.searchButton=null),this.searchOptions&&(this.searchOptions.closePanel(),this.searchOptions.remove(),this.searchOptions=null),this.tocButon&&(this.tocButon.remove(),this.tocButon=null)},onChangeSize:function(){FSWidgetModel.gi().canShowControls()?(this.inited||this.render(),this.$el.addClass("show-controls")):this.$el.removeClass("show-controls")},addSeekBar:function(){this.seekBar=PlayerNavSliderView.gi(),this.playerNavSlider.append(this.seekBar.render().el)},addPageNumber:function(){var e=FSWidgetModel.gi().widgetState.get("currentItem").get("pages").length,t=FSWidgetModel.gi().widgetSettings.get("singlePageView"),i=FSWidgetModel.gi().widgetSettings.get("arabicStyle"),o=FSWidgetModel.gi().widgetState.get("leftPageIndex")<0?0:FSWidgetModel.gi().widgetState.get("leftPageIndex"),n=i?e-o:o+1,s=i?n-1:n+1,a=[n];FSUtils.isMobileDevice()&&FSUtils.isPortrait()||t||n<e&&n>1&&a.push(s),this.pageNumber=new PageNumber({model:new Backbone.Model({totalPages:e,currentPage:a.join("-")})}),this.bottomLeft.append(this.pageNumber.render().el)},addZoomBar:function(){this.zoomBar=new ZoomBar({model:new ZoomModel({maxZoomValue:FSWidgetModel.gi().get("maxZoomValue")})}),this.bottomRight.append(this.zoomBar.render().el)},addTOCButton:function(){this.tocButon||(this.tocButon=new PlayerTOCButton({model:new Backbone.Model({label:FSWidgetModel.gi().get("labels").l_toc})}),this.bottomRight.append(this.tocButon.render().el))},addShareButton:function(e){this.shareOptions=new ShareOptions({model:new Backbone.Model(e)}),this.shareButon=new PlayerShareButton({model:new Backbone.Model({open:!1,optionsPanel:this.shareOptions,label:FSWidgetModel.gi().get("labels").l_share})}),this.bottomRight.append(this.shareButon.render().el),this.shareButon.$el.append(this.shareOptions.render().el)},addDownloadButton:function(){var e=FSWidgetModel.gi().getCollectionDownloadLink();this.downloadButton=new PlayerDownloadButton({model:new Backbone.Model({action:"download",label:FSWidgetModel.gi().get("labels").l_download,link:e,target:"_blank"})}),this.bottomRight.append(this.downloadButton.render().el)},addPrintButton:function(){var e=FSWidgetModel.gi().getCollectionDownloadLink(!0);this.printButton=new PlayerPrintButton({model:new Backbone.Model({action:"print",label:FSWidgetModel.gi().get("labels").l_print,link:e,target:"_blank"})}),this.bottomRight.append(this.printButton.render().el)},addSearchButton:function(){this.searchOptions=new PlayerSearchOptions({model:new Backbone.Model}),this.searchButton=new PlayerSearchButton({model:new Backbone.Model({optionsPanel:this.searchOptions,label:FSWidgetModel.gi().get("labels").l_search})}),this.bottomRight.append(this.searchButton.render().el),this.searchButton.$el.append(this.searchOptions.render().el)},addFullScreenButton:function(){this.fullscreenButton=new PlayerFullScreenButton({model:new Backbone.Model({label:FSWidgetModel.gi().get("labels").l_enter_fs})}),this.bottomRight.append(this.fullscreenButton.render().el)},addWatermarkBar:function(){this.widgetWatermarkBar=new WidgetWatermarkBar({model:new Backbone.Model({flipsnackUrl:FlipSnackEmbed.urls.siteURL,logoSrc:FlipSnackEmbed.urls.baseUrl+"/site/images/flipsnack-logo.gz.svg"})}),this.watermarkBarContainer.append(this.widgetWatermarkBar.render().el)},canInitMenu:function(){return FSWidgetModel.gi().canShowControls()||FSWidgetModel.gi().widgetState.get("displayType")===DisplayType.LARGE},handleMouseOver:function(){Backbone.Mediator.pub(WidgetEvent.STOP_AUTOHIDE)},handleMouseOut:function(){Backbone.Mediator.pub(WidgetEvent.START_AUTOHIDE)},closeAll:function(){this.shareOptions&&this.shareOptions.closePanel(),this.searchOptions&&this.searchOptions.closePanel(),this.zoomButton&&this.zoomButton.closePanel(),this.toc&&this.toc.closePanel()},remove:function(){Backbone.Mediator.unsubscribe(WidgetEvent.RESIZE,this.onResize,this),this.resetMenu(),this.searchOptions&&(this.searchOptions.remove(),this.searchOptions=null),this.shareOptions&&(this.shareOptions.remove(),this.shareOptions=null),Backbone.View.prototype.remove.apply(this,arguments),Backbone.Mediator.unsubscribe(WidgetEvent.AUTOHIDE_CONTROLS,this.showControllers,this)}}),PlayerSkinController._instance=null,PlayerSkinController.gi=function(){return PlayerSkinController._instance||FSWidgetModel.gi().widgetSettings.get("skinType")!==WidgetSkinType.PLAYER||(PlayerSkinController._instance=new PlayerSkinController),PlayerSkinController._instance},Backbone.Mediator.sub(WidgetEvent.CONFIG_DONE,(function(){FSWidgetModel.gi().widgetSettings.get("skinType")===WidgetSkinType.PLAYER&&PlayerSkinController.gi()}),this),Backbone.Mediator.sub(WidgetEvent.DESTROY,(function(){PlayerSkinController._instance&&(PlayerSkinController.gi().remove(),PlayerSkinController._instance=null)}),this)}();var PlayerSearchOptions=MenuOptionsPanel.extend({events:{click:"onPanelClick","click .clear-results":"closePanel"},id:"search-options",initialize:function(){this.pdfItems=[],this.pdfTextsLoaded=[],this.onCurrentItemChanged(),this.searchInput=new SearchInputView({model:new Backbone.Model}),this.searchResults=new SearchResults({model:new Backbone.Model}),this.listenTo(FSWidgetModel.gi().widgetState,"change:currentItem",this.onCurrentItemChanged),this.listenTo(this.searchInput.model,"change:searchText",this.onSearchTextChanged),Backbone.Mediator.sub(WidgetEvent.OPEN_SEARCH_OPTIONS,this.showOptionsPanel,this),Backbone.Mediator.sub(WidgetEvent.CLEAR_SEARCH,this.hideSearchResults,this)},showOptionsPanel:function(){var e=this.searchInput.$el.find("input"),t=this.searchInput.model.get("searchText")||"";e.focus(),MenuOptionsPanel.prototype.showOptionsPanel.apply(this,arguments),""!==t&&(this.searchInput.model.set("searchText","",{silent:!0}),this.searchInput.model.set("searchText",t))},render:function(){return this.$el.html(this.template(this.model.attributes)),this.$el.find(".content").append(this.searchInput.render().el).prepend(this.searchResults.render().el),this},onCurrentItemChanged:function(){var e,t=FSWidgetModel.gi().widgetState.get("currentItem"),i=this;window.textJs=null,delete window.textJs,Backbone.Mediator.pub(WidgetEvent.CLEAR_SEARCH),FSWidgetModel.gi().widgetSettings.get("mergePdfs")?(this.setPdfItems(),this.pdfItems.length&&!FSWidgetModel.gi().widgetSettings.get("exportVideo")?this.loadAllTexts():this.setTextJs()):"pdf"!==t.get("extension")||t.get("notext")||"failed"===FSWidgetModel.gi().widgetState.get("currentItem").get("textLoadStatus")||FSWidgetModel.gi().widgetSettings.get("exportVideo")||(e=FlipSnackEmbed.urls.items+t.get("hash")+FlipSnackEmbed.urls.textJS,FSWidgetModel.gi().widgetState.get("currentItem").set("textLoadStatus","loading"),void 0===window["text_"+t.get("hash")]&&(window["text_"+t.get("hash")]=function(e){window.textJs=e}),FSUtils.loadScript(e,(function(){i.textJsLoaded()}),(function(){i.textJSFail()})))},setPdfItems:function(){var e=FSWidgetModel.gi().get("collectionData").collection,t=this,i=null;this.pdfItems=[],$.each(e,(function(e,o){"pdf"===o.extension&&(i=o.pageData,t.pdfItems.push(o),$.each(i,(function(e,i){"pdf"===i.extension&&i.originalHash&&!t.pdfItems.some((function(e){return e.source===i.originalHash}))&&t.pdfItems.push({source:i.originalHash})})),i=null)}))},setTextJs:function(){var e,t=FSWidgetModel.gi().widgetState.get("currentItem").get("pages"),i=[];for(e=0;e<this.pdfTextsLoaded.length;e++)i[this.pdfTextsLoaded[e].hash]=this.pdfTextsLoaded[e].textData;window.textJs={},$.each(t.models,(function(e,t){var o=i[t.get("originalHash")]||i[t.get("itemHash")]||null,n=t.get("pdfidx");o&&o[n]&&(t.get("type")===PageType.UPLOADED_PAGE||t.get("type")===PageType.MOVED_PAGE&&t.get("extension")&&"pdf"===t.get("extension"))&&(window.textJs[e]=$("<textarea />").html(o[n]).text())}))},loadAllTexts:function(){var e,t,i=this;this.pdfItems.length?(e=this.pdfItems.shift(),t=FlipSnackEmbed.urls.items+e.source+FlipSnackEmbed.urls.textJS,window["text_"+e.source]=function(t){i.pdfTextsLoaded.push({hash:e.source,textData:t})},FSUtils.loadScript(t,(function(){i.loadAllTexts()}),(function(){i.loadAllTexts()}))):this.pdfTextsLoaded.length&&(this.setTextJs(),Backbone.Mediator.pub(WidgetEvent.SEARCH_TEXTS_LOADED))},textJsLoaded:function(){FSWidgetModel.gi().widgetState.get("currentItem").set("textLoadStatus","success"),Backbone.Mediator.pub(WidgetEvent.SEARCH_TEXTS_LOADED)},textJSFail:function(){delete window["text_"+FSWidgetModel.gi().widgetState.get("currentItem").get("hash")],FSWidgetModel.gi().widgetState.get("currentItem").set("textLoadStatus","failed")},closePanel:function(){MenuOptionsPanel.prototype.closePanel.apply(this,arguments),Backbone.Mediator.pub(WidgetEvent.CLOSE_SEARCH_OPTIONS)},onPanelClick:function(e){e.stopImmediatePropagation()},onSearchTextChanged:function(e){this.showSearchResults(),this.searchResults.showResults(e.get("searchText"))},showSearchResults:function(){this.searchResults.$el.removeClass("hidden")},hideSearchResults:function(){this.searchResults.$el.addClass("hidden")},remove:function(){this.searchInput.remove(),this.searchInput=null,this.searchResults.remove(),this.searchResults=null,Backbone.Mediator.unsubscribe(WidgetEvent.OPEN_SEARCH_OPTIONS,this.showOptionsPanel,this),Backbone.Mediator.unsubscribe(WidgetEvent.CLEAR_SEARCH,this.hideSearchResults,this),Backbone.View.prototype.remove.apply(this,arguments)}});PlayerSearchOptions.TEXT_JS_LOAD_LIMIT=5;